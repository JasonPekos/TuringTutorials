<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.33" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.33</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.33">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-22.358729096127334</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-22.358729096127334</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.2164   -4.03515   -5.21602   -5.23694   …  -5.21306   -5.6944   -5.6944
  1.36207   0.972136   0.716274  -0.357287     -0.105013  -1.08278  -1.08278
  2.36288   4.87024    6.2923     6.77223       5.81957    4.11031   4.11031</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02767    1.00284
  0.0378572  0.989601
  5.01183    0.998591</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip550">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip550)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip551">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip550)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip552">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip550)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1509.14 2640.76,1509.14 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1215.97 2640.76,1215.97 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,922.791 2640.76,922.791 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,629.617 2640.76,629.617 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,336.442 2640.76,336.442 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1509.14 170.644,1509.14 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1215.97 170.644,1215.97 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,922.791 170.644,922.791 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,629.617 170.644,629.617 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,336.442 170.644,336.442 "></polyline>
<path clip-path="url(#clip550)" d="M49.5521 1509.59 L79.2279 1509.59 L79.2279 1513.53 L49.5521 1513.53 L49.5521 1509.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M99.8991 1507.28 Q96.7509 1507.28 94.8991 1509.43 Q93.0704 1511.58 93.0704 1515.33 Q93.0704 1519.06 94.8991 1521.24 Q96.7509 1523.39 99.8991 1523.39 Q103.047 1523.39 104.876 1521.24 Q106.728 1519.06 106.728 1515.33 Q106.728 1511.58 104.876 1509.43 Q103.047 1507.28 99.8991 1507.28 M109.181 1492.62 L109.181 1496.88 Q107.422 1496.05 105.617 1495.61 Q103.834 1495.17 102.075 1495.17 Q97.4454 1495.17 94.9917 1498.3 Q92.5612 1501.42 92.2139 1507.74 Q93.5797 1505.73 95.6398 1504.66 Q97.7 1503.57 100.177 1503.57 Q105.385 1503.57 108.394 1506.75 Q111.427 1509.89 111.427 1515.33 Q111.427 1520.66 108.279 1523.87 Q105.131 1527.09 99.8991 1527.09 Q93.9037 1527.09 90.7325 1522.51 Q87.5612 1517.9 87.5612 1509.18 Q87.5612 1500.98 91.45 1496.12 Q95.3389 1491.24 101.89 1491.24 Q103.649 1491.24 105.431 1491.58 Q107.237 1491.93 109.181 1492.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M50.3623 1216.42 L80.0381 1216.42 L80.0381 1220.35 L50.3623 1220.35 L50.3623 1216.42 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M104.297 1214.61 Q107.654 1215.33 109.529 1217.6 Q111.427 1219.87 111.427 1223.2 Q111.427 1228.32 107.908 1231.12 Q104.39 1233.92 97.9083 1233.92 Q95.7324 1233.92 93.4176 1233.48 Q91.126 1233.06 88.6723 1232.2 L88.6723 1227.69 Q90.6167 1228.82 92.9315 1229.4 Q95.2463 1229.98 97.7695 1229.98 Q102.168 1229.98 104.459 1228.25 Q106.774 1226.51 106.774 1223.2 Q106.774 1220.14 104.621 1218.43 Q102.492 1216.7 98.6722 1216.7 L94.6445 1216.7 L94.6445 1212.85 L98.8574 1212.85 Q102.306 1212.85 104.135 1211.49 Q105.964 1210.1 105.964 1207.51 Q105.964 1204.84 104.066 1203.43 Q102.191 1202 98.6722 1202 Q96.7509 1202 94.5519 1202.41 Q92.3528 1202.83 89.7139 1203.71 L89.7139 1199.54 Q92.376 1198.8 94.6908 1198.43 Q97.0287 1198.06 99.0889 1198.06 Q104.413 1198.06 107.515 1200.49 Q110.617 1202.9 110.617 1207.02 Q110.617 1209.89 108.973 1211.88 Q107.33 1213.85 104.297 1214.61 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M99.4824 908.59 Q95.8713 908.59 94.0426 912.155 Q92.2371 915.697 92.2371 922.826 Q92.2371 929.933 94.0426 933.497 Q95.8713 937.039 99.4824 937.039 Q103.117 937.039 104.922 933.497 Q106.751 929.933 106.751 922.826 Q106.751 915.697 104.922 912.155 Q103.117 908.59 99.4824 908.59 M99.4824 904.886 Q105.293 904.886 108.348 909.493 Q111.427 914.076 111.427 922.826 Q111.427 931.553 108.348 936.159 Q105.293 940.743 99.4824 940.743 Q93.6723 940.743 90.5936 936.159 Q87.538 931.553 87.538 922.826 Q87.538 914.076 90.5936 909.493 Q93.6723 904.886 99.4824 904.886 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M104.297 628.263 Q107.654 628.98 109.529 631.249 Q111.427 633.517 111.427 636.85 Q111.427 641.966 107.908 644.767 Q104.39 647.568 97.9083 647.568 Q95.7324 647.568 93.4176 647.128 Q91.126 646.712 88.6723 645.855 L88.6723 641.341 Q90.6167 642.475 92.9315 643.054 Q95.2463 643.633 97.7695 643.633 Q102.168 643.633 104.459 641.897 Q106.774 640.161 106.774 636.85 Q106.774 633.795 104.621 632.082 Q102.492 630.346 98.6722 630.346 L94.6445 630.346 L94.6445 626.503 L98.8574 626.503 Q102.306 626.503 104.135 625.138 Q105.964 623.749 105.964 621.156 Q105.964 618.494 104.066 617.082 Q102.191 615.647 98.6722 615.647 Q96.7509 615.647 94.5519 616.064 Q92.3528 616.48 89.7139 617.36 L89.7139 613.193 Q92.376 612.452 94.6908 612.082 Q97.0287 611.712 99.0889 611.712 Q104.413 611.712 107.515 614.142 Q110.617 616.55 110.617 620.67 Q110.617 623.54 108.973 625.531 Q107.33 627.499 104.297 628.263 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M99.8991 334.579 Q96.7509 334.579 94.8991 336.731 Q93.0704 338.884 93.0704 342.634 Q93.0704 346.361 94.8991 348.537 Q96.7509 350.69 99.8991 350.69 Q103.047 350.69 104.876 348.537 Q106.728 346.361 106.728 342.634 Q106.728 338.884 104.876 336.731 Q103.047 334.579 99.8991 334.579 M109.181 319.926 L109.181 324.185 Q107.422 323.352 105.617 322.912 Q103.834 322.472 102.075 322.472 Q97.4454 322.472 94.9917 325.597 Q92.5612 328.722 92.2139 335.042 Q93.5797 333.028 95.6398 331.963 Q97.7 330.875 100.177 330.875 Q105.385 330.875 108.394 334.046 Q111.427 337.194 111.427 342.634 Q111.427 347.958 108.279 351.176 Q105.131 354.393 99.8991 354.393 Q93.9037 354.393 90.7325 349.81 Q87.5612 345.204 87.5612 336.477 Q87.5612 328.282 91.45 323.421 Q95.3389 318.537 101.89 318.537 Q103.649 318.537 105.431 318.884 Q107.237 319.231 109.181 319.926 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip552)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1139.39 224.541,1461.11 226.891,1525.5 229.242,1374.63 231.592,1371.79 233.943,1289.26 236.293,1540.78 238.644,1476.98 240.994,1476.53 243.345,1534.53 245.695,1181.57 248.046,1422.09 250.396,1479.02 252.747,1331.32 255.097,1408.22 257.448,1588.3 259.798,1394.39 262.148,1503.37 264.499,1243.76 266.849,1424.23 269.2,1385.86 271.55,1380.11 273.901,1215.13 276.251,1440.15 278.602,1502.43 280.952,1381.93 283.303,1576.64 285.653,1448.54 288.004,1445.11 290.354,1373 292.705,1332.23 295.055,1372.73 297.406,1414.9 299.756,1468.04 302.107,1335.4 304.457,1404.41 306.807,1438.27 309.158,1465.81 311.508,1427.51 313.859,1372.83 316.209,1491.01 318.56,1412.23 320.91,1537.28 323.261,1349.31 325.611,1614.41 327.962,1436.28 330.312,1462.45 332.663,1349.93 335.013,1394.8 337.364,1654.32 339.714,1511.34 342.065,1477.87 344.415,1555.77 346.765,1342.68 349.116,1423.58 351.466,1539.42 353.817,1406.15 356.167,1388.82 358.518,1330.85 360.868,1457.82 363.219,1202.76 365.569,1500.42 367.92,1444.58 370.27,1362.82 372.621,1447.81 374.971,1315.82 377.322,1391.22 379.672,1447.62 382.023,1559.91 384.373,1473.94 386.724,1410.78 389.074,1413.27 391.424,1316.49 393.775,1298.96 396.125,1366.76 398.476,1340.04 400.826,1342.54 403.177,1477.02 405.527,1315.66 407.878,1462.84 410.228,1388.53 412.579,1420.33 414.929,1356.66 417.28,1392.17 419.63,1364.21 421.981,1371.23 424.331,1401.6 426.682,1541.81 429.032,1375.73 431.382,1313.81 433.733,1476.19 436.083,1415.47 438.434,1278.37 440.784,1639.27 443.135,1443.63 445.485,1211.32 447.836,1248.25 450.186,1380.07 452.537,1477.29 454.887,1432.15 457.238,1359.52 459.588,1491.39 461.939,1239 464.289,1511.65 466.64,1326.1 468.99,1231.91 471.341,1233.72 473.691,1399.93 476.041,1414.94 478.392,1524.54 480.742,1475 483.093,1401.32 485.443,1387.36 487.794,1549.62 490.144,1433.5 492.495,1382.92 494.845,1350.84 497.196,1316.93 499.546,1588.89 501.897,1326.6 504.247,1453.28 506.598,1392.09 508.948,1450.5 511.299,1461.28 513.649,1343.69 515.999,1404.25 518.35,1335.7 520.7,1551.67 523.051,1442.15 525.401,1447.44 527.752,1400.99 530.102,1607.7 532.453,1542.16 534.803,1491.26 537.154,1348.59 539.504,1289.29 541.855,1340.48 544.205,1662.77 546.556,1497.15 548.906,1322.35 551.257,1519.29 553.607,1572.66 555.958,1400.81 558.308,1351.96 560.658,1427.49 563.009,1478.81 565.359,1319.21 567.71,1402.84 570.06,1340.03 572.411,1285.53 574.761,1458.49 577.112,1405.05 579.462,1300.74 581.813,1410.01 584.163,1433.44 586.514,1358.92 588.864,1372.79 591.215,1454.73 593.565,1432.79 595.916,1281.07 598.266,1617.36 600.616,1370.13 602.967,1402.62 605.317,1477.62 607.668,1429.17 610.018,1471.62 612.369,1500.06 614.719,1360.64 617.07,1414.14 619.42,1457.85 621.771,1394.18 624.121,1375.17 626.472,1505.97 628.822,1292.49 631.173,1410.14 633.523,1278.9 635.874,1406.05 638.224,1408.91 640.575,1297.06 642.925,1541.15 645.275,1545.94 647.626,1357.57 649.976,1510.35 652.327,1487.87 654.677,1497.32 657.028,1315.2 659.378,1304.18 661.729,1490.67 664.079,1432.41 666.43,1525.81 668.78,1492.58 671.131,1467.33 673.481,1675.62 675.832,1368.27 678.182,1435.22 680.533,1442.16 682.883,1323.46 685.233,1356.64 687.584,1281.86 689.934,1497.66 692.285,1454.14 694.635,1413.62 696.986,1361.04 699.336,1525.91 701.687,1432.21 704.037,1732.22 706.388,1365.26 708.738,1357.68 711.089,1347.33 713.439,1384.08 715.79,1525.82 718.14,1429 720.491,1446.82 722.841,1519.95 725.192,1214.23 727.542,1424.17 729.892,1421.74 732.243,1425.68 734.593,1418.69 736.944,1489.81 739.294,1329.39 741.645,1562.15 743.995,1353.45 746.346,1314.46 748.696,1334.77 751.047,1468.8 753.397,1213.79 755.748,1492.4 758.098,1195.83 760.449,1435.6 762.799,1393.97 765.15,1652.01 767.5,1243.48 769.85,1234.89 772.201,1442.22 774.551,1402.24 776.902,1401.31 779.252,1379.79 781.603,1297.91 783.953,1212.78 786.304,1358.37 788.654,1449.04 791.005,1572.76 793.355,1400.79 795.706,1491.85 798.056,1475.41 800.407,1382.8 802.757,1224.28 805.108,1362.85 807.458,1369.96 809.809,1312.64 812.159,1182.06 814.509,1217.28 816.86,1422.92 819.21,1330.46 821.561,1325.43 823.911,1509.64 826.262,1505.78 828.612,1263.91 830.963,1461.76 833.313,1365.56 835.664,1533.75 838.014,1449.38 840.365,1469.91 842.715,1494.06 845.066,1380.14 847.416,1371.75 849.767,1521.39 852.117,1353.19 854.467,1388.3 856.818,1285.23 859.168,1418.81 861.519,1525.39 863.869,1420.09 866.22,1425.35 868.57,1447.24 870.921,1272.9 873.271,1491.12 875.622,1453.99 877.972,1452.95 880.323,1492.93 882.673,1321.84 885.024,1441.2 887.374,1491.32 889.725,1317.35 892.075,1544.8 894.426,1423.2 896.776,1346.59 899.126,1474.21 901.477,1521.62 903.827,1425.21 906.178,1640.34 908.528,1451.44 910.879,1518.56 913.229,1429.17 915.58,1486.87 917.93,1305.44 920.281,1551.9 922.631,1391.64 924.982,1386.64 927.332,1243.48 929.683,1442.16 932.033,1425.47 934.384,1476.92 936.734,1542.7 939.084,1478.17 941.435,1339.95 943.785,1338.13 946.136,1454.97 948.486,1269.3 950.837,1542.58 953.187,1517.7 955.538,1503.95 957.888,1343.68 960.239,1392.54 962.589,1442.37 964.94,1376.95 967.29,1240.52 969.641,1325.86 971.991,1482.01 974.342,1319.57 976.692,1408.71 979.043,1316.67 981.393,1288.98 983.743,1291.79 986.094,1435.17 988.444,1354.01 990.795,1569.34 993.145,1534.71 995.496,1254.52 997.846,1374.3 1000.2,1394.72 1002.55,1579.31 1004.9,1428.43 1007.25,1282.41 1009.6,1424.21 1011.95,1297.86 1014.3,1474.48 1016.65,1457.59 1019,1438.39 1021.35,1493.73 1023.7,1198.32 1026.05,1449.83 1028.4,1202.87 1030.75,1476.18 1033.1,1448.21 1035.45,1348.52 1037.8,1586.32 1040.15,1455.66 1042.51,1634.76 1044.86,1471.05 1047.21,1617.93 1049.56,1174.62 1051.91,1373.96 1054.26,1639.72 1056.61,1526.59 1058.96,1579.55 1061.31,1437.07 1063.66,1304.81 1066.01,1400.22 1068.36,1461.44 1070.71,1528.64 1073.06,1387.22 1075.41,1358.32 1077.76,1464.85 1080.11,1486.56 1082.46,1361.63 1084.81,1428.99 1087.16,1350.85 1089.51,1474.52 1091.87,1443 1094.22,1751.15 1096.57,1383.89 1098.92,1494.91 1101.27,1578.9 1103.62,1441.3 1105.97,1402.61 1108.32,1361.06 1110.67,1287.58 1113.02,1463.69 1115.37,1401.18 1117.72,1470.52 1120.07,1464.09 1122.42,1295.68 1124.77,1628.17 1127.12,1353.41 1129.47,1524.23 1131.82,1508.61 1134.17,1485.24 1136.52,1432 1138.87,1544.55 1141.23,1445.41 1143.58,1552.32 1145.93,1454.58 1148.28,1437.61 1150.63,1426.75 1152.98,1404.62 1155.33,1428.3 1157.68,1288.3 1160.03,1378.68 1162.38,1447.44 1164.73,1475.6 1167.08,1335.23 1169.43,1513.46 1171.78,1587.12 1174.13,1351.76 1176.48,1515.07 1178.83,1454.25 1181.18,1328.19 1183.53,1354.36 1185.88,1464.5 1188.23,1358.18 1190.59,1515.62 1192.94,1400.35 1195.29,1469.02 1197.64,1326.57 1199.99,1456.24 1202.34,1411.76 1204.69,1515.48 1207.04,1328.9 1209.39,1346.15 1211.74,1506.46 1214.09,1557.13 1216.44,1441.01 1218.79,1395.6 1221.14,1489.89 1223.49,1299.95 1225.84,1371.47 1228.19,1575.85 1230.54,1542.26 1232.89,1499.64 1235.24,1480.03 1237.59,1384.55 1239.94,1372.52 1242.3,1354.58 1244.65,1387.23 1247,1411.95 1249.35,1345.85 1251.7,1566.35 1254.05,1249.4 1256.4,1539.53 1258.75,1265.94 1261.1,1300.4 1263.45,1414.87 1265.8,1655.49 1268.15,1362.08 1270.5,1543.62 1272.85,1357.69 1275.2,1518.8 1277.55,1566.58 1279.9,1300.96 1282.25,1277.09 1284.6,1447.15 1286.95,1396.69 1289.3,1532.48 1291.66,1378.32 1294.01,1390.38 1296.36,1311.21 1298.71,1507.14 1301.06,1455.86 1303.41,1406.38 1305.76,1346.29 1308.11,1692.21 1310.46,1442.04 1312.81,1376 1315.16,1302.19 1317.51,1311.98 1319.86,1331.36 1322.21,1558.18 1324.56,1354.35 1326.91,1461.42 1329.26,1317.59 1331.61,1533.93 1333.96,1438.9 1336.31,1447.17 1338.66,1441.32 1341.02,1369.33 1343.37,1411.23 1345.72,1322.6 1348.07,1357.43 1350.42,1486.79 1352.77,1460.4 1355.12,1322.6 1357.47,1323.71 1359.82,1365.24 1362.17,1102.02 1364.52,1448.47 1366.87,1333.87 1369.22,1261.33 1371.57,1324.22 1373.92,1496.77 1376.27,1334.58 1378.62,1433.04 1380.97,1312.84 1383.32,1387.17 1385.67,1220.38 1388.02,1325.34 1390.38,1423.04 1392.73,1342.56 1395.08,1521.92 1397.43,1271.69 1399.78,1431.3 1402.13,1471.03 1404.48,1374.63 1406.83,1253.74 1409.18,1227.88 1411.53,1399.76 1413.88,1511.67 1416.23,1487.9 1418.58,1478.34 1420.93,1419.06 1423.28,1558.97 1425.63,1291.23 1427.98,1534.28 1430.33,1371.68 1432.68,1471.99 1435.03,1315.7 1437.38,1456.35 1439.74,1420.88 1442.09,1390.39 1444.44,1273.11 1446.79,1469.61 1449.14,1186.39 1451.49,1440.3 1453.84,1489.55 1456.19,1317.78 1458.54,1374.63 1460.89,1257.02 1463.24,1456.89 1465.59,1486.6 1467.94,1455.39 1470.29,1276.03 1472.64,1426.33 1474.99,1441.4 1477.34,1421.41 1479.69,1219.68 1482.04,1474.85 1484.39,1365.08 1486.74,1507.19 1489.1,1322.25 1491.45,1400.38 1493.8,1439.14 1496.15,1393.53 1498.5,1446.92 1500.85,1520.71 1503.2,1239.14 1505.55,1265.84 1507.9,1689.35 1510.25,1318.74 1512.6,1340.52 1514.95,1276.3 1517.3,1551.38 1519.65,1441.62 1522,1363.09 1524.35,1412.78 1526.7,1279.49 1529.05,1515.28 1531.4,1355.05 1533.75,1504.87 1536.1,1648.44 1538.45,1409.67 1540.81,1554.39 1543.16,1237.79 1545.51,1433.72 1547.86,1493.79 1550.21,1516.17 1552.56,1478.33 1554.91,1370.74 1557.26,1385.53 1559.61,1400.62 1561.96,1524.37 1564.31,1498.74 1566.66,1506.97 1569.01,1356.58 1571.36,1475.75 1573.71,1536.35 1576.06,1313.86 1578.41,1493.13 1580.76,1381.79 1583.11,1556.54 1585.46,1313.65 1587.81,1442.49 1590.17,1320.57 1592.52,1365.01 1594.87,1422.19 1597.22,1499.73 1599.57,1347.19 1601.92,1359.21 1604.27,1367.62 1606.62,1674.55 1608.97,1270.06 1611.32,1442.93 1613.67,1456.48 1616.02,1321.14 1618.37,1351.55 1620.72,1643.77 1623.07,1446.07 1625.42,1157.87 1627.77,1368.85 1630.12,1316.43 1632.47,1529.76 1634.82,1239.81 1637.17,1440.68 1639.53,1341.54 1641.88,1478.77 1644.23,1386.88 1646.58,1651.82 1648.93,1422.54 1651.28,1245.26 1653.63,1541.54 1655.98,1438.44 1658.33,1357.04 1660.68,1446.5 1663.03,1377.79 1665.38,1401.77 1667.73,1491.52 1670.08,1436.72 1672.43,1236.57 1674.78,1476.79 1677.13,1349.54 1679.48,1243.36 1681.83,1505.12 1684.18,1426.57 1686.53,1336.12 1688.89,1426.03 1691.24,1489.6 1693.59,1509.22 1695.94,1503.09 1698.29,1480.97 1700.64,1370.97 1702.99,1467.19 1705.34,1477.6 1707.69,1633.97 1710.04,1310.27 1712.39,1519.5 1714.74,1321.83 1717.09,1365.55 1719.44,1388.9 1721.79,1288.02 1724.14,1466.3 1726.49,1249.01 1728.84,1496.13 1731.19,1371.79 1733.54,1229.85 1735.89,1284.64 1738.25,1504.11 1740.6,1475.49 1742.95,1439.47 1745.3,1639.91 1747.65,1537.95 1750,1341.92 1752.35,1417.12 1754.7,1454.37 1757.05,1397.31 1759.4,1401.74 1761.75,1517.44 1764.1,1331.81 1766.45,1341.47 1768.8,1355.38 1771.15,1440.17 1773.5,1558.28 1775.85,1406.09 1778.2,1506.27 1780.55,1431.93 1782.9,1321.55 1785.25,1398.82 1787.6,1542.59 1789.96,1481.94 1792.31,1391.77 1794.66,1515.7 1797.01,1307.33 1799.36,1519.85 1801.71,1463.43 1804.06,1511.77 1806.41,1472.84 1808.76,1461.23 1811.11,1361.03 1813.46,1348.64 1815.81,1398.6 1818.16,1351.69 1820.51,1494.05 1822.86,1553.02 1825.21,1543.41 1827.56,1439.64 1829.91,1442.63 1832.26,1592.8 1834.61,1454.16 1836.96,1277.52 1839.32,1336.68 1841.67,1297.73 1844.02,1177.55 1846.37,1467.9 1848.72,1434.38 1851.07,1450.25 1853.42,1449.32 1855.77,1341.09 1858.12,1543.56 1860.47,1243.41 1862.82,1533.78 1865.17,1282.02 1867.52,1357.12 1869.87,1467.51 1872.22,1334.76 1874.57,1477.46 1876.92,1535.32 1879.27,1558.04 1881.62,1400.41 1883.97,1476 1886.32,1576 1888.68,1490.01 1891.03,1605.15 1893.38,1506.35 1895.73,1311.25 1898.08,1535.51 1900.43,1547.18 1902.78,1356.98 1905.13,1312.99 1907.48,1443.6 1909.83,1565.27 1912.18,1495.04 1914.53,1665.16 1916.88,1551.79 1919.23,1274.23 1921.58,1435.48 1923.93,1511.82 1926.28,1479.67 1928.63,1257.14 1930.98,1425.26 1933.33,1370.25 1935.68,1204.94 1938.04,1602.13 1940.39,1189.76 1942.74,1221.22 1945.09,1553.35 1947.44,1566.36 1949.79,1505.55 1952.14,1592.63 1954.49,1504.03 1956.84,1519.26 1959.19,1413.96 1961.54,1434.75 1963.89,1458.92 1966.24,1350.98 1968.59,1424.76 1970.94,1522.63 1973.29,1451.61 1975.64,1365.52 1977.99,1376.37 1980.34,1335.26 1982.69,1386.18 1985.04,1481.87 1987.4,1288.84 1989.75,1440.46 1992.1,1206.66 1994.45,1456.59 1996.8,1522.7 1999.15,1509.03 2001.5,1320.8 2003.85,1516.49 2006.2,1383.52 2008.55,1419.61 2010.9,1337.8 2013.25,1584.61 2015.6,1500.52 2017.95,1539.89 2020.3,1516.3 2022.65,1416.74 2025,1469.91 2027.35,1433.8 2029.7,1457.75 2032.05,1469.4 2034.4,1471.57 2036.76,1409.84 2039.11,1407.63 2041.46,1489.23 2043.81,1372.96 2046.16,1439.13 2048.51,1197.5 2050.86,1395.09 2053.21,1304.42 2055.56,1272.19 2057.91,1359.03 2060.26,1421.65 2062.61,1398.5 2064.96,1373.75 2067.31,1380.99 2069.66,1422.06 2072.01,1280.62 2074.36,1505.59 2076.71,1491.76 2079.06,1333.16 2081.41,1480.2 2083.76,1351.59 2086.11,1583.24 2088.47,1243.12 2090.82,1294.68 2093.17,1413.41 2095.52,1535.83 2097.87,1366.6 2100.22,1509.59 2102.57,1431.68 2104.92,1423.53 2107.27,1405.62 2109.62,1320.62 2111.97,1549.68 2114.32,1421.45 2116.67,1548.13 2119.02,1378.71 2121.37,1318.45 2123.72,1298.45 2126.07,1315.72 2128.42,1257.57 2130.77,1398.73 2133.12,1483.19 2135.47,1397.69 2137.83,1642.59 2140.18,1417.17 2142.53,1327.43 2144.88,1337.58 2147.23,1510 2149.58,1394.78 2151.93,1309.93 2154.28,1457.89 2156.63,1325.69 2158.98,1560.78 2161.33,1206.47 2163.68,1581.72 2166.03,1478.54 2168.38,1425.25 2170.73,1251.56 2173.08,1618.26 2175.43,1353.4 2177.78,1344.2 2180.13,1276.85 2182.48,1404.69 2184.83,1293.59 2187.19,1260.04 2189.54,1343.23 2191.89,1481.66 2194.24,1391.99 2196.59,1489.83 2198.94,1377.5 2201.29,1489.66 2203.64,1507.7 2205.99,1437.22 2208.34,1401.78 2210.69,1503.57 2213.04,1244.26 2215.39,1599.32 2217.74,1507.14 2220.09,1490.59 2222.44,1377.76 2224.79,1570.74 2227.14,1487.67 2229.49,1440.4 2231.84,1367.49 2234.19,1261.39 2236.55,1470.81 2238.9,1570.81 2241.25,1296.29 2243.6,1245.43 2245.95,1401.72 2248.3,1271.03 2250.65,1316.44 2253,1536.45 2255.35,1313.47 2257.7,1382.11 2260.05,1421.86 2262.4,1410.58 2264.75,1251.81 2267.1,1409.8 2269.45,1418.86 2271.8,1356.58 2274.15,1318.14 2276.5,1376.13 2278.85,1484.51 2281.2,1592.55 2283.55,1569.13 2285.91,1382.66 2288.26,1331.1 2290.61,1417.5 2292.96,1513.75 2295.31,1307.16 2297.66,1398.61 2300.01,1625.74 2302.36,1255.3 2304.71,1399 2307.06,1449.6 2309.41,1396.28 2311.76,1349.41 2314.11,1363.53 2316.46,1512.85 2318.81,1348.32 2321.16,1363.99 2323.51,1397.28 2325.86,1508.7 2328.21,1451.41 2330.56,1353.72 2332.91,1423.07 2335.27,1323.15 2337.62,1413.26 2339.97,1317.68 2342.32,1376.86 2344.67,1266.84 2347.02,1481.88 2349.37,1404.98 2351.72,1307.31 2354.07,1459.1 2356.42,1333.58 2358.77,1271.56 2361.12,1328.68 2363.47,1253.17 2365.82,1507.95 2368.17,1457.47 2370.52,1433.07 2372.87,1314.25 2375.22,1323.24 2377.57,1618.21 2379.92,1533.1 2382.27,1569.19 2384.62,1406.34 2386.98,1338.25 2389.33,1339.61 2391.68,1385.28 2394.03,1373.98 2396.38,1376.48 2398.73,1544.76 2401.08,1386.97 2403.43,1444.55 2405.78,1446.44 2408.13,1291.24 2410.48,1401.65 2412.83,1342.8 2415.18,1374.12 2417.53,1202.12 2419.88,1371.78 2422.23,1479.11 2424.58,1434.98 2426.93,1384.16 2429.28,1418.61 2431.63,1381.52 2433.98,1583.37 2436.34,1432.48 2438.69,1394.66 2441.04,1468.81 2443.39,1273.41 2445.74,1459.65 2448.09,1433.16 2450.44,1332.3 2452.79,1392.98 2455.14,1239.41 2457.49,1472.89 2459.84,1315.95 2462.19,1482.79 2464.54,1501.79 2466.89,1249.01 2469.24,1491.87 2471.59,1514.2 2473.94,1381 2476.29,1579.66 2478.64,1355.49 2480.99,1252.86 2483.34,1307.26 2485.7,1336.04 2488.05,1384 2490.4,1440.12 2492.75,1259.32 2495.1,1554.75 2497.45,1447.92 2499.8,1339.81 2502.15,1515.48 2504.5,1412.88 2506.85,1419.99 2509.2,1394.38 2511.55,1515.63 2513.9,1493.82 2516.25,1490.41 2518.6,1403.86 2520.95,1528.82 2523.3,1571.62 2525.65,1419.41 2528,1608.69 2530.35,1359.01 2532.7,1389.42 2535.06,1309.2 2537.41,1432.84 2539.76,1423.7 2542.11,1476.07 2544.46,1334.49 2546.81,1556.87 2549.16,1362.04 2551.51,1323.63 2553.86,1455.2 2556.21,1380.44 2558.56,1651.6 2560.91,1522.71 2563.26,1325.03 2565.61,1245.29 2567.96,1441.1 2570.31,1521.8 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,789.683 224.541,879.097 226.891,818.669 229.242,924.644 231.592,933.181 233.943,919.837 236.293,842.827 238.644,792.049 240.994,868.15 243.345,827.436 245.695,969.775 248.046,1005.33 250.396,900.212 252.747,774.971 255.097,883.841 257.448,839.926 259.798,974.976 262.148,945.907 264.499,963.299 266.849,981.356 269.2,932.364 271.55,821.794 273.901,866.185 276.251,899.483 278.602,921.46 280.952,1071.71 283.303,1018.62 285.653,851.273 288.004,930.515 290.354,897.286 292.705,812.582 295.055,1076.04 297.406,1011.45 299.756,1015.2 302.107,1006.93 304.457,1168.81 306.807,850.741 309.158,1183.21 311.508,871.852 313.859,977.399 316.209,958.091 318.56,1077.71 320.91,909.242 323.261,997.598 325.611,934.058 327.962,999.337 330.312,911.651 332.663,727.35 335.013,805.379 337.364,805.372 339.714,1065.94 342.065,898.361 344.415,890.932 346.765,1129.03 349.116,951.413 351.466,971.148 353.817,838.476 356.167,962.026 358.518,862.34 360.868,914.299 363.219,785.392 365.569,954.213 367.92,941.325 370.27,933.372 372.621,940.234 374.971,939.729 377.322,1110.53 379.672,820.776 382.023,965.517 384.373,864.736 386.724,933.629 389.074,1043.04 391.424,1000.41 393.775,905.906 396.125,1005.37 398.476,964.53 400.826,986.573 403.177,802.294 405.527,772.224 407.878,956.743 410.228,1134.06 412.579,1076.16 414.929,889.521 417.28,965.641 419.63,821.984 421.981,808.906 424.331,946.904 426.682,947.95 429.032,1002.58 431.382,765.931 433.733,881.165 436.083,871.254 438.434,827.519 440.784,900.089 443.135,874.67 445.485,1003.74 447.836,967.15 450.186,841.3 452.537,896.189 454.887,916.175 457.238,989.199 459.588,998.596 461.939,925.287 464.289,1030.04 466.64,872.19 468.99,808.484 471.341,976.674 473.691,798.959 476.041,835.302 478.392,1005.34 480.742,755.029 483.093,933.469 485.443,936.288 487.794,883.781 490.144,1021.55 492.495,1092.83 494.845,845.332 497.196,806.571 499.546,927.352 501.897,1049.08 504.247,918.113 506.598,854.309 508.948,875.132 511.299,969.799 513.649,897.894 515.999,867.843 518.35,792.447 520.7,771.232 523.051,849.393 525.401,986.247 527.752,836.235 530.102,990.546 532.453,791.511 534.803,846.177 537.154,815.835 539.504,950.152 541.855,962.074 544.205,919.555 546.556,834.82 548.906,1055.09 551.257,831.585 553.607,810.383 555.958,922.114 558.308,939.892 560.658,972.473 563.009,1025.48 565.359,849.908 567.71,913.899 570.06,1027.93 572.411,906.45 574.761,723.252 577.112,859.3 579.462,1003.79 581.813,939.116 584.163,998.297 586.514,887.398 588.864,749.509 591.215,1102.3 593.565,1000.75 595.916,896.1 598.266,970.575 600.616,1056.9 602.967,909.158 605.317,1153.05 607.668,743.003 610.018,993.831 612.369,964.644 614.719,1016.75 617.07,974.553 619.42,881.97 621.771,823.901 624.121,883.042 626.472,1023.42 628.822,961.476 631.173,863.696 633.523,1003.94 635.874,1119.31 638.224,997.403 640.575,901.015 642.925,907.934 645.275,1064.57 647.626,1014.27 649.976,643.758 652.327,1045.33 654.677,863.78 657.028,1086.05 659.378,1061.48 661.729,806.814 664.079,923.434 666.43,974.672 668.78,1041.88 671.131,878.82 673.481,936.994 675.832,786.831 678.182,973.281 680.533,845.484 682.883,940.211 685.233,984.436 687.584,959.827 689.934,771.095 692.285,762.553 694.635,869.203 696.986,956.548 699.336,826.424 701.687,1050.48 704.037,1163.66 706.388,892.031 708.738,774.884 711.089,850.69 713.439,797.445 715.79,939.478 718.14,905.944 720.491,968.138 722.841,849.966 725.192,1115.12 727.542,958.441 729.892,918.45 732.243,1146.56 734.593,964.726 736.944,875.237 739.294,917.794 741.645,906.085 743.995,966.362 746.346,862.332 748.696,928.834 751.047,1001.53 753.397,970.15 755.748,875.188 758.098,947.273 760.449,881.376 762.799,927.707 765.15,995.794 767.5,662.091 769.85,998.732 772.201,971.498 774.551,927.071 776.902,753.576 779.252,950.49 781.603,846.954 783.953,921.552 786.304,876.596 788.654,837.857 791.005,814.943 793.355,887.433 795.706,1011.81 798.056,988.216 800.407,945.603 802.757,903.851 805.108,1061.7 807.458,1106.96 809.809,832.003 812.159,905.291 814.509,1099.1 816.86,949.865 819.21,751.708 821.561,711.867 823.911,973.186 826.262,1095.83 828.612,1142.45 830.963,887.022 833.313,993.885 835.664,915.044 838.014,799.171 840.365,950.153 842.715,899.165 845.066,1066.88 847.416,1102.4 849.767,1034.34 852.117,855.501 854.467,1054.61 856.818,931.403 859.168,905.011 861.519,961.759 863.869,938.745 866.22,988.32 868.57,871.681 870.921,997.97 873.271,892.061 875.622,850.411 877.972,840.841 880.323,784.949 882.673,855.866 885.024,864.241 887.374,1058.88 889.725,897.6 892.075,905.473 894.426,791.879 896.776,1077.64 899.126,814.144 901.477,1048.44 903.827,948.462 906.178,829.884 908.528,1145.12 910.879,1093.39 913.229,845.181 915.58,714.854 917.93,1032.19 920.281,848.953 922.631,978.807 924.982,982.272 927.332,813.597 929.683,1066.47 932.033,946.349 934.384,920.197 936.734,1031.94 939.084,911.165 941.435,884.793 943.785,844.073 946.136,927.537 948.486,911.452 950.837,858.091 953.187,808.526 955.538,1112 957.888,904.903 960.239,932.277 962.589,813.859 964.94,926.405 967.29,806.643 969.641,926.024 971.991,1106.47 974.342,943.862 976.692,926.381 979.043,843.553 981.393,986.976 983.743,1114.42 986.094,976.567 988.444,1133.94 990.795,899.243 993.145,912.335 995.496,912.592 997.846,892.197 1000.2,1055.41 1002.55,986.128 1004.9,932.481 1007.25,963.656 1009.6,921.968 1011.95,965.931 1014.3,865.683 1016.65,916.317 1019,893.581 1021.35,786.305 1023.7,820.242 1026.05,955.028 1028.4,873.27 1030.75,1191.02 1033.1,1016.55 1035.45,833.662 1037.8,829.001 1040.15,1029.64 1042.51,1061.61 1044.86,882.47 1047.21,886.057 1049.56,927.801 1051.91,1027.25 1054.26,875.001 1056.61,915.015 1058.96,1037.54 1061.31,804.484 1063.66,1053.53 1066.01,969.461 1068.36,1155.92 1070.71,1061.39 1073.06,875.381 1075.41,680.128 1077.76,866.577 1080.11,994.625 1082.46,861.524 1084.81,1081.74 1087.16,918.367 1089.51,829.119 1091.87,1030.33 1094.22,813.549 1096.57,890.334 1098.92,955.337 1101.27,1059.4 1103.62,847.542 1105.97,945.215 1108.32,859.86 1110.67,820.034 1113.02,874.361 1115.37,942.659 1117.72,921.218 1120.07,902.146 1122.42,824.295 1124.77,971.031 1127.12,730.35 1129.47,1036.45 1131.82,964.245 1134.17,898.013 1136.52,909.875 1138.87,974.141 1141.23,1030.23 1143.58,908.287 1145.93,851.791 1148.28,1045.75 1150.63,889.353 1152.98,971.763 1155.33,951.773 1157.68,894.884 1160.03,801.866 1162.38,915.676 1164.73,1221.82 1167.08,800.366 1169.43,872.636 1171.78,919.808 1174.13,934.727 1176.48,934.869 1178.83,777.855 1181.18,1120.9 1183.53,847.933 1185.88,879.707 1188.23,788.725 1190.59,799.137 1192.94,764.957 1195.29,991.883 1197.64,931.563 1199.99,893.835 1202.34,909.998 1204.69,846.859 1207.04,839.739 1209.39,929.312 1211.74,994.989 1214.09,1036.69 1216.44,785.081 1218.79,875.817 1221.14,897.434 1223.49,805.47 1225.84,989.53 1228.19,1065.8 1230.54,1097.13 1232.89,1008.4 1235.24,897.075 1237.59,704.033 1239.94,1035.93 1242.3,870.275 1244.65,988.947 1247,1022.62 1249.35,1019.21 1251.7,886.912 1254.05,879.385 1256.4,782.642 1258.75,826.851 1261.1,913.568 1263.45,939.592 1265.8,1014.12 1268.15,986.101 1270.5,598.678 1272.85,1040.61 1275.2,1102.08 1277.55,876.872 1279.9,967.945 1282.25,967.446 1284.6,981.332 1286.95,917.454 1289.3,1037.19 1291.66,749.765 1294.01,890.454 1296.36,877.631 1298.71,964.469 1301.06,1156.3 1303.41,765.279 1305.76,898.071 1308.11,994.56 1310.46,930.8 1312.81,916.127 1315.16,954.566 1317.51,934.576 1319.86,882.335 1322.21,1002.36 1324.56,895.866 1326.91,829.462 1329.26,1026.88 1331.61,802.945 1333.96,793.005 1336.31,926.809 1338.66,970.023 1341.02,874.036 1343.37,801.755 1345.72,756.951 1348.07,912.938 1350.42,759.205 1352.77,868.408 1355.12,1083.47 1357.47,866.115 1359.82,990.595 1362.17,861.473 1364.52,948.617 1366.87,809.24 1369.22,865.206 1371.57,787.218 1373.92,996.479 1376.27,1166.4 1378.62,1043.25 1380.97,864.458 1383.32,788.835 1385.67,965.999 1388.02,925.137 1390.38,904.122 1392.73,971.402 1395.08,998.972 1397.43,911.759 1399.78,1008.35 1402.13,905.486 1404.48,842.492 1406.83,927.854 1409.18,792.254 1411.53,929.416 1413.88,832.183 1416.23,912.099 1418.58,1005.66 1420.93,825.332 1423.28,1102.09 1425.63,964.548 1427.98,783.839 1430.33,854.832 1432.68,1046.19 1435.03,1018.52 1437.38,818.192 1439.74,898.266 1442.09,800.821 1444.44,704.395 1446.79,870.092 1449.14,885.241 1451.49,823.314 1453.84,846.366 1456.19,921.614 1458.54,884.433 1460.89,882.912 1463.24,920.903 1465.59,870.852 1467.94,914.862 1470.29,955.638 1472.64,1002.77 1474.99,863.307 1477.34,1053.28 1479.69,936.152 1482.04,1008.77 1484.39,1088.8 1486.74,971.441 1489.1,906.009 1491.45,817.037 1493.8,944.688 1496.15,984.834 1498.5,1147.56 1500.85,953.962 1503.2,951.906 1505.55,984.427 1507.9,1130.92 1510.25,879.913 1512.6,725.456 1514.95,919.667 1517.3,883.484 1519.65,906.518 1522,1019.81 1524.35,908.698 1526.7,1171.73 1529.05,697.503 1531.4,842.574 1533.75,840.499 1536.1,930.828 1538.45,984.371 1540.81,1078.23 1543.16,881.636 1545.51,937.046 1547.86,947.196 1550.21,960.839 1552.56,765.949 1554.91,847.678 1557.26,997.384 1559.61,825.429 1561.96,858.957 1564.31,940.452 1566.66,971.469 1569.01,1101.66 1571.36,834.774 1573.71,823.449 1576.06,1000.5 1578.41,878.268 1580.76,889.483 1583.11,888.524 1585.46,893.073 1587.81,1021.86 1590.17,803.554 1592.52,962.739 1594.87,849.683 1597.22,794.103 1599.57,945.492 1601.92,777.17 1604.27,763.241 1606.62,822.217 1608.97,1019.5 1611.32,1082.98 1613.67,956.892 1616.02,902.579 1618.37,982.529 1620.72,817.417 1623.07,970.174 1625.42,874.453 1627.77,945.63 1630.12,866.738 1632.47,1042.45 1634.82,1050.97 1637.17,933.787 1639.53,1076.29 1641.88,867.534 1644.23,895.808 1646.58,937.155 1648.93,928.038 1651.28,930.266 1653.63,811.275 1655.98,905.338 1658.33,878.735 1660.68,928.201 1663.03,1018.37 1665.38,951.22 1667.73,986.162 1670.08,989.333 1672.43,879.8 1674.78,1009.42 1677.13,886.027 1679.48,1091.78 1681.83,957.854 1684.18,1135.32 1686.53,935.768 1688.89,760.874 1691.24,749.999 1693.59,865.794 1695.94,856.548 1698.29,773.505 1700.64,875.038 1702.99,972.398 1705.34,888.951 1707.69,936.3 1710.04,890.097 1712.39,893.034 1714.74,798.546 1717.09,962.455 1719.44,931.964 1721.79,777.703 1724.14,1042.14 1726.49,849.287 1728.84,965.67 1731.19,875.288 1733.54,875.396 1735.89,903.561 1738.25,966.897 1740.6,826.314 1742.95,974.299 1745.3,934.304 1747.65,838.26 1750,1070.27 1752.35,961.804 1754.7,829.872 1757.05,625.735 1759.4,745.429 1761.75,999.609 1764.1,946.575 1766.45,717.478 1768.8,889.701 1771.15,1066.33 1773.5,733.723 1775.85,890.849 1778.2,968.255 1780.55,999.197 1782.9,921.349 1785.25,941.808 1787.6,829.106 1789.96,991.491 1792.31,932.86 1794.66,705.086 1797.01,872.464 1799.36,893.294 1801.71,851.907 1804.06,980.156 1806.41,1056.47 1808.76,946.352 1811.11,752.656 1813.46,838.469 1815.81,998.925 1818.16,873.522 1820.51,783.831 1822.86,975.748 1825.21,847.078 1827.56,945.549 1829.91,947.401 1832.26,883.782 1834.61,1052.4 1836.96,864.997 1839.32,766.244 1841.67,999.735 1844.02,888.622 1846.37,824.755 1848.72,864.985 1851.07,1026.17 1853.42,680.295 1855.77,663.483 1858.12,1015.87 1860.47,810.559 1862.82,968.259 1865.17,959.65 1867.52,992.937 1869.87,993.904 1872.22,884.724 1874.57,1026.76 1876.92,835.505 1879.27,880.422 1881.62,1096.02 1883.97,851.867 1886.32,1079.51 1888.68,818.92 1891.03,883.938 1893.38,848.318 1895.73,921.553 1898.08,935.619 1900.43,776.943 1902.78,836.432 1905.13,786.996 1907.48,926.266 1909.83,1080.37 1912.18,859.955 1914.53,660.386 1916.88,891.392 1919.23,1043.66 1921.58,819.421 1923.93,1037.29 1926.28,880.306 1928.63,875.45 1930.98,950.401 1933.33,854.268 1935.68,841.197 1938.04,950.554 1940.39,1088.49 1942.74,991.092 1945.09,1001.32 1947.44,894.162 1949.79,947.433 1952.14,767.677 1954.49,959.868 1956.84,989.769 1959.19,884.272 1961.54,1010.28 1963.89,1050.04 1966.24,899.563 1968.59,1063.12 1970.94,784.315 1973.29,715.004 1975.64,990.155 1977.99,898.535 1980.34,1047.87 1982.69,939.74 1985.04,922.842 1987.4,874.143 1989.75,957.957 1992.1,982.941 1994.45,949.074 1996.8,852.431 1999.15,899.312 2001.5,872.953 2003.85,1071.3 2006.2,892.085 2008.55,824.25 2010.9,884.295 2013.25,967.803 2015.6,810.819 2017.95,901.032 2020.3,963.022 2022.65,980.044 2025,852.063 2027.35,1080.63 2029.7,778.344 2032.05,1018.71 2034.4,965.08 2036.76,845.091 2039.11,969.037 2041.46,767.507 2043.81,1052.7 2046.16,887.545 2048.51,966.504 2050.86,973.417 2053.21,947.055 2055.56,759.905 2057.91,776.853 2060.26,1149.57 2062.61,985.961 2064.96,1040.95 2067.31,1014.31 2069.66,968.71 2072.01,874.09 2074.36,837.126 2076.71,960.452 2079.06,1029.96 2081.41,1101.68 2083.76,1029.27 2086.11,926.64 2088.47,924.499 2090.82,1256.95 2093.17,1018.68 2095.52,913.973 2097.87,967.732 2100.22,966.421 2102.57,912.117 2104.92,862.556 2107.27,787.449 2109.62,893.77 2111.97,958.659 2114.32,867.536 2116.67,780.882 2119.02,915.879 2121.37,930.37 2123.72,705.103 2126.07,997.924 2128.42,1027.3 2130.77,889.977 2133.12,954.605 2135.47,875.357 2137.83,832.036 2140.18,1006.79 2142.53,970.35 2144.88,869.573 2147.23,777.795 2149.58,841.192 2151.93,1048.7 2154.28,893.725 2156.63,1155.59 2158.98,940.798 2161.33,774.931 2163.68,1000.74 2166.03,764.06 2168.38,1128.87 2170.73,906.55 2173.08,844.462 2175.43,1046.37 2177.78,907.23 2180.13,811.798 2182.48,919.076 2184.83,969.814 2187.19,988.309 2189.54,785.402 2191.89,1013.11 2194.24,964.665 2196.59,935.056 2198.94,949.145 2201.29,723.619 2203.64,1050.31 2205.99,1018.43 2208.34,873.028 2210.69,1014.75 2213.04,920.166 2215.39,876.609 2217.74,851.936 2220.09,869.204 2222.44,738.242 2224.79,877.55 2227.14,859.516 2229.49,917.143 2231.84,883.261 2234.19,881.912 2236.55,821.753 2238.9,959.573 2241.25,1126.94 2243.6,1068.45 2245.95,941.095 2248.3,1006.91 2250.65,822.228 2253,1028.35 2255.35,758.323 2257.7,1034.11 2260.05,904.888 2262.4,840.09 2264.75,1106.28 2267.1,980.4 2269.45,640.423 2271.8,898.903 2274.15,953.027 2276.5,916.415 2278.85,924.48 2281.2,851.394 2283.55,987 2285.91,910.546 2288.26,1012.2 2290.61,964.231 2292.96,897.405 2295.31,898.928 2297.66,1039.5 2300.01,898.509 2302.36,851.353 2304.71,883.168 2307.06,815.639 2309.41,838.209 2311.76,853.283 2314.11,887.619 2316.46,1011.34 2318.81,918.174 2321.16,738.218 2323.51,1004.9 2325.86,736.032 2328.21,1173.55 2330.56,785.665 2332.91,842.043 2335.27,897.369 2337.62,825.668 2339.97,941.513 2342.32,800.59 2344.67,900.622 2347.02,862.427 2349.37,891.083 2351.72,1003.86 2354.07,1139.86 2356.42,809.206 2358.77,961.287 2361.12,1017.78 2363.47,811.528 2365.82,892.497 2368.17,748.408 2370.52,971.038 2372.87,837.404 2375.22,797.068 2377.57,831.444 2379.92,1036.79 2382.27,943.677 2384.62,993.184 2386.98,991.612 2389.33,1075.79 2391.68,984.677 2394.03,1007.59 2396.38,893.145 2398.73,865.46 2401.08,931.67 2403.43,1034.08 2405.78,1067.7 2408.13,854.137 2410.48,853.77 2412.83,825.385 2415.18,848.468 2417.53,806.359 2419.88,716.364 2422.23,873.988 2424.58,838.649 2426.93,982.409 2429.28,1010.37 2431.63,744.915 2433.98,862.819 2436.34,1127.29 2438.69,743.45 2441.04,1014.47 2443.39,838.376 2445.74,1089.78 2448.09,898.091 2450.44,952.357 2452.79,1011.86 2455.14,961.735 2457.49,987.293 2459.84,903.083 2462.19,879.27 2464.54,889.323 2466.89,1040.44 2469.24,887.514 2471.59,835.545 2473.94,846.292 2476.29,889.163 2478.64,908.111 2480.99,978.053 2483.34,875.829 2485.7,929.398 2488.05,771.804 2490.4,920.13 2492.75,944.159 2495.1,900.778 2497.45,1016.83 2499.8,823.762 2502.15,857.626 2504.5,979.39 2506.85,898.348 2509.2,1021.52 2511.55,886.324 2513.9,974.197 2516.25,917.446 2518.6,899.257 2520.95,888.09 2523.3,1011.98 2525.65,965.206 2528,996.075 2530.35,1053.09 2532.7,952.597 2535.06,630.215 2537.41,953.693 2539.76,773.013 2542.11,888.862 2544.46,874.77 2546.81,1038.1 2549.16,1011.33 2551.51,1001.16 2553.86,849.377 2556.21,991.521 2558.56,889.486 2560.91,850.285 2563.26,1005.65 2565.61,1136.04 2567.96,919.061 2570.31,1140.93 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,691.879 224.541,485.269 226.891,508.581 229.242,326.873 231.592,564.785 233.943,498.227 236.293,375.415 238.644,469.706 240.994,256.09 243.345,325.238 245.695,531.139 248.046,449.795 250.396,397.583 252.747,309.835 255.097,478.207 257.448,527.544 259.798,502.563 262.148,376.155 264.499,552.97 266.849,503.791 269.2,522.077 271.55,285.719 273.901,366.467 276.251,488.846 278.602,492.659 280.952,346.977 283.303,292.06 285.653,717.164 288.004,538.496 290.354,330.844 292.705,458.368 295.055,444.271 297.406,340.404 299.756,527.369 302.107,398.112 304.457,599.924 306.807,451.541 309.158,505.115 311.508,485.993 313.859,601.406 316.209,724.607 318.56,395.318 320.91,168.959 323.261,413.55 325.611,521.766 327.962,282.462 330.312,471.606 332.663,462.765 335.013,329.84 337.364,448.02 339.714,415.663 342.065,272.606 344.415,356.373 346.765,427.158 349.116,242.059 351.466,220.271 353.817,526.724 356.167,400.168 358.518,405.857 360.868,523.434 363.219,534.887 365.569,277.401 367.92,377.217 370.27,500.287 372.621,444.778 374.971,422.643 377.322,559.838 379.672,510.407 382.023,347.629 384.373,416.727 386.724,537.485 389.074,549.316 391.424,525.069 393.775,417.944 396.125,413.207 398.476,369.985 400.826,465.653 403.177,556.809 405.527,358.216 407.878,372.255 410.228,379.859 412.579,254.871 414.929,425.556 417.28,438.374 419.63,314.251 421.981,361.203 424.331,434.617 426.682,376.298 429.032,439.644 431.382,345.611 433.733,569.909 436.083,233.66 438.434,540.422 440.784,337.757 443.135,507.113 445.485,417.399 447.836,457.928 450.186,599.226 452.537,326.958 454.887,309.977 457.238,414.349 459.588,483.81 461.939,571.313 464.289,426.825 466.64,368.256 468.99,467.919 471.341,376.396 473.691,215.644 476.041,407.627 478.392,321.626 480.742,518.515 483.093,527.397 485.443,294.72 487.794,411.026 490.144,335.356 492.495,258.774 494.845,373.438 497.196,142.118 499.546,509.851 501.897,442.304 504.247,587.324 506.598,460.024 508.948,471.435 511.299,439.186 513.649,314.244 515.999,520.565 518.35,366.61 520.7,366.312 523.051,297.532 525.401,439.593 527.752,295.123 530.102,569.791 532.453,519.955 534.803,373.494 537.154,495.838 539.504,388.558 541.855,439.259 544.205,357.057 546.556,347.723 548.906,426.469 551.257,324.981 553.607,455.161 555.958,518.512 558.308,453.56 560.658,354.75 563.009,526.923 565.359,263.711 567.71,487.933 570.06,370.881 572.411,471.626 574.761,367.162 577.112,447.493 579.462,492.344 581.813,406.58 584.163,267.024 586.514,469.592 588.864,351.832 591.215,394.348 593.565,461.185 595.916,584.74 598.266,331.707 600.616,357.96 602.967,332.031 605.317,278.692 607.668,286.04 610.018,334.51 612.369,331.177 614.719,446.928 617.07,557.23 619.42,287.143 621.771,599.415 624.121,422.163 626.472,359.017 628.822,353.396 631.173,361.375 633.523,597.192 635.874,518.631 638.224,481.137 640.575,420.065 642.925,407.526 645.275,360.672 647.626,441.755 649.976,321.805 652.327,490.762 654.677,523.673 657.028,425.767 659.378,454.624 661.729,535.447 664.079,495.335 666.43,350.254 668.78,197.523 671.131,453.905 673.481,534.559 675.832,339.965 678.182,315.698 680.533,378.309 682.883,456.446 685.233,520.197 687.584,355.741 689.934,407.711 692.285,472.179 694.635,468.451 696.986,499.887 699.336,635.009 701.687,314.267 704.037,481.602 706.388,359.588 708.738,373.602 711.089,426.794 713.439,431.777 715.79,399.947 718.14,347.92 720.491,445.02 722.841,459.585 725.192,421.777 727.542,436.075 729.892,342.175 732.243,347.865 734.593,393.351 736.944,444.62 739.294,549.447 741.645,377.258 743.995,466.183 746.346,494.03 748.696,367.61 751.047,488.019 753.397,452.028 755.748,460.356 758.098,554.299 760.449,386.625 762.799,391.898 765.15,674.203 767.5,437.905 769.85,299.835 772.201,463.294 774.551,434.018 776.902,511.286 779.252,473.334 781.603,461.679 783.953,410.99 786.304,346.164 788.654,365.794 791.005,433.082 793.355,377.304 795.706,454.673 798.056,445.991 800.407,391.402 802.757,582.782 805.108,346.031 807.458,327.567 809.809,172.228 812.159,438.423 814.509,380.756 816.86,410.192 819.21,487.59 821.561,499.086 823.911,542.642 826.262,408.475 828.612,346.078 830.963,528.109 833.313,491.534 835.664,234.947 838.014,290.241 840.365,404.149 842.715,416.77 845.066,382.86 847.416,508.897 849.767,294.936 852.117,509.955 854.467,496.518 856.818,404.335 859.168,411.633 861.519,259.039 863.869,548.201 866.22,454.526 868.57,450.663 870.921,437.296 873.271,323.012 875.622,439.003 877.972,463.374 880.323,525.915 882.673,477.979 885.024,369.638 887.374,479.505 889.725,550.056 892.075,463.412 894.426,377.256 896.776,478.528 899.126,546.381 901.477,662.309 903.827,384.789 906.178,394.307 908.528,384.811 910.879,453.804 913.229,487.09 915.58,503.312 917.93,373.177 920.281,569.924 922.631,358.656 924.982,433.853 927.332,529.84 929.683,408.955 932.033,369.546 934.384,287.432 936.734,403.321 939.084,519.971 941.435,378.4 943.785,422.888 946.136,359.825 948.486,340.339 950.837,411.974 953.187,476.433 955.538,532.777 957.888,364.972 960.239,352.204 962.589,507.713 964.94,555.719 967.29,500.946 969.641,317.481 971.991,390.92 974.342,396.811 976.692,546.52 979.043,427.751 981.393,389.222 983.743,687.546 986.094,397.745 988.444,613.5 990.795,308.934 993.145,494.585 995.496,481.383 997.846,540.661 1000.2,386.141 1002.55,464.979 1004.9,678.969 1007.25,468.163 1009.6,523.304 1011.95,264.385 1014.3,510.818 1016.65,374.272 1019,471.886 1021.35,326.391 1023.7,305.436 1026.05,354.076 1028.4,399.436 1030.75,417.145 1033.1,406.295 1035.45,589.436 1037.8,352.969 1040.15,333.24 1042.51,475.716 1044.86,410.482 1047.21,460.3 1049.56,435.126 1051.91,494.666 1054.26,465.869 1056.61,466.446 1058.96,362.541 1061.31,502.933 1063.66,217.235 1066.01,298.787 1068.36,525.371 1070.71,409.413 1073.06,319.178 1075.41,480.203 1077.76,380.044 1080.11,580.354 1082.46,449.084 1084.81,536.507 1087.16,478.458 1089.51,432.751 1091.87,394.616 1094.22,511.133 1096.57,448.548 1098.92,408.456 1101.27,358.469 1103.62,454.192 1105.97,559.985 1108.32,571.621 1110.67,371.009 1113.02,421.653 1115.37,328.774 1117.72,358.586 1120.07,308.542 1122.42,475.149 1124.77,452.871 1127.12,493.428 1129.47,353.67 1131.82,370.868 1134.17,472.522 1136.52,404.99 1138.87,436.226 1141.23,285.233 1143.58,392.613 1145.93,472.18 1148.28,481.739 1150.63,535.753 1152.98,243.357 1155.33,518.825 1157.68,441.832 1160.03,331.702 1162.38,403.423 1164.73,384.385 1167.08,540.022 1169.43,417.46 1171.78,426.068 1174.13,533.355 1176.48,420.427 1178.83,439.951 1181.18,407.691 1183.53,426.845 1185.88,281.775 1188.23,498.486 1190.59,376.263 1192.94,473.378 1195.29,427.818 1197.64,486.099 1199.99,548.134 1202.34,360.683 1204.69,392.692 1207.04,706.384 1209.39,356.672 1211.74,478.249 1214.09,304.24 1216.44,347.042 1218.79,517.101 1221.14,489.155 1223.49,553.773 1225.84,467.795 1228.19,684.418 1230.54,373.131 1232.89,373.831 1235.24,530.97 1237.59,523.506 1239.94,465.207 1242.3,497.397 1244.65,372.774 1247,494.854 1249.35,431.263 1251.7,511.415 1254.05,490.862 1256.4,425.212 1258.75,507.125 1261.1,186.883 1263.45,431.536 1265.8,318.355 1268.15,429.379 1270.5,342.71 1272.85,146.62 1275.2,340.239 1277.55,321.779 1279.9,606.985 1282.25,493.351 1284.6,489.699 1286.95,474.895 1289.3,429.257 1291.66,503.885 1294.01,236.51 1296.36,534.468 1298.71,380.679 1301.06,339.53 1303.41,494.088 1305.76,524.306 1308.11,361.323 1310.46,585.795 1312.81,367.426 1315.16,453.292 1317.51,550.645 1319.86,400.248 1322.21,535.319 1324.56,380.906 1326.91,396.208 1329.26,315.56 1331.61,499.464 1333.96,405.964 1336.31,383.759 1338.66,461.792 1341.02,535.249 1343.37,269.87 1345.72,580.948 1348.07,392.24 1350.42,389.463 1352.77,447.177 1355.12,376.028 1357.47,433.977 1359.82,469.242 1362.17,524.392 1364.52,569.953 1366.87,463.146 1369.22,305.389 1371.57,346.433 1373.92,436.779 1376.27,454.801 1378.62,444.574 1380.97,384.492 1383.32,421.997 1385.67,495.761 1388.02,442.779 1390.38,570.057 1392.73,436.996 1395.08,358.491 1397.43,326.068 1399.78,452.193 1402.13,566.356 1404.48,544.897 1406.83,398.829 1409.18,545.578 1411.53,460.168 1413.88,383.473 1416.23,664.234 1418.58,590.699 1420.93,607.365 1423.28,531.531 1425.63,627.851 1427.98,422.699 1430.33,403.359 1432.68,532.927 1435.03,528.432 1437.38,431.456 1439.74,439.552 1442.09,280.137 1444.44,363.593 1446.79,381.14 1449.14,458.039 1451.49,466.852 1453.84,508.659 1456.19,333.512 1458.54,403.896 1460.89,461.806 1463.24,555.885 1465.59,394.114 1467.94,323.173 1470.29,367.692 1472.64,528.561 1474.99,406.688 1477.34,523.911 1479.69,451.047 1482.04,435.779 1484.39,440.525 1486.74,398.941 1489.1,403.289 1491.45,345.932 1493.8,520.901 1496.15,497.221 1498.5,388.017 1500.85,491.243 1503.2,492.55 1505.55,303.771 1507.9,496.889 1510.25,532.934 1512.6,361.713 1514.95,413.196 1517.3,397.997 1519.65,394.178 1522,517.704 1524.35,376.143 1526.7,326.854 1529.05,378.261 1531.4,566.751 1533.75,544.397 1536.1,539.943 1538.45,274.56 1540.81,339.244 1543.16,510.894 1545.51,414.98 1547.86,511.116 1550.21,386.72 1552.56,538.675 1554.91,251.511 1557.26,318.444 1559.61,336.589 1561.96,339.927 1564.31,468.372 1566.66,491.746 1569.01,551.157 1571.36,237.047 1573.71,417.962 1576.06,530.011 1578.41,584.348 1580.76,462.502 1583.11,302.819 1585.46,669.114 1587.81,474.15 1590.17,526.516 1592.52,492.166 1594.87,369.677 1597.22,334.267 1599.57,548.991 1601.92,401.328 1604.27,264.104 1606.62,287.842 1608.97,526.801 1611.32,421.832 1613.67,557.342 1616.02,452.529 1618.37,459.226 1620.72,382.952 1623.07,518.86 1625.42,434.519 1627.77,306.896 1630.12,381.457 1632.47,363.496 1634.82,326.038 1637.17,458.223 1639.53,295.739 1641.88,512.291 1644.23,538.533 1646.58,482.135 1648.93,495.765 1651.28,474.668 1653.63,429.956 1655.98,217.86 1658.33,460.231 1660.68,391.656 1663.03,491.809 1665.38,365.212 1667.73,462.66 1670.08,512.193 1672.43,265.508 1674.78,488.173 1677.13,471.675 1679.48,455.011 1681.83,511.441 1684.18,582.83 1686.53,547.379 1688.89,548.037 1691.24,450.283 1693.59,313.107 1695.94,450.623 1698.29,365.914 1700.64,449.959 1702.99,455.2 1705.34,410.071 1707.69,483.837 1710.04,364.472 1712.39,322.251 1714.74,416.64 1717.09,512.917 1719.44,444.988 1721.79,554.58 1724.14,319.657 1726.49,465.255 1728.84,469.156 1731.19,438.379 1733.54,418.653 1735.89,513.271 1738.25,483.641 1740.6,365.164 1742.95,332.496 1745.3,311.84 1747.65,528.108 1750,248.933 1752.35,575.886 1754.7,493.849 1757.05,319.311 1759.4,416.29 1761.75,530.922 1764.1,586.232 1766.45,364.089 1768.8,601.911 1771.15,402.98 1773.5,439.185 1775.85,425.545 1778.2,399.839 1780.55,443.186 1782.9,396.484 1785.25,453.269 1787.6,518.157 1789.96,416.849 1792.31,529.426 1794.66,313.854 1797.01,385.009 1799.36,420.58 1801.71,300.495 1804.06,538.675 1806.41,510.318 1808.76,496.892 1811.11,339.498 1813.46,391.556 1815.81,457.516 1818.16,537.507 1820.51,359.357 1822.86,472.409 1825.21,387.984 1827.56,384.265 1829.91,385.758 1832.26,555.674 1834.61,368.091 1836.96,293.215 1839.32,433.519 1841.67,444.68 1844.02,329.596 1846.37,547.026 1848.72,295.357 1851.07,330.097 1853.42,215.802 1855.77,511.496 1858.12,449.076 1860.47,600.65 1862.82,440.121 1865.17,285.327 1867.52,330.032 1869.87,409.121 1872.22,534.059 1874.57,580.199 1876.92,363.079 1879.27,355.023 1881.62,538.308 1883.97,401.934 1886.32,384.627 1888.68,373.877 1891.03,430.615 1893.38,468.122 1895.73,494.018 1898.08,384.456 1900.43,501.526 1902.78,431.496 1905.13,467.029 1907.48,96.8724 1909.83,329.496 1912.18,474.947 1914.53,509.396 1916.88,404.182 1919.23,502.196 1921.58,359.384 1923.93,367.547 1926.28,316.206 1928.63,420.32 1930.98,331.874 1933.33,506.68 1935.68,434.994 1938.04,490.364 1940.39,728.871 1942.74,488.989 1945.09,503.482 1947.44,371.831 1949.79,379.904 1952.14,435.674 1954.49,547.239 1956.84,593.914 1959.19,395.445 1961.54,571.101 1963.89,596.058 1966.24,323.117 1968.59,409.512 1970.94,455.09 1973.29,487.974 1975.64,450.065 1977.99,292.92 1980.34,454.427 1982.69,544.515 1985.04,398.799 1987.4,396.228 1989.75,471.14 1992.1,291.169 1994.45,494.725 1996.8,395.952 1999.15,531.377 2001.5,391.586 2003.85,519.49 2006.2,500.439 2008.55,398.852 2010.9,547.75 2013.25,215.399 2015.6,296.395 2017.95,515.896 2020.3,521.753 2022.65,523.807 2025,440.17 2027.35,438.244 2029.7,556.064 2032.05,313.213 2034.4,457.223 2036.76,382.949 2039.11,464.16 2041.46,448.623 2043.81,412.528 2046.16,336.969 2048.51,443.688 2050.86,359.761 2053.21,405.644 2055.56,430.285 2057.91,529.165 2060.26,325.011 2062.61,670.65 2064.96,465.289 2067.31,587.877 2069.66,504.924 2072.01,588.316 2074.36,580.325 2076.71,553.598 2079.06,548.914 2081.41,516.705 2083.76,510.041 2086.11,427.719 2088.47,385.01 2090.82,297.731 2093.17,392.215 2095.52,296.947 2097.87,411.96 2100.22,408.783 2102.57,523.457 2104.92,423.246 2107.27,258.258 2109.62,496.831 2111.97,449.555 2114.32,194.325 2116.67,288.386 2119.02,440.002 2121.37,417.236 2123.72,378.252 2126.07,351.941 2128.42,587.293 2130.77,810.929 2133.12,545.902 2135.47,531.059 2137.83,414.949 2140.18,327.734 2142.53,376.707 2144.88,509.528 2147.23,494.706 2149.58,393.84 2151.93,563.753 2154.28,438.778 2156.63,416.826 2158.98,386.06 2161.33,390.821 2163.68,466.176 2166.03,486.904 2168.38,434.805 2170.73,435.358 2173.08,487.512 2175.43,334.624 2177.78,476.005 2180.13,346.3 2182.48,346.55 2184.83,594.915 2187.19,551.774 2189.54,437.905 2191.89,490.071 2194.24,508.176 2196.59,220.669 2198.94,496.047 2201.29,262.215 2203.64,524.214 2205.99,390.237 2208.34,432.933 2210.69,438.066 2213.04,461.362 2215.39,367.588 2217.74,436.741 2220.09,480.881 2222.44,543.503 2224.79,602.7 2227.14,405.426 2229.49,294.396 2231.84,427.611 2234.19,493.496 2236.55,269.677 2238.9,513.49 2241.25,276.453 2243.6,295.306 2245.95,253.521 2248.3,585.39 2250.65,453.935 2253,601.765 2255.35,283.535 2257.7,322.349 2260.05,393.306 2262.4,431.375 2264.75,287.844 2267.1,548.904 2269.45,311.388 2271.8,316.659 2274.15,501.179 2276.5,404.233 2278.85,471.927 2281.2,402.48 2283.55,450.866 2285.91,420.2 2288.26,406.832 2290.61,443.298 2292.96,337.637 2295.31,582.985 2297.66,678.035 2300.01,337.186 2302.36,411.73 2304.71,388.524 2307.06,668.667 2309.41,492.563 2311.76,353.841 2314.11,425.927 2316.46,359.698 2318.81,348.384 2321.16,343.598 2323.51,296.002 2325.86,551.014 2328.21,530.445 2330.56,486.368 2332.91,488.974 2335.27,434.366 2337.62,340.181 2339.97,477.058 2342.32,445.712 2344.67,443.952 2347.02,472.845 2349.37,645.303 2351.72,314.571 2354.07,463.644 2356.42,341.358 2358.77,361.674 2361.12,517.754 2363.47,538.406 2365.82,351.511 2368.17,500.085 2370.52,412.691 2372.87,484.32 2375.22,534.706 2377.57,274.822 2379.92,515.746 2382.27,529.91 2384.62,524.095 2386.98,424.379 2389.33,381.318 2391.68,435.691 2394.03,505.318 2396.38,505.487 2398.73,179.114 2401.08,357.575 2403.43,439.348 2405.78,525.653 2408.13,448.19 2410.48,382.74 2412.83,596.836 2415.18,510.548 2417.53,424.817 2419.88,396.415 2422.23,472.467 2424.58,379.024 2426.93,253.259 2429.28,278.132 2431.63,583.256 2433.98,317.875 2436.34,517.789 2438.69,339.487 2441.04,224.103 2443.39,482.261 2445.74,500.881 2448.09,253.071 2450.44,307.661 2452.79,406.589 2455.14,361.131 2457.49,447.97 2459.84,502.86 2462.19,498.685 2464.54,394.536 2466.89,399.818 2469.24,316.841 2471.59,237.648 2473.94,593.34 2476.29,528.857 2478.64,442.623 2480.99,303.002 2483.34,308.379 2485.7,186.609 2488.05,414.784 2490.4,411.966 2492.75,420.545 2495.1,491.16 2497.45,453.127 2499.8,484.012 2502.15,277.366 2504.5,528.562 2506.85,609.898 2509.2,343.248 2511.55,522.417 2513.9,515.332 2516.25,457.912 2518.6,521.913 2520.95,436.303 2523.3,595.327 2525.65,427.054 2528,320.945 2530.35,619.051 2532.7,525.8 2535.06,446.803 2537.41,335.952 2539.76,309.529 2542.11,582.904 2544.46,370.741 2546.81,504.201 2549.16,519.515 2551.51,453.361 2553.86,300.119 2556.21,395.22 2558.56,568.721 2560.91,378.867 2563.26,237.912 2565.61,371.57 2567.96,390.479 2570.31,317.822 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.84753   -2.6991  -4.07596  -3.5895   …  -5.44703   -5.44703   -4.77286
  0.464015   1.2077   2.8243    2.86788     -0.705848  -0.705848  -1.05326
  2.68858    3.9992   5.52477   5.91218      4.27462    4.27462    7.03356

[:, :, 2] =
 -2.87899  -3.91555   -3.91555   -4.49439  …  -4.59021  -4.59021  -4.59021
 -0.69744  -0.464627  -0.464627  -1.14302     -1.20568  -1.20568  -1.20568
  1.8242    4.37101    4.37101    4.14459      3.94677   3.94677   3.94677

[:, :, 3] =
 -1.95219  -4.03668  -3.85303   -4.68124  …  -5.72209  -5.72209  -5.37448
 -2.71373  -3.05533  -0.940929  -0.83099      0.62091   0.62091   0.399437
  1.15999   3.78611   4.50473    5.63672      4.72222   4.72222   4.15101

[:, :, 4] =
 -2.29216   -2.62916   -3.924    -5.05214  …  -3.7351    -4.85853   -4.24142
 -0.195776  -0.694099  -1.31797  -1.19287     -0.942741   0.597128  -0.261346
  4.2897     4.56489    4.65209   6.12941      5.10753    4.37394    3.78518</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9857      0.985419
  0.00709931  0.9925
  5.01975     0.997934</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.57 seconds
Compute duration  = 2.57 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9911    0.9990    0.0182   3013.0155   5307.6058    1.0001   ⋯
        x[2]    0.0193    0.9987    0.0184   2954.3025   4805.7372    1.0005   ⋯
        x[3]    5.0304    0.9896    0.0176   3161.9595   5564.6316    1.0002   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9607   -5.6740   -4.9978   -4.3067   -3.0569
        x[2]   -1.9936   -0.6605    0.0203    0.7011    1.9499
        x[3]    3.1097    4.3710    5.0330    5.6814    6.9917</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.7 seconds
Compute duration  = 1.7 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5023    0.1913    0.0030   4106.4398   5418.9272    1.0009   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1435    0.3589    0.5020    0.6465    0.8602</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5666    0.1820    0.0311    33.1675        NaN    1.1567     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2029    0.4179    0.5652    0.7578    0.8127</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.29000443938809495,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.29000443938809495,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/ji8PW/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:963 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:952
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:887 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/logdensityfunction.jl:94 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#108
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:90 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:79
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:263 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:256 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:253 [inlined]
 [31] top-level scope
    @ ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.7854    0.5465    0.0379    97.0785    26.6921    1.0154     ⋯
           x   -0.0553    0.8643    0.0345   746.4357   490.8222    1.0242     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0764    0.3481    0.6735    1.1106    2.0586
           x   -2.0963   -0.4175   -0.0133    0.3114    1.7877</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.01 seconds
Compute duration  = 3.01 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    6.1139    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.7754    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    6.1139    6.1139    6.1139    6.1139    6.1139
           x   -0.7754   -0.7754   -0.7754   -0.7754   -0.7754</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
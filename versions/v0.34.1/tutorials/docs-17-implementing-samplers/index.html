<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-33.924408194746945</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-33.924408194746945</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.97432   -4.09401   -5.42757  -6.05466   …  -2.80395   -4.58815  -3.59223
 -0.210507  -0.107109   1.24018   0.813548      0.389419   2.82693   1.59502
  1.54652    4.25794    5.72838   5.44665       7.78924    6.3381    7.46368</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01134    1.00934
  0.0271652  0.99675
  4.99073    0.98953</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip060">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip060)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip061">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip060)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip062">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1534 2640.76,1534 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1230.32 2640.76,1230.32 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,926.644 2640.76,926.644 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,622.967 2640.76,622.967 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,319.29 2640.76,319.29 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip060)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1534 170.644,1534 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1230.32 170.644,1230.32 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,926.644 170.644,926.644 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,622.967 170.644,622.967 "></polyline>
<polyline clip-path="url(#clip060)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,319.29 170.644,319.29 "></polyline>
<path clip-path="url(#clip060)" d="M49.5521 1534.45 L79.2279 1534.45 L79.2279 1538.38 L49.5521 1538.38 L49.5521 1534.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M99.8991 1532.13 Q96.7509 1532.13 94.8991 1534.29 Q93.0704 1536.44 93.0704 1540.19 Q93.0704 1543.92 94.8991 1546.09 Q96.7509 1548.25 99.8991 1548.25 Q103.047 1548.25 104.876 1546.09 Q106.728 1543.92 106.728 1540.19 Q106.728 1536.44 104.876 1534.29 Q103.047 1532.13 99.8991 1532.13 M109.181 1517.48 L109.181 1521.74 Q107.422 1520.91 105.617 1520.47 Q103.834 1520.03 102.075 1520.03 Q97.4454 1520.03 94.9917 1523.15 Q92.5612 1526.28 92.2139 1532.6 Q93.5797 1530.58 95.6398 1529.52 Q97.7 1528.43 100.177 1528.43 Q105.385 1528.43 108.394 1531.6 Q111.427 1534.75 111.427 1540.19 Q111.427 1545.51 108.279 1548.73 Q105.131 1551.95 99.8991 1551.95 Q93.9037 1551.95 90.7325 1547.37 Q87.5612 1542.76 87.5612 1534.03 Q87.5612 1525.84 91.45 1520.98 Q95.3389 1516.09 101.89 1516.09 Q103.649 1516.09 105.431 1516.44 Q107.237 1516.79 109.181 1517.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M50.3623 1230.77 L80.0381 1230.77 L80.0381 1234.71 L50.3623 1234.71 L50.3623 1230.77 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M104.297 1228.97 Q107.654 1229.68 109.529 1231.95 Q111.427 1234.22 111.427 1237.55 Q111.427 1242.67 107.908 1245.47 Q104.39 1248.27 97.9083 1248.27 Q95.7324 1248.27 93.4176 1247.83 Q91.126 1247.42 88.6723 1246.56 L88.6723 1242.05 Q90.6167 1243.18 92.9315 1243.76 Q95.2463 1244.34 97.7695 1244.34 Q102.168 1244.34 104.459 1242.6 Q106.774 1240.86 106.774 1237.55 Q106.774 1234.5 104.621 1232.79 Q102.492 1231.05 98.6722 1231.05 L94.6445 1231.05 L94.6445 1227.21 L98.8574 1227.21 Q102.306 1227.21 104.135 1225.84 Q105.964 1224.45 105.964 1221.86 Q105.964 1219.2 104.066 1217.79 Q102.191 1216.35 98.6722 1216.35 Q96.7509 1216.35 94.5519 1216.77 Q92.3528 1217.18 89.7139 1218.06 L89.7139 1213.9 Q92.376 1213.16 94.6908 1212.79 Q97.0287 1212.42 99.0889 1212.42 Q104.413 1212.42 107.515 1214.85 Q110.617 1217.25 110.617 1221.37 Q110.617 1224.24 108.973 1226.23 Q107.33 1228.2 104.297 1228.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M99.4824 912.442 Q95.8713 912.442 94.0426 916.007 Q92.2371 919.549 92.2371 926.678 Q92.2371 933.785 94.0426 937.35 Q95.8713 940.891 99.4824 940.891 Q103.117 940.891 104.922 937.35 Q106.751 933.785 106.751 926.678 Q106.751 919.549 104.922 916.007 Q103.117 912.442 99.4824 912.442 M99.4824 908.739 Q105.293 908.739 108.348 913.345 Q111.427 917.928 111.427 926.678 Q111.427 935.405 108.348 940.012 Q105.293 944.595 99.4824 944.595 Q93.6723 944.595 90.5936 940.012 Q87.538 935.405 87.538 926.678 Q87.538 917.928 90.5936 913.345 Q93.6723 908.739 99.4824 908.739 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M104.297 621.613 Q107.654 622.33 109.529 624.599 Q111.427 626.867 111.427 630.201 Q111.427 635.316 107.908 638.117 Q104.39 640.918 97.9083 640.918 Q95.7324 640.918 93.4176 640.478 Q91.126 640.062 88.6723 639.205 L88.6723 634.691 Q90.6167 635.826 92.9315 636.404 Q95.2463 636.983 97.7695 636.983 Q102.168 636.983 104.459 635.247 Q106.774 633.511 106.774 630.201 Q106.774 627.145 104.621 625.432 Q102.492 623.696 98.6722 623.696 L94.6445 623.696 L94.6445 619.853 L98.8574 619.853 Q102.306 619.853 104.135 618.488 Q105.964 617.099 105.964 614.506 Q105.964 611.844 104.066 610.432 Q102.191 608.997 98.6722 608.997 Q96.7509 608.997 94.5519 609.414 Q92.3528 609.83 89.7139 610.71 L89.7139 606.543 Q92.376 605.803 94.6908 605.432 Q97.0287 605.062 99.0889 605.062 Q104.413 605.062 107.515 607.492 Q110.617 609.9 110.617 614.02 Q110.617 616.89 108.973 618.881 Q107.33 620.849 104.297 621.613 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip060)" d="M99.8991 317.426 Q96.7509 317.426 94.8991 319.579 Q93.0704 321.732 93.0704 325.482 Q93.0704 329.209 94.8991 331.385 Q96.7509 333.538 99.8991 333.538 Q103.047 333.538 104.876 331.385 Q106.728 329.209 106.728 325.482 Q106.728 321.732 104.876 319.579 Q103.047 317.426 99.8991 317.426 M109.181 302.774 L109.181 307.033 Q107.422 306.2 105.617 305.76 Q103.834 305.32 102.075 305.32 Q97.4454 305.32 94.9917 308.445 Q92.5612 311.57 92.2139 317.889 Q93.5797 315.876 95.6398 314.811 Q97.7 313.723 100.177 313.723 Q105.385 313.723 108.394 316.894 Q111.427 320.042 111.427 325.482 Q111.427 330.806 108.279 334.024 Q105.131 337.241 99.8991 337.241 Q93.9037 337.241 90.7325 332.658 Q87.5612 328.051 87.5612 319.325 Q87.5612 311.13 91.45 306.269 Q95.3389 301.385 101.89 301.385 Q103.649 301.385 105.431 301.732 Q107.237 302.079 109.181 302.774 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip062)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1227.72 224.541,1375.91 226.891,1542.05 229.242,1393.22 231.592,1448.78 233.943,1436.14 236.293,1533.63 238.644,1472.82 240.994,1399.92 243.345,1439.29 245.695,1390.74 248.046,1264.8 250.396,1250.72 252.747,1302.17 255.097,1275.98 257.448,1374 259.798,1429.02 262.148,1281.82 264.499,1521.37 266.849,1419.98 269.2,1454.35 271.55,1322.07 273.901,1390.38 276.251,1483.22 278.602,1407.39 280.952,1311.46 283.303,1285.83 285.653,1389.91 288.004,1483.19 290.354,1453.01 292.705,1524.46 295.055,1280 297.406,1247.14 299.756,1549.72 302.107,1329.85 304.457,1472.58 306.807,1543.19 309.158,1452.9 311.508,1461.13 313.859,1298.58 316.209,1509.88 318.56,1426.26 320.91,1237.19 323.261,1528.72 325.611,1436.56 327.962,1535.17 330.312,1415.42 332.663,1604.94 335.013,1439.85 337.364,1442.05 339.714,1303.98 342.065,1327.94 344.415,1341.56 346.765,1401.79 349.116,1475.45 351.466,1460.81 353.817,1384.54 356.167,1354.57 358.518,1458.56 360.868,1556.73 363.219,1401.47 365.569,1343.36 367.92,1472.51 370.27,1489.9 372.621,1368.48 374.971,1516 377.322,1416.11 379.672,1438.2 382.023,1421.23 384.373,1344.04 386.724,1417.2 389.074,1452.84 391.424,1581.23 393.775,1501.11 396.125,1495.63 398.476,1538.38 400.826,1383.92 403.177,1468.87 405.527,1434.97 407.878,1414.26 410.228,1340.07 412.579,1218.06 414.929,1380.63 417.28,1428.1 419.63,1453.85 421.981,1502.94 424.331,1578.15 426.682,1490.89 429.032,1488.97 431.382,1418.69 433.733,1470.73 436.083,1451.49 438.434,1153.43 440.784,1353.99 443.135,1367.61 445.485,1332.23 447.836,1389.73 450.186,1579.54 452.537,1402.03 454.887,1290.88 457.238,1541.91 459.588,1378.41 461.939,1491.22 464.289,1415.14 466.64,1309.83 468.99,1444.12 471.341,1648.25 473.691,1646.83 476.041,1411.28 478.392,1425.7 480.742,1517.79 483.093,1320 485.443,1499.77 487.794,1613.86 490.144,1335.91 492.495,1330.9 494.845,1168.38 497.196,1529.82 499.546,1506.25 501.897,1460.35 504.247,1442.47 506.598,1436.78 508.948,1226.75 511.299,1391.96 513.649,1396.87 515.999,1453.67 518.35,1246.12 520.7,1522.28 523.051,1336.79 525.401,1407.79 527.752,1385.67 530.102,1551.54 532.453,1266.75 534.803,1260.76 537.154,1526.06 539.504,1651.61 541.855,1582.1 544.205,1337.69 546.556,1411.45 548.906,1592.6 551.257,1428.32 553.607,1401.59 555.958,1490.69 558.308,1524.35 560.658,1296.1 563.009,1426.01 565.359,1351.88 567.71,1499.4 570.06,1543.67 572.411,1401.55 574.761,1376.73 577.112,1614.69 579.462,1484.34 581.813,1383.24 584.163,1332.94 586.514,1431.3 588.864,1369.36 591.215,1354.39 593.565,1498.16 595.916,1557.7 598.266,1421.54 600.616,1251.83 602.967,1267.75 605.317,1528.54 607.668,1276.08 610.018,1469.27 612.369,1394.15 614.719,1310.72 617.07,1380.26 619.42,1544.5 621.771,1570.45 624.121,1405.35 626.472,1504.23 628.822,1324.05 631.173,1443.7 633.523,1327.55 635.874,1395.75 638.224,1228.09 640.575,1511.02 642.925,1440.43 645.275,1366.75 647.626,1498.06 649.976,1528.42 652.327,1306.68 654.677,1588.49 657.028,1353.68 659.378,1413.59 661.729,1564.41 664.079,1322.14 666.43,1567.85 668.78,1570.38 671.131,1447.34 673.481,1438.11 675.832,1439.63 678.182,1507.27 680.533,1562.44 682.883,1309.06 685.233,1307.82 687.584,1627.95 689.934,1537.76 692.285,1252.57 694.635,1360.82 696.986,1458.55 699.336,1405.12 701.687,1314.89 704.037,1590.81 706.388,1408.32 708.738,1300.6 711.089,1486.34 713.439,1448.87 715.79,1427.05 718.14,1225.38 720.491,1451.43 722.841,1564.12 725.192,1526.61 727.542,1506.59 729.892,1364.03 732.243,1301.63 734.593,1613.72 736.944,1560.79 739.294,1491.09 741.645,1527.95 743.995,1354.62 746.346,1409.32 748.696,1605.6 751.047,1390.31 753.397,1383.09 755.748,1570.67 758.098,1411.74 760.449,1725.37 762.799,1489.92 765.15,1509.69 767.5,1329.24 769.85,1279.92 772.201,1406.46 774.551,1516.81 776.902,1423.19 779.252,1271.3 781.603,1531.42 783.953,1446.44 786.304,1405.1 788.654,1596.38 791.005,1419.87 793.355,1351.55 795.706,1553.66 798.056,1427.41 800.407,1459.94 802.757,1524.19 805.108,1366.14 807.458,1400.91 809.809,1555.74 812.159,1492.46 814.509,1442.85 816.86,1467.04 819.21,1484.33 821.561,1280.17 823.911,1487.33 826.262,1370.26 828.612,1698.78 830.963,1449.19 833.313,1386.44 835.664,1374.19 838.014,1346.52 840.365,1506.27 842.715,1293.32 845.066,1412.91 847.416,1526.14 849.767,1348.12 852.117,1382.32 854.467,1417.41 856.818,1424.54 859.168,1305.97 861.519,1521.49 863.869,1511.84 866.22,1361.58 868.57,1523.92 870.921,1411.25 873.271,1570.53 875.622,1493.58 877.972,1458.68 880.323,1583.77 882.673,1555.57 885.024,1532.65 887.374,1489.76 889.725,1210.54 892.075,1417.2 894.426,1315.14 896.776,1368.73 899.126,1419.89 901.477,1348.4 903.827,1472.02 906.178,1257.41 908.528,1500.08 910.879,1325.62 913.229,1541.03 915.58,1355.9 917.93,1588.91 920.281,1600.33 922.631,1480.99 924.982,1531.21 927.332,1342.64 929.683,1496.18 932.033,1629.64 934.384,1407.37 936.734,1272.2 939.084,1506.24 941.435,1399.96 943.785,1415.02 946.136,1432.12 948.486,1378.34 950.837,1447.82 953.187,1264.14 955.538,1636.12 957.888,1427.07 960.239,1320.56 962.589,1373.35 964.94,1428.25 967.29,1336.28 969.641,1409.85 971.991,1363.06 974.342,1372.68 976.692,1406.67 979.043,1321.11 981.393,1427.75 983.743,1430.21 986.094,1443.45 988.444,1367.61 990.795,1457.21 993.145,1479.86 995.496,1434.1 997.846,1510.01 1000.2,1469.55 1002.55,1570.33 1004.9,1475.97 1007.25,1525.85 1009.6,1424.33 1011.95,1437.87 1014.3,1420.58 1016.65,1314.21 1019,1321.7 1021.35,1406.3 1023.7,1331.8 1026.05,1332.84 1028.4,1439.05 1030.75,1618.26 1033.1,1496.98 1035.45,1359.44 1037.8,1734.7 1040.15,1297.35 1042.51,1493.67 1044.86,1436.3 1047.21,1491.27 1049.56,1564.35 1051.91,1332.51 1054.26,1557.72 1056.61,1657.16 1058.96,1475.85 1061.31,1325.22 1063.66,1547.68 1066.01,1582.78 1068.36,1315.8 1070.71,1329.67 1073.06,1459.65 1075.41,1461.52 1077.76,1297.58 1080.11,1300.54 1082.46,1304.01 1084.81,1533.21 1087.16,1467.53 1089.51,1351.84 1091.87,1260.5 1094.22,1525.88 1096.57,1374.09 1098.92,1180.53 1101.27,1332.69 1103.62,1442.75 1105.97,1360.16 1108.32,1684.08 1110.67,1326.65 1113.02,1607.69 1115.37,1447.48 1117.72,1529.79 1120.07,1479.47 1122.42,1473.7 1124.77,1331.79 1127.12,1418.24 1129.47,1384.44 1131.82,1481.6 1134.17,1326.44 1136.52,1292.59 1138.87,1363.77 1141.23,1555.98 1143.58,1548.26 1145.93,1529.92 1148.28,1537.35 1150.63,1515.15 1152.98,1500.29 1155.33,1347.45 1157.68,1430.24 1160.03,1428.84 1162.38,1618 1164.73,1434.24 1167.08,1281.44 1169.43,1445.4 1171.78,1478.97 1174.13,1216.63 1176.48,1396.12 1178.83,1440.97 1181.18,1476.22 1183.53,1392.96 1185.88,1528.9 1188.23,1440.14 1190.59,1470.84 1192.94,1478.63 1195.29,1355.85 1197.64,1421.25 1199.99,1498.25 1202.34,1366.65 1204.69,1410.37 1207.04,1545.36 1209.39,1379.16 1211.74,1567.84 1214.09,1373.21 1216.44,1338.76 1218.79,1423.23 1221.14,1496 1223.49,1580.25 1225.84,1305.02 1228.19,1339.6 1230.54,1294.8 1232.89,1450.2 1235.24,1325.61 1237.59,1435.75 1239.94,1403.91 1242.3,1502.05 1244.65,1448.3 1247,1349.99 1249.35,1490.59 1251.7,1447.57 1254.05,1498.73 1256.4,1732.85 1258.75,1364.45 1261.1,1473.58 1263.45,1224.9 1265.8,1527.96 1268.15,1731.38 1270.5,1553.04 1272.85,1454.33 1275.2,1126.24 1277.55,1465.09 1279.9,1499.14 1282.25,1366.06 1284.6,1248.81 1286.95,1545.42 1289.3,1329.02 1291.66,1399.78 1294.01,1490.13 1296.36,1554.76 1298.71,1489.63 1301.06,1401.47 1303.41,1514.92 1305.76,1365.85 1308.11,1509.72 1310.46,1352.51 1312.81,1521.16 1315.16,1502.63 1317.51,1395.33 1319.86,1531.16 1322.21,1548.11 1324.56,1660.42 1326.91,1632.63 1329.26,1311.48 1331.61,1330.59 1333.96,1386.15 1336.31,1636.34 1338.66,1431.39 1341.02,1391.91 1343.37,1390.92 1345.72,1458.02 1348.07,1334.08 1350.42,1270.32 1352.77,1290.43 1355.12,1442.05 1357.47,1485.51 1359.82,1352.17 1362.17,1545 1364.52,1457.4 1366.87,1402.34 1369.22,1494.53 1371.57,1372.13 1373.92,1427.06 1376.27,1442.09 1378.62,1345.22 1380.97,1498.02 1383.32,1491.93 1385.67,1612.03 1388.02,1450.2 1390.38,1549.32 1392.73,1492.77 1395.08,1450.46 1397.43,1271.65 1399.78,1350.38 1402.13,1426.34 1404.48,1332.95 1406.83,1192.07 1409.18,1483.36 1411.53,1527.02 1413.88,1444.47 1416.23,1403.95 1418.58,1377.16 1420.93,1580.78 1423.28,1329.83 1425.63,1461.22 1427.98,1455.89 1430.33,1421.66 1432.68,1275.04 1435.03,1749.95 1437.38,1471.77 1439.74,1277.16 1442.09,1466.35 1444.44,1637.48 1446.79,1539.38 1449.14,1466 1451.49,1219.17 1453.84,1448.77 1456.19,1529.16 1458.54,1298.55 1460.89,1548.57 1463.24,1430.44 1465.59,1540.19 1467.94,1530.92 1470.29,1386.7 1472.64,1313.2 1474.99,1501.83 1477.34,1262.39 1479.69,1507.35 1482.04,1440.16 1484.39,1429.45 1486.74,1423.31 1489.1,1578.68 1491.45,1338.69 1493.8,1590.83 1496.15,1506.35 1498.5,1508.74 1500.85,1424.65 1503.2,1435.88 1505.55,1352.54 1507.9,1343.09 1510.25,1537.23 1512.6,1404.34 1514.95,1449.62 1517.3,1278.28 1519.65,1593.85 1522,1396.93 1524.35,1408.75 1526.7,1365.54 1529.05,1595.84 1531.4,1508.75 1533.75,1358.94 1536.1,1456.84 1538.45,1623.95 1540.81,1569.93 1543.16,1497.23 1545.51,1451.5 1547.86,1634.69 1550.21,1368.95 1552.56,1316.77 1554.91,1417.16 1557.26,1568.43 1559.61,1521.29 1561.96,1487.42 1564.31,1259.3 1566.66,1402.66 1569.01,1587 1571.36,1493.62 1573.71,1500.21 1576.06,1391.21 1578.41,1405.11 1580.76,1624.24 1583.11,1456.85 1585.46,1479.69 1587.81,1343.89 1590.17,1482.8 1592.52,1439.2 1594.87,1371.21 1597.22,1473.09 1599.57,1559.9 1601.92,1517.44 1604.27,1616.63 1606.62,1243.28 1608.97,1519.91 1611.32,1406.71 1613.67,1546.09 1616.02,1333.08 1618.37,1570.35 1620.72,1446.97 1623.07,1501.42 1625.42,1442.64 1627.77,1579.34 1630.12,1388.82 1632.47,1539.43 1634.82,1537.73 1637.17,1316.34 1639.53,1504.46 1641.88,1626.04 1644.23,1606.89 1646.58,1399.16 1648.93,1425.32 1651.28,1500.6 1653.63,1429.43 1655.98,1474.52 1658.33,1379.88 1660.68,1336.09 1663.03,1456.79 1665.38,1594.53 1667.73,1635.7 1670.08,1440.63 1672.43,1424.65 1674.78,1384.56 1677.13,1374.56 1679.48,1481.6 1681.83,1467.07 1684.18,1462.33 1686.53,1482 1688.89,1485.03 1691.24,1310.95 1693.59,1446.1 1695.94,1460.39 1698.29,1304.08 1700.64,1419.4 1702.99,1583.61 1705.34,1500.8 1707.69,1569.2 1710.04,1456.83 1712.39,1571.72 1714.74,1408.3 1717.09,1200.74 1719.44,1492.09 1721.79,1477.51 1724.14,1631.13 1726.49,1353.69 1728.84,1450.78 1731.19,1335.4 1733.54,1424.73 1735.89,1352.1 1738.25,1418.69 1740.6,1327.33 1742.95,1455.5 1745.3,1538.92 1747.65,1200.57 1750,1527.38 1752.35,1530.54 1754.7,1643.9 1757.05,1356.06 1759.4,1289.42 1761.75,1489.54 1764.1,1281.22 1766.45,1610.57 1768.8,1386.88 1771.15,1364.58 1773.5,1374.69 1775.85,1672.27 1778.2,1304.54 1780.55,1561.72 1782.9,1218.97 1785.25,1560.36 1787.6,1392.75 1789.96,1445.02 1792.31,1612.16 1794.66,1372.72 1797.01,1416.34 1799.36,1435.16 1801.71,1257.06 1804.06,1461.76 1806.41,1613.65 1808.76,1464.73 1811.11,1492.07 1813.46,1407.89 1815.81,1410.33 1818.16,1305.98 1820.51,1416.16 1822.86,1481.74 1825.21,1442.98 1827.56,1511.63 1829.91,1270.25 1832.26,1470.02 1834.61,1548 1836.96,1538.32 1839.32,1307.16 1841.67,1364.2 1844.02,1308.14 1846.37,1417.29 1848.72,1430.71 1851.07,1544.39 1853.42,1585.98 1855.77,1508.26 1858.12,1445.51 1860.47,1461.97 1862.82,1469.54 1865.17,1374.96 1867.52,1445.49 1869.87,1548.89 1872.22,1431.28 1874.57,1425.83 1876.92,1430.07 1879.27,1448.75 1881.62,1336.74 1883.97,1422.29 1886.32,1443.83 1888.68,1305.6 1891.03,1308.37 1893.38,1320.75 1895.73,1437.79 1898.08,1382.27 1900.43,1302.2 1902.78,1378.16 1905.13,1309.02 1907.48,1411.09 1909.83,1587.69 1912.18,1467.94 1914.53,1462.15 1916.88,1406.35 1919.23,1382.45 1921.58,1367.16 1923.93,1310.93 1926.28,1427.5 1928.63,1361.32 1930.98,1463.11 1933.33,1433.11 1935.68,1457.09 1938.04,1381.53 1940.39,1435.81 1942.74,1431.81 1945.09,1380.62 1947.44,1532.67 1949.79,1394.78 1952.14,1335.38 1954.49,1390.8 1956.84,1630.37 1959.19,1271.11 1961.54,1409.63 1963.89,1407.97 1966.24,1429.29 1968.59,1429.69 1970.94,1536.42 1973.29,1352.26 1975.64,1382.88 1977.99,1520.23 1980.34,1431.28 1982.69,1389.5 1985.04,1526.59 1987.4,1434.57 1989.75,1415.22 1992.1,1538.55 1994.45,1400.2 1996.8,1418.24 1999.15,1545.24 2001.5,1376.6 2003.85,1378.26 2006.2,1484.45 2008.55,1388.21 2010.9,1495.33 2013.25,1399.21 2015.6,1285.58 2017.95,1471.22 2020.3,1529.98 2022.65,1293.4 2025,1464.02 2027.35,1495.03 2029.7,1408.93 2032.05,1475.02 2034.4,1415.45 2036.76,1455.33 2039.11,1637.43 2041.46,1538.04 2043.81,1501.41 2046.16,1342.98 2048.51,1579.55 2050.86,1381.58 2053.21,1595.21 2055.56,1537.85 2057.91,1255.29 2060.26,1286.37 2062.61,1352.57 2064.96,1620.12 2067.31,1445 2069.66,1420.6 2072.01,1454.1 2074.36,1262.19 2076.71,1522.85 2079.06,1422.02 2081.41,1333.19 2083.76,1389.25 2086.11,1431.84 2088.47,1473.64 2090.82,1551 2093.17,1243.22 2095.52,1344.9 2097.87,1371.03 2100.22,1528.67 2102.57,1351.4 2104.92,1203.61 2107.27,1475.67 2109.62,1405.18 2111.97,1451.72 2114.32,1349.68 2116.67,1424.2 2119.02,1511.31 2121.37,1385.47 2123.72,1469.57 2126.07,1623.28 2128.42,1550.83 2130.77,1435.7 2133.12,1578.67 2135.47,1350.51 2137.83,1440.27 2140.18,1430.71 2142.53,1427.6 2144.88,1571.51 2147.23,1363.75 2149.58,1478.68 2151.93,1531.59 2154.28,1389.9 2156.63,1394.67 2158.98,1496.28 2161.33,1486.86 2163.68,1329.71 2166.03,1488.93 2168.38,1445.08 2170.73,1451.52 2173.08,1481.51 2175.43,1364.32 2177.78,1313.32 2180.13,1305.63 2182.48,1343.07 2184.83,1424.28 2187.19,1575.64 2189.54,1538.05 2191.89,1315.77 2194.24,1570.12 2196.59,1542.02 2198.94,1504.49 2201.29,1578.04 2203.64,1525.64 2205.99,1319.88 2208.34,1514.95 2210.69,1621.15 2213.04,1317.56 2215.39,1524.73 2217.74,1509.71 2220.09,1416.29 2222.44,1618.12 2224.79,1222.75 2227.14,1433.75 2229.49,1511.66 2231.84,1477.03 2234.19,1751.15 2236.55,1467.06 2238.9,1396.75 2241.25,1585.09 2243.6,1415.39 2245.95,1448.22 2248.3,1385.56 2250.65,1386.26 2253,1343.38 2255.35,1366.06 2257.7,1433.44 2260.05,1398.35 2262.4,1407.57 2264.75,1401.24 2267.1,1677.51 2269.45,1562.64 2271.8,1443 2274.15,1497.43 2276.5,1534.45 2278.85,1684.49 2281.2,1368.67 2283.55,1391.35 2285.91,1227.87 2288.26,1413.42 2290.61,1437.11 2292.96,1467.81 2295.31,1432.29 2297.66,1322.06 2300.01,1612.32 2302.36,1508.28 2304.71,1445.72 2307.06,1464.11 2309.41,1294.76 2311.76,1466.69 2314.11,1427.37 2316.46,1467.48 2318.81,1527.42 2321.16,1430.15 2323.51,1483.94 2325.86,1408.66 2328.21,1360.25 2330.56,1542.07 2332.91,1281.41 2335.27,1454.16 2337.62,1422.94 2339.97,1478.16 2342.32,1314.46 2344.67,1384.02 2347.02,1478.14 2349.37,1450.56 2351.72,1679.79 2354.07,1318.41 2356.42,1432.31 2358.77,1451.19 2361.12,1441.78 2363.47,1472.32 2365.82,1489.67 2368.17,1411.42 2370.52,1518.88 2372.87,1453.01 2375.22,1583.62 2377.57,1403.49 2379.92,1441.45 2382.27,1518.27 2384.62,1440.68 2386.98,1385.08 2389.33,1273.55 2391.68,1428.98 2394.03,1356.46 2396.38,1404.59 2398.73,1463.12 2401.08,1443.03 2403.43,1391.99 2405.78,1508.34 2408.13,1659.82 2410.48,1445.09 2412.83,1499.47 2415.18,1345.1 2417.53,1335.94 2419.88,1364.87 2422.23,1499.96 2424.58,1433.42 2426.93,1229.47 2429.28,1417.96 2431.63,1472.54 2433.98,1461.05 2436.34,1615.8 2438.69,1452.47 2441.04,1386.81 2443.39,1377.12 2445.74,1423.14 2448.09,1527.51 2450.44,1250.57 2452.79,1481.95 2455.14,1541.85 2457.49,1386.97 2459.84,1611.01 2462.19,1474.33 2464.54,1531.86 2466.89,1400.64 2469.24,1443.01 2471.59,1404.87 2473.94,1533.07 2476.29,1655.85 2478.64,1280.76 2480.99,1466.02 2483.34,1532.59 2485.7,1575.3 2488.05,1457.53 2490.4,1421.82 2492.75,1534.46 2495.1,1299.49 2497.45,1338.46 2499.8,1435.77 2502.15,1428.31 2504.5,1481.51 2506.85,1426.52 2509.2,1406.05 2511.55,1267.51 2513.9,1219.69 2516.25,1245.96 2518.6,1439.27 2520.95,1476.79 2523.3,1407.21 2525.65,1309.61 2528,1338.39 2530.35,1307.9 2532.7,1275.45 2535.06,1292.88 2537.41,1293.52 2539.76,1509.2 2542.11,1469.73 2544.46,1155.63 2546.81,1522.59 2549.16,1487.26 2551.51,1389.93 2553.86,1300.08 2556.21,1363.34 2558.56,1473.03 2560.91,1452.47 2563.26,1501.3 2565.61,1340.1 2567.96,1516.37 2570.31,1383.02 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,947.952 224.541,929.016 226.891,772.013 229.242,772.036 231.592,1013.4 233.943,987.784 236.293,859.627 238.644,1155.03 240.994,972.354 243.345,927.356 245.695,680.844 248.046,946.721 250.396,890.789 252.747,777.655 255.097,1078.26 257.448,1049.91 259.798,1013.67 262.148,854.907 264.499,921.596 266.849,953.521 269.2,886.276 271.55,861.134 273.901,965.091 276.251,997.865 278.602,888.785 280.952,889.51 283.303,998.808 285.653,789.31 288.004,984.684 290.354,1161.17 292.705,920.04 295.055,1110.06 297.406,831.513 299.756,779.217 302.107,909.1 304.457,979.197 306.807,974.092 309.158,846.786 311.508,985.578 313.859,869.818 316.209,874.238 318.56,847.062 320.91,847.133 323.261,882.159 325.611,940.798 327.962,894.343 330.312,901.392 332.663,1165.87 335.013,961.609 337.364,928.668 339.714,855.198 342.065,1038.65 344.415,890.693 346.765,914.165 349.116,805.491 351.466,953.017 353.817,852.158 356.167,850.764 358.518,855.196 360.868,900.3 363.219,1007.47 365.569,939.36 367.92,1044.79 370.27,719.606 372.621,858.481 374.971,1010.7 377.322,987.441 379.672,796.478 382.023,1034.92 384.373,837.752 386.724,793.315 389.074,1045.68 391.424,859.295 393.775,984.207 396.125,901.345 398.476,834.474 400.826,915.091 403.177,863.467 405.527,856.495 407.878,1033.32 410.228,968.297 412.579,996.474 414.929,987.084 417.28,978.626 419.63,811.695 421.981,967.081 424.331,1080.09 426.682,877.156 429.032,937.49 431.382,937.17 433.733,757.359 436.083,911.379 438.434,892.306 440.784,1011.36 443.135,1086.45 445.485,925.766 447.836,944.717 450.186,899.299 452.537,937.482 454.887,866.678 457.238,981.339 459.588,685.089 461.939,967.504 464.289,830.65 466.64,1019.02 468.99,964.613 471.341,947.548 473.691,811.053 476.041,840 478.392,1059.13 480.742,752.332 483.093,786.84 485.443,946.935 487.794,994.872 490.144,876.687 492.495,940.203 494.845,990.899 497.196,1018.12 499.546,835.727 501.897,840.667 504.247,1087.8 506.598,816.04 508.948,966.488 511.299,826.788 513.649,819.839 515.999,1047.63 518.35,957.552 520.7,964.894 523.051,912.665 525.401,838.755 527.752,1031.21 530.102,939.793 532.453,944.958 534.803,1006.27 537.154,971.801 539.504,990.377 541.855,1073.2 544.205,915.694 546.556,1045.99 548.906,1037.75 551.257,872.92 553.607,872.244 555.958,796.801 558.308,964.434 560.658,1081.73 563.009,786.333 565.359,805.691 567.71,942.254 570.06,894.704 572.411,989.88 574.761,992.773 577.112,842.509 579.462,974.772 581.813,830.613 584.163,942.716 586.514,1155.08 588.864,812.582 591.215,942.934 593.565,866.034 595.916,913.897 598.266,821.768 600.616,822.533 602.967,875.623 605.317,1125.8 607.668,744.972 610.018,816.363 612.369,1152.77 614.719,623.686 617.07,1057.81 619.42,923.646 621.771,865.056 624.121,1124.17 626.472,843.502 628.822,756.215 631.173,1000.97 633.523,1079.74 635.874,987.862 638.224,904.412 640.575,826.38 642.925,797.372 645.275,911.566 647.626,869.081 649.976,883.489 652.327,797.057 654.677,905.155 657.028,1054.67 659.378,972.542 661.729,910.885 664.079,928.618 666.43,897.61 668.78,969.964 671.131,927.963 673.481,957.825 675.832,884.59 678.182,813.953 680.533,879.777 682.883,882.111 685.233,930.541 687.584,776.652 689.934,934.836 692.285,1062.06 694.635,924.942 696.986,952.443 699.336,970.517 701.687,947.114 704.037,789.253 706.388,863.06 708.738,1028.39 711.089,1018.07 713.439,940.798 715.79,846.284 718.14,1027.48 720.491,892.71 722.841,872.641 725.192,856.471 727.542,786.463 729.892,998.079 732.243,984.71 734.593,1005.45 736.944,951.092 739.294,738.801 741.645,849.66 743.995,986.072 746.346,827.316 748.696,1047.63 751.047,786.777 753.397,1198.16 755.748,873.385 758.098,886.677 760.449,846.172 762.799,854.5 765.15,729.233 767.5,828.307 769.85,1074.48 772.201,908.836 774.551,920.758 776.902,882.181 779.252,1048.74 781.603,1149.74 783.953,890.2 786.304,948.131 788.654,873.405 791.005,991.139 793.355,910.411 795.706,1173.48 798.056,913.462 800.407,817.453 802.757,881.905 805.108,1088.95 807.458,895.048 809.809,844.338 812.159,850.465 814.509,781.872 816.86,1039.02 819.21,1051.46 821.561,984.347 823.911,971.228 826.262,951.106 828.612,991.753 830.963,938.677 833.313,896.982 835.664,995.644 838.014,1062.48 840.365,846.578 842.715,879.889 845.066,860.222 847.416,768.231 849.767,1074.71 852.117,1010.43 854.467,732.062 856.818,957.78 859.168,844.52 861.519,944.902 863.869,857.492 866.22,893.331 868.57,1019.04 870.921,933.798 873.271,1044.95 875.622,828.348 877.972,889.941 880.323,906.325 882.673,789.109 885.024,1047.66 887.374,794.93 889.725,976.415 892.075,954.326 894.426,956.485 896.776,873.772 899.126,891.622 901.477,864.572 903.827,1124.08 906.178,946.691 908.528,896.133 910.879,947.734 913.229,1062.23 915.58,917.773 917.93,1060.33 920.281,912.062 922.631,1003.34 924.982,1003.02 927.332,932.017 929.683,988.592 932.033,778.945 934.384,955.944 936.734,931.325 939.084,928.515 941.435,849.077 943.785,917.031 946.136,1013.36 948.486,1045.07 950.837,1029.23 953.187,863.226 955.538,1104.53 957.888,1208.46 960.239,898.522 962.589,816.209 964.94,790.681 967.29,1036.89 969.641,930.408 971.991,923.861 974.342,929.912 976.692,882.926 979.043,937.131 981.393,991.61 983.743,805.463 986.094,1023.3 988.444,890.865 990.795,1032.38 993.145,903.406 995.496,1076.82 997.846,947.153 1000.2,891.95 1002.55,851.565 1004.9,1055.1 1007.25,895.205 1009.6,891.713 1011.95,841.945 1014.3,904.512 1016.65,816.847 1019,770.032 1021.35,1067.48 1023.7,901.524 1026.05,661.904 1028.4,949.225 1030.75,850.332 1033.1,966.654 1035.45,1005.57 1037.8,1024.4 1040.15,959.469 1042.51,917.846 1044.86,988.232 1047.21,901.855 1049.56,941.775 1051.91,905.363 1054.26,911.219 1056.61,748.575 1058.96,830.364 1061.31,702.772 1063.66,997.322 1066.01,942.665 1068.36,816.223 1070.71,948.931 1073.06,832.315 1075.41,860.787 1077.76,747.144 1080.11,895.401 1082.46,1082.67 1084.81,941.245 1087.16,1011.28 1089.51,952.352 1091.87,883.577 1094.22,980.518 1096.57,944.398 1098.92,772.087 1101.27,834.897 1103.62,981.105 1105.97,952.986 1108.32,819.183 1110.67,928.254 1113.02,1042.29 1115.37,888.395 1117.72,958.682 1120.07,823.68 1122.42,1034.22 1124.77,1052.07 1127.12,872.286 1129.47,842.548 1131.82,837.33 1134.17,858.369 1136.52,792.431 1138.87,750.156 1141.23,971.198 1143.58,821.286 1145.93,878.83 1148.28,1102.11 1150.63,897.785 1152.98,891.251 1155.33,865.771 1157.68,952.742 1160.03,787.887 1162.38,1080.9 1164.73,837.544 1167.08,1078.68 1169.43,907.918 1171.78,896.058 1174.13,962.358 1176.48,1046.72 1178.83,854.006 1181.18,901.435 1183.53,845.568 1185.88,933.341 1188.23,832.744 1190.59,1016.78 1192.94,1056.82 1195.29,853.58 1197.64,922.275 1199.99,849.435 1202.34,941.878 1204.69,919.369 1207.04,879.006 1209.39,976.375 1211.74,936.855 1214.09,990.684 1216.44,1081.94 1218.79,939.658 1221.14,946.178 1223.49,864.115 1225.84,870.286 1228.19,946.874 1230.54,987.828 1232.89,894.915 1235.24,831.864 1237.59,758.819 1239.94,875.333 1242.3,919.57 1244.65,1028.14 1247,841.924 1249.35,963.478 1251.7,848.272 1254.05,984.483 1256.4,950.935 1258.75,925.769 1261.1,793.589 1263.45,854.162 1265.8,856.476 1268.15,905.54 1270.5,1027.69 1272.85,914.502 1275.2,1040.79 1277.55,1023.08 1279.9,885.583 1282.25,976.151 1284.6,1003.4 1286.95,906.531 1289.3,967.919 1291.66,970.885 1294.01,837.028 1296.36,848.142 1298.71,928.847 1301.06,820.912 1303.41,936.787 1305.76,798.766 1308.11,963.674 1310.46,1014.3 1312.81,833.803 1315.16,1032.59 1317.51,1072.12 1319.86,1060.19 1322.21,905.084 1324.56,1136.26 1326.91,938.384 1329.26,1080.81 1331.61,871.359 1333.96,1061.2 1336.31,840.464 1338.66,961.852 1341.02,949.323 1343.37,976.784 1345.72,953.106 1348.07,889.67 1350.42,901.536 1352.77,966.84 1355.12,955.206 1357.47,1094.92 1359.82,848.948 1362.17,934.955 1364.52,1018.84 1366.87,994.9 1369.22,875.611 1371.57,917.197 1373.92,830.934 1376.27,832.837 1378.62,881.698 1380.97,1109.45 1383.32,916.956 1385.67,883.831 1388.02,1034.25 1390.38,980.563 1392.73,863.031 1395.08,905.854 1397.43,896.909 1399.78,982.011 1402.13,1099.11 1404.48,897.719 1406.83,936.724 1409.18,870.357 1411.53,885.871 1413.88,961.5 1416.23,961.874 1418.58,978.969 1420.93,791.128 1423.28,1029.37 1425.63,787.736 1427.98,884.966 1430.33,883.49 1432.68,911.9 1435.03,951.989 1437.38,852.736 1439.74,1224.61 1442.09,950.789 1444.44,963.55 1446.79,980.027 1449.14,1044.19 1451.49,888.205 1453.84,1006.69 1456.19,973.895 1458.54,878.336 1460.89,1010.94 1463.24,756.639 1465.59,996.646 1467.94,923.084 1470.29,1074.08 1472.64,832.589 1474.99,958.501 1477.34,984.419 1479.69,962.061 1482.04,917.121 1484.39,981.768 1486.74,883.43 1489.1,891.816 1491.45,895.42 1493.8,824.209 1496.15,874.053 1498.5,843.287 1500.85,875.833 1503.2,971.367 1505.55,1077.58 1507.9,1046.4 1510.25,908.984 1512.6,853.321 1514.95,927.089 1517.3,1044.18 1519.65,765.887 1522,908.063 1524.35,892.752 1526.7,875.881 1529.05,931.311 1531.4,797.366 1533.75,885.301 1536.1,976.895 1538.45,1093.79 1540.81,1040.67 1543.16,774.227 1545.51,823.889 1547.86,830.266 1550.21,1049.46 1552.56,725.359 1554.91,1185.4 1557.26,828.866 1559.61,891.568 1561.96,971.276 1564.31,972.858 1566.66,1044.72 1569.01,1133.96 1571.36,919.745 1573.71,960.279 1576.06,815.498 1578.41,999.13 1580.76,1124.67 1583.11,803.977 1585.46,907.015 1587.81,821.761 1590.17,858.44 1592.52,938.234 1594.87,1023.5 1597.22,846.381 1599.57,964.739 1601.92,866.639 1604.27,874.51 1606.62,938.049 1608.97,1095 1611.32,788.789 1613.67,1034.89 1616.02,927.435 1618.37,1143.02 1620.72,975.994 1623.07,1043.93 1625.42,944.776 1627.77,1059.21 1630.12,1018.55 1632.47,1028.59 1634.82,938.162 1637.17,872.154 1639.53,854.962 1641.88,738.601 1644.23,977.167 1646.58,768.668 1648.93,981.832 1651.28,911.371 1653.63,1080.61 1655.98,734.254 1658.33,1052.39 1660.68,702.51 1663.03,926.692 1665.38,810.922 1667.73,989.217 1670.08,1024.95 1672.43,923.193 1674.78,1037.08 1677.13,1002.17 1679.48,997.616 1681.83,978.03 1684.18,1059.73 1686.53,929.438 1688.89,888.163 1691.24,880.587 1693.59,981.392 1695.94,952.403 1698.29,885.312 1700.64,801.099 1702.99,853.358 1705.34,1038.6 1707.69,825.464 1710.04,917.673 1712.39,906.717 1714.74,991.096 1717.09,983.803 1719.44,786.857 1721.79,896.907 1724.14,891.757 1726.49,872.344 1728.84,1074.73 1731.19,895.358 1733.54,838.385 1735.89,954.378 1738.25,909.206 1740.6,1042.84 1742.95,981.982 1745.3,870.874 1747.65,739.906 1750,892.322 1752.35,959.504 1754.7,1028.45 1757.05,958.842 1759.4,969.987 1761.75,1038.77 1764.1,802.308 1766.45,1156.55 1768.8,1059.12 1771.15,1119.44 1773.5,860.4 1775.85,935.163 1778.2,888.609 1780.55,723.247 1782.9,903.898 1785.25,1094.94 1787.6,835.678 1789.96,990.189 1792.31,992.05 1794.66,835.812 1797.01,1117.57 1799.36,1145.41 1801.71,1004.69 1804.06,984.093 1806.41,767.321 1808.76,730.505 1811.11,822.591 1813.46,986.387 1815.81,913.156 1818.16,770.771 1820.51,959.637 1822.86,1100.42 1825.21,864.59 1827.56,960.165 1829.91,903.784 1832.26,923.11 1834.61,860.622 1836.96,865.081 1839.32,981.787 1841.67,829.319 1844.02,694.355 1846.37,964.387 1848.72,943.851 1851.07,1006.14 1853.42,987.035 1855.77,773.903 1858.12,869.644 1860.47,932.926 1862.82,1048.38 1865.17,851.926 1867.52,886.694 1869.87,963.875 1872.22,916.845 1874.57,1174.74 1876.92,909.717 1879.27,935.563 1881.62,982.21 1883.97,859.507 1886.32,713.78 1888.68,1147.32 1891.03,902.475 1893.38,1069.02 1895.73,874.849 1898.08,746.407 1900.43,989.13 1902.78,1173.23 1905.13,857.357 1907.48,932.701 1909.83,876.121 1912.18,887.749 1914.53,818.195 1916.88,976.765 1919.23,1038.48 1921.58,981.296 1923.93,788.774 1926.28,924.264 1928.63,1005.31 1930.98,1092.53 1933.33,922.008 1935.68,957.944 1938.04,783.4 1940.39,943.71 1942.74,1062.07 1945.09,853.254 1947.44,879.533 1949.79,862.675 1952.14,919.807 1954.49,916.929 1956.84,824.809 1959.19,926.723 1961.54,917.45 1963.89,1004.81 1966.24,1086.49 1968.59,950.234 1970.94,910.506 1973.29,1065.46 1975.64,975.367 1977.99,1211.61 1980.34,818.997 1982.69,1048.96 1985.04,1032.9 1987.4,928.321 1989.75,1172.06 1992.1,886.508 1994.45,955.983 1996.8,843.165 1999.15,968.395 2001.5,891.754 2003.85,902.685 2006.2,945.677 2008.55,1006.35 2010.9,863.469 2013.25,1040.48 2015.6,1079.06 2017.95,988.52 2020.3,1034.95 2022.65,866.025 2025,1108.1 2027.35,992.26 2029.7,921.764 2032.05,1090.03 2034.4,933.006 2036.76,1038.16 2039.11,928.486 2041.46,984.898 2043.81,996.98 2046.16,937.349 2048.51,1187.72 2050.86,931.981 2053.21,1061.7 2055.56,994.29 2057.91,876.375 2060.26,975.941 2062.61,767.868 2064.96,945.262 2067.31,968.264 2069.66,925.186 2072.01,630.366 2074.36,923.927 2076.71,858.469 2079.06,916.918 2081.41,1192.19 2083.76,810.489 2086.11,878.376 2088.47,891.185 2090.82,1111.81 2093.17,948.51 2095.52,874.214 2097.87,885.851 2100.22,864.087 2102.57,682.861 2104.92,794.801 2107.27,974.583 2109.62,687.821 2111.97,1018.3 2114.32,1164.76 2116.67,883.848 2119.02,930.9 2121.37,920.683 2123.72,816.315 2126.07,1003.49 2128.42,764.256 2130.77,959.536 2133.12,883.783 2135.47,960.178 2137.83,869.646 2140.18,952.67 2142.53,923.649 2144.88,996.745 2147.23,992.029 2149.58,933.093 2151.93,837.561 2154.28,931.055 2156.63,949.482 2158.98,751.545 2161.33,784.179 2163.68,925.611 2166.03,981.283 2168.38,864.841 2170.73,1076.65 2173.08,1050.38 2175.43,976.059 2177.78,672.449 2180.13,904.032 2182.48,920.756 2184.83,1022.27 2187.19,980.935 2189.54,896.693 2191.89,929.65 2194.24,936.616 2196.59,863.13 2198.94,990.475 2201.29,1105.93 2203.64,858.888 2205.99,959.874 2208.34,1152.9 2210.69,939.056 2213.04,940.33 2215.39,885.959 2217.74,931.329 2220.09,751.524 2222.44,1083.8 2224.79,801.196 2227.14,811.637 2229.49,1071.29 2231.84,873.014 2234.19,1087.86 2236.55,762.317 2238.9,886.718 2241.25,1063.2 2243.6,855.037 2245.95,1034.53 2248.3,893.784 2250.65,875.799 2253,890.301 2255.35,1055.06 2257.7,929.432 2260.05,993.016 2262.4,833.819 2264.75,1022.25 2267.1,909.028 2269.45,789.096 2271.8,910.507 2274.15,911.036 2276.5,1062.71 2278.85,873.16 2281.2,859.52 2283.55,898.911 2285.91,1057.9 2288.26,868.778 2290.61,888.412 2292.96,892.913 2295.31,918.906 2297.66,890.913 2300.01,986.556 2302.36,870.97 2304.71,919.588 2307.06,884.273 2309.41,965.098 2311.76,952.365 2314.11,962.801 2316.46,901.33 2318.81,819.3 2321.16,1044.93 2323.51,918.372 2325.86,878.914 2328.21,780.495 2330.56,780.436 2332.91,1045.4 2335.27,838.064 2337.62,855.71 2339.97,885.13 2342.32,932.428 2344.67,836.313 2347.02,899.686 2349.37,1045.92 2351.72,922.149 2354.07,991.708 2356.42,928.397 2358.77,1033.31 2361.12,865.704 2363.47,917.568 2365.82,1074.31 2368.17,855.313 2370.52,846.109 2372.87,1081.31 2375.22,944.498 2377.57,642.78 2379.92,879.507 2382.27,799.317 2384.62,876.158 2386.98,947.928 2389.33,841.637 2391.68,954.218 2394.03,905.72 2396.38,943.068 2398.73,1027.75 2401.08,867.664 2403.43,950.089 2405.78,889.662 2408.13,1028.19 2410.48,1044.75 2412.83,825.387 2415.18,951.126 2417.53,985.667 2419.88,962.946 2422.23,904.11 2424.58,952.779 2426.93,976.417 2429.28,1040.26 2431.63,954.474 2433.98,950.087 2436.34,978.104 2438.69,845.087 2441.04,1063.95 2443.39,1048.93 2445.74,1065.36 2448.09,910.77 2450.44,967.371 2452.79,767.354 2455.14,902.029 2457.49,841.883 2459.84,957.296 2462.19,958.647 2464.54,995.29 2466.89,944.608 2469.24,975.598 2471.59,856.468 2473.94,831.676 2476.29,841.165 2478.64,1076.14 2480.99,767.485 2483.34,930.569 2485.7,821.515 2488.05,906.509 2490.4,1023.53 2492.75,894.802 2495.1,784.667 2497.45,763.181 2499.8,980.701 2502.15,571.361 2504.5,959.167 2506.85,1000.3 2509.2,926.312 2511.55,1056.67 2513.9,987.261 2516.25,744.011 2518.6,767.31 2520.95,1031.79 2523.3,892.327 2525.65,841.479 2528,847.328 2530.35,785.302 2532.7,934.851 2535.06,891.389 2537.41,898.942 2539.76,966.707 2542.11,810.825 2544.46,800.788 2546.81,950.047 2549.16,955.265 2551.51,879.871 2553.86,850.34 2556.21,824.584 2558.56,977.953 2560.91,867.14 2563.26,776.882 2565.61,906.294 2567.96,980.312 2570.31,1001.98 "></polyline>
<polyline clip-path="url(#clip062)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,770.096 224.541,448.71 226.891,504.079 229.242,352.829 231.592,381.315 233.943,428.17 236.293,415.759 238.644,515.774 240.994,372.779 243.345,275.654 245.695,266.561 248.046,365.78 250.396,473.482 252.747,332.186 255.097,628.628 257.448,355.627 259.798,247.069 262.148,224.854 264.499,460.937 266.849,472.532 269.2,385.858 271.55,593.431 273.901,329.807 276.251,365.901 278.602,491.46 280.952,445.308 283.303,523.723 285.653,431.27 288.004,382.311 290.354,505.247 292.705,503.498 295.055,434.816 297.406,365.286 299.756,374.941 302.107,319.514 304.457,440.242 306.807,527.148 309.158,286.076 311.508,320.198 313.859,503.811 316.209,575.854 318.56,465.746 320.91,503.798 323.261,642.625 325.611,546.979 327.962,611.761 330.312,598.684 332.663,576.082 335.013,420.198 337.364,329.149 339.714,541.372 342.065,477.596 344.415,245.209 346.765,520.664 349.116,459.787 351.466,400.742 353.817,372.954 356.167,364.874 358.518,307.587 360.868,427.967 363.219,386.907 365.569,482.565 367.92,416.629 370.27,332.795 372.621,243.493 374.971,342.592 377.322,493.317 379.672,343.804 382.023,521.599 384.373,591.109 386.724,328.356 389.074,415.762 391.424,476.561 393.775,368.367 396.125,490.738 398.476,454.145 400.826,423.578 403.177,532.969 405.527,377.63 407.878,364.678 410.228,408.719 412.579,541.961 414.929,475.8 417.28,360.531 419.63,435.846 421.981,415.069 424.331,338.339 426.682,344.626 429.032,314.235 431.382,444.227 433.733,465.176 436.083,456.951 438.434,492.016 440.784,295.26 443.135,530.346 445.485,341.162 447.836,527.398 450.186,393.197 452.537,426.488 454.887,314.98 457.238,394.575 459.588,501.392 461.939,287.346 464.289,481.136 466.64,410.814 468.99,331.745 471.341,335.012 473.691,324.349 476.041,565.231 478.392,277.852 480.742,449.966 483.093,377.289 485.443,634.76 487.794,267.314 490.144,501.138 492.495,546.903 494.845,436.265 497.196,456.054 499.546,516.114 501.897,347.799 504.247,495.993 506.598,517.406 508.948,339.914 511.299,349.766 513.649,632.288 515.999,346.5 518.35,435.276 520.7,448.226 523.051,376.217 525.401,633.703 527.752,568.378 530.102,363.752 532.453,482.471 534.803,488.944 537.154,504.969 539.504,389.526 541.855,320.646 544.205,303.114 546.556,466.151 548.906,303.493 551.257,380.261 553.607,462.421 555.958,325.088 558.308,336.21 560.658,291.45 563.009,377.228 565.359,502.048 567.71,397.009 570.06,390.876 572.411,309.951 574.761,370.839 577.112,338.693 579.462,449.993 581.813,537.543 584.163,485.168 586.514,440.279 588.864,263.112 591.215,157.863 593.565,433.586 595.916,450.673 598.266,471.968 600.616,442.36 602.967,655.176 605.317,541.61 607.668,211.093 610.018,351.565 612.369,379.067 614.719,468.822 617.07,435.281 619.42,523.88 621.771,389.476 624.121,661.301 626.472,501.721 628.822,337.523 631.173,303.317 633.523,678.836 635.874,517.318 638.224,365.104 640.575,435.294 642.925,519.832 645.275,404.745 647.626,298.211 649.976,427.339 652.327,463.963 654.677,278.012 657.028,645.332 659.378,152.545 661.729,491.098 664.079,591.841 666.43,339.167 668.78,417.652 671.131,632.601 673.481,540.974 675.832,492.222 678.182,356.754 680.533,388.441 682.883,484.409 685.233,351.314 687.584,396.946 689.934,484.208 692.285,387.199 694.635,504.346 696.986,271.453 699.336,387.802 701.687,536.465 704.037,517.848 706.388,565.094 708.738,536.335 711.089,433.077 713.439,201.947 715.79,579.584 718.14,353.429 720.491,468.048 722.841,225.259 725.192,468.901 727.542,418.861 729.892,345.874 732.243,500.432 734.593,358.212 736.944,289.611 739.294,443.679 741.645,378.896 743.995,300.602 746.346,447.869 748.696,446.809 751.047,563.669 753.397,345.853 755.748,489.771 758.098,402.537 760.449,471.356 762.799,448.182 765.15,413.066 767.5,257.85 769.85,509.964 772.201,304.523 774.551,482.613 776.902,404.348 779.252,318.274 781.603,437.446 783.953,330.392 786.304,566.322 788.654,337.695 791.005,534.397 793.355,300.291 795.706,486.728 798.056,594.596 800.407,330.226 802.757,374.477 805.108,319.434 807.458,431.174 809.809,415.369 812.159,513.113 814.509,438.743 816.86,535.678 819.21,298.252 821.561,470.802 823.911,472.528 826.262,256.601 828.612,387.5 830.963,427.826 833.313,256.563 835.664,434.466 838.014,408.919 840.365,491.625 842.715,534.804 845.066,545.276 847.416,388.776 849.767,425.63 852.117,426.104 854.467,311.506 856.818,434.902 859.168,569.566 861.519,380.854 863.869,485.755 866.22,337.317 868.57,295.233 870.921,354.314 873.271,229.123 875.622,376.323 877.972,494.183 880.323,504.103 882.673,341.32 885.024,406.51 887.374,637.3 889.725,508.27 892.075,483.542 894.426,423.539 896.776,301.103 899.126,499.703 901.477,406.591 903.827,379.791 906.178,252.383 908.528,434.827 910.879,546.734 913.229,440.266 915.58,526.845 917.93,514.709 920.281,352.363 922.631,452.524 924.982,633.301 927.332,440.61 929.683,565.822 932.033,391.443 934.384,377.847 936.734,418.011 939.084,392.181 941.435,345.352 943.785,451.385 946.136,245.931 948.486,540.713 950.837,648.866 953.187,393.511 955.538,431.403 957.888,472.789 960.239,394.628 962.589,272.701 964.94,498.583 967.29,455.581 969.641,582.601 971.991,544.795 974.342,487.214 976.692,209.516 979.043,608.128 981.393,458.047 983.743,449.617 986.094,333.497 988.444,383.136 990.795,422.99 993.145,432.428 995.496,515.385 997.846,456.55 1000.2,672.935 1002.55,366.49 1004.9,487.828 1007.25,406.923 1009.6,234.098 1011.95,384.697 1014.3,355.489 1016.65,578.913 1019,500.893 1021.35,414.946 1023.7,363.534 1026.05,496.003 1028.4,391.519 1030.75,333.308 1033.1,493.736 1035.45,494.475 1037.8,415.25 1040.15,411.725 1042.51,404.709 1044.86,328.808 1047.21,506.119 1049.56,293.305 1051.91,398.341 1054.26,469.425 1056.61,377.041 1058.96,566.431 1061.31,464.685 1063.66,275.526 1066.01,459.727 1068.36,363.176 1070.71,297.631 1073.06,518.457 1075.41,475.439 1077.76,477.036 1080.11,422.711 1082.46,349.496 1084.81,546.101 1087.16,520.873 1089.51,376.766 1091.87,610.294 1094.22,451.475 1096.57,477.762 1098.92,518.886 1101.27,405.496 1103.62,553.278 1105.97,463.63 1108.32,240.756 1110.67,335.25 1113.02,363.707 1115.37,289.849 1117.72,465.099 1120.07,340.078 1122.42,322.668 1124.77,213.87 1127.12,492.669 1129.47,407.552 1131.82,469.332 1134.17,385.739 1136.52,460.673 1138.87,329.051 1141.23,347.168 1143.58,388.688 1145.93,389.673 1148.28,260.75 1150.63,257.068 1152.98,362.565 1155.33,230.333 1157.68,380.371 1160.03,367.064 1162.38,421.347 1164.73,505.617 1167.08,368.132 1169.43,456.8 1171.78,303.919 1174.13,268.998 1176.48,573.385 1178.83,437.714 1181.18,476.064 1183.53,459.465 1185.88,548.1 1188.23,639.034 1190.59,399.3 1192.94,208.169 1195.29,452.284 1197.64,332.989 1199.99,469.766 1202.34,454.656 1204.69,547.947 1207.04,519.022 1209.39,395.058 1211.74,397.569 1214.09,625.043 1216.44,466.569 1218.79,313.967 1221.14,387.09 1223.49,347.985 1225.84,496.308 1228.19,392.484 1230.54,539.406 1232.89,233.19 1235.24,373.417 1237.59,552.384 1239.94,461.25 1242.3,525.549 1244.65,351.314 1247,353.225 1249.35,374.147 1251.7,332.286 1254.05,495.237 1256.4,352.01 1258.75,516.73 1261.1,367.592 1263.45,400.416 1265.8,443.559 1268.15,525.959 1270.5,482.035 1272.85,389.817 1275.2,600.791 1277.55,394.713 1279.9,510.488 1282.25,449.624 1284.6,241.243 1286.95,471.888 1289.3,479.32 1291.66,451.479 1294.01,338.236 1296.36,351.735 1298.71,277.525 1301.06,374.132 1303.41,422.433 1305.76,557.534 1308.11,465.127 1310.46,497.327 1312.81,383.796 1315.16,582.822 1317.51,336.229 1319.86,456.824 1322.21,382.532 1324.56,498.907 1326.91,391.865 1329.26,256.693 1331.61,580.878 1333.96,458.669 1336.31,521.49 1338.66,407.412 1341.02,96.8724 1343.37,259.651 1345.72,343.688 1348.07,309.508 1350.42,507.26 1352.77,325.994 1355.12,525.576 1357.47,429.408 1359.82,512.118 1362.17,216.924 1364.52,544.655 1366.87,394.192 1369.22,406.23 1371.57,595.289 1373.92,330.293 1376.27,269.731 1378.62,500.146 1380.97,446.298 1383.32,447.757 1385.67,538.847 1388.02,227.77 1390.38,262.413 1392.73,482.62 1395.08,393.507 1397.43,413.251 1399.78,482.825 1402.13,360.539 1404.48,404.956 1406.83,449.926 1409.18,390.171 1411.53,425.808 1413.88,350.582 1416.23,566.603 1418.58,645.767 1420.93,360.945 1423.28,524.638 1425.63,316.424 1427.98,445.658 1430.33,519.302 1432.68,287.776 1435.03,442.17 1437.38,302.931 1439.74,331.333 1442.09,368.483 1444.44,333.684 1446.79,221.901 1449.14,486.308 1451.49,274.963 1453.84,420.42 1456.19,529.938 1458.54,331.759 1460.89,242.27 1463.24,173.155 1465.59,406.648 1467.94,447.56 1470.29,438.04 1472.64,387.995 1474.99,536.104 1477.34,415.04 1479.69,406.105 1482.04,564.089 1484.39,438.806 1486.74,359.163 1489.1,317.654 1491.45,457.891 1493.8,355.704 1496.15,537.668 1498.5,369.603 1500.85,331.404 1503.2,375.562 1505.55,266.269 1507.9,574.512 1510.25,344.669 1512.6,338.836 1514.95,382.927 1517.3,414.35 1519.65,519.419 1522,378.723 1524.35,451.326 1526.7,455.383 1529.05,548.241 1531.4,406.736 1533.75,462.324 1536.1,346.424 1538.45,428.939 1540.81,467.514 1543.16,406.953 1545.51,339.782 1547.86,510.982 1550.21,551.926 1552.56,530.949 1554.91,372.835 1557.26,185.755 1559.61,312.243 1561.96,433.433 1564.31,345.458 1566.66,559.905 1569.01,283.6 1571.36,362.695 1573.71,389.165 1576.06,346.298 1578.41,313.235 1580.76,544.607 1583.11,384.647 1585.46,411.704 1587.81,409.122 1590.17,173.399 1592.52,330.536 1594.87,500.851 1597.22,462.036 1599.57,277.827 1601.92,521.17 1604.27,392.949 1606.62,452.874 1608.97,521.814 1611.32,433.506 1613.67,430.866 1616.02,547.98 1618.37,370.079 1620.72,397.548 1623.07,571.423 1625.42,519.899 1627.77,487.346 1630.12,424.328 1632.47,560.459 1634.82,391.308 1637.17,422.728 1639.53,514.39 1641.88,461.011 1644.23,497.739 1646.58,476.057 1648.93,504.494 1651.28,420.716 1653.63,686.229 1655.98,461.707 1658.33,295.806 1660.68,314.877 1663.03,295.269 1665.38,291.9 1667.73,439.263 1670.08,412.382 1672.43,390.983 1674.78,437.46 1677.13,336.515 1679.48,523.168 1681.83,258.953 1684.18,246.655 1686.53,498.561 1688.89,358.908 1691.24,492.064 1693.59,524.359 1695.94,235.853 1698.29,518.914 1700.64,463.057 1702.99,343.124 1705.34,505.465 1707.69,422.934 1710.04,329.751 1712.39,502.338 1714.74,344.282 1717.09,424.644 1719.44,434.61 1721.79,433.888 1724.14,421.358 1726.49,417.836 1728.84,505.882 1731.19,476.219 1733.54,407.665 1735.89,382.866 1738.25,385.059 1740.6,375.914 1742.95,294.106 1745.3,462.689 1747.65,423.488 1750,354.815 1752.35,384.62 1754.7,335.271 1757.05,393.927 1759.4,557.037 1761.75,281.031 1764.1,567.126 1766.45,379.515 1768.8,464.722 1771.15,501.538 1773.5,432.94 1775.85,329.51 1778.2,541.816 1780.55,601.565 1782.9,331.77 1785.25,447.628 1787.6,453.401 1789.96,552.194 1792.31,297.513 1794.66,400.21 1797.01,437.711 1799.36,433.958 1801.71,562.729 1804.06,407.548 1806.41,353.862 1808.76,358.165 1811.11,332.277 1813.46,216.906 1815.81,580.5 1818.16,526.135 1820.51,194.148 1822.86,296.965 1825.21,582.743 1827.56,357.041 1829.91,592.601 1832.26,461.541 1834.61,425.192 1836.96,476.567 1839.32,502.164 1841.67,280.742 1844.02,342.419 1846.37,562.129 1848.72,434.022 1851.07,348.856 1853.42,369.168 1855.77,450.184 1858.12,385.523 1860.47,463.556 1862.82,338.125 1865.17,535.842 1867.52,429.273 1869.87,497.782 1872.22,450.961 1874.57,462.197 1876.92,504.791 1879.27,488.646 1881.62,399.629 1883.97,358.088 1886.32,255.114 1888.68,437.654 1891.03,309.222 1893.38,409.345 1895.73,156.239 1898.08,586.324 1900.43,346.326 1902.78,547.424 1905.13,147.479 1907.48,391.527 1909.83,389.349 1912.18,396.787 1914.53,384.12 1916.88,516.2 1919.23,326.971 1921.58,440.385 1923.93,287.697 1926.28,394.618 1928.63,317.193 1930.98,417.498 1933.33,295.965 1935.68,455.442 1938.04,454.481 1940.39,436.817 1942.74,352.826 1945.09,388.417 1947.44,380.266 1949.79,516.535 1952.14,211.746 1954.49,435.4 1956.84,335.972 1959.19,447.333 1961.54,346.458 1963.89,340.439 1966.24,522.16 1968.59,479.485 1970.94,437.696 1973.29,401.536 1975.64,357.161 1977.99,526.827 1980.34,455.059 1982.69,240.723 1985.04,291.74 1987.4,383.235 1989.75,378.889 1992.1,377.004 1994.45,447.776 1996.8,479.384 1999.15,447.221 2001.5,307.163 2003.85,353.814 2006.2,509.685 2008.55,565.473 2010.9,342.031 2013.25,381.884 2015.6,355.943 2017.95,153.988 2020.3,385.533 2022.65,495.757 2025,483.282 2027.35,191.642 2029.7,513.651 2032.05,310.533 2034.4,357.365 2036.76,321.554 2039.11,453.87 2041.46,310.878 2043.81,230.232 2046.16,551.592 2048.51,385.069 2050.86,291.547 2053.21,307.304 2055.56,345.747 2057.91,518.071 2060.26,438.031 2062.61,468.449 2064.96,424.664 2067.31,347.957 2069.66,340.07 2072.01,444.673 2074.36,502.889 2076.71,473.037 2079.06,486.925 2081.41,503.783 2083.76,489.382 2086.11,543.804 2088.47,213.826 2090.82,583.103 2093.17,436.094 2095.52,446.498 2097.87,294.374 2100.22,420.155 2102.57,396.046 2104.92,475.094 2107.27,448.882 2109.62,466.283 2111.97,505.353 2114.32,401.645 2116.67,508.111 2119.02,339.351 2121.37,449.278 2123.72,315.939 2126.07,179.264 2128.42,525.949 2130.77,337.838 2133.12,569.057 2135.47,397.702 2137.83,267.293 2140.18,534.568 2142.53,412.68 2144.88,410.672 2147.23,264.811 2149.58,434.797 2151.93,232.557 2154.28,429.377 2156.63,505.586 2158.98,333.469 2161.33,491.563 2163.68,359.03 2166.03,216.789 2168.38,409.059 2170.73,417.129 2173.08,644.671 2175.43,300.458 2177.78,250.417 2180.13,317.603 2182.48,511.037 2184.83,203.575 2187.19,423.967 2189.54,310.342 2191.89,346.421 2194.24,460.42 2196.59,412.222 2198.94,414.853 2201.29,509.635 2203.64,423.344 2205.99,528.573 2208.34,417.64 2210.69,412.846 2213.04,340.11 2215.39,557.514 2217.74,566.232 2220.09,486.974 2222.44,432.88 2224.79,520.347 2227.14,609.79 2229.49,379.157 2231.84,489.3 2234.19,388.365 2236.55,357.069 2238.9,319.937 2241.25,430.982 2243.6,463.782 2245.95,685.123 2248.3,441.458 2250.65,536.09 2253,512.817 2255.35,481.638 2257.7,428.423 2260.05,329.52 2262.4,360 2264.75,312.771 2267.1,248.71 2269.45,521.46 2271.8,458.827 2274.15,573.1 2276.5,250.91 2278.85,560.157 2281.2,366.96 2283.55,419.567 2285.91,277.494 2288.26,275.343 2290.61,414.48 2292.96,389.774 2295.31,325.205 2297.66,384.87 2300.01,558.479 2302.36,447.972 2304.71,469.9 2307.06,527.064 2309.41,371.595 2311.76,352.656 2314.11,441.054 2316.46,364.088 2318.81,395.493 2321.16,322.022 2323.51,501.947 2325.86,404.839 2328.21,432.089 2330.56,462.453 2332.91,407.324 2335.27,287.67 2337.62,379.289 2339.97,313.943 2342.32,436.14 2344.67,346.983 2347.02,226.472 2349.37,281.286 2351.72,371.283 2354.07,473.454 2356.42,402.975 2358.77,525.997 2361.12,377.38 2363.47,225.092 2365.82,487.093 2368.17,391.506 2370.52,501.135 2372.87,339.74 2375.22,389.649 2377.57,356.57 2379.92,488.83 2382.27,477.493 2384.62,401.763 2386.98,470.428 2389.33,335.935 2391.68,315.269 2394.03,342.213 2396.38,338.784 2398.73,323.09 2401.08,341.422 2403.43,450.43 2405.78,422.196 2408.13,446.572 2410.48,456.017 2412.83,507.73 2415.18,499.915 2417.53,345.459 2419.88,417.725 2422.23,386.854 2424.58,327.577 2426.93,445.887 2429.28,424.025 2431.63,436.22 2433.98,292.505 2436.34,261.138 2438.69,452.446 2441.04,449.839 2443.39,323.354 2445.74,333.178 2448.09,448.91 2450.44,492.879 2452.79,470.722 2455.14,532.83 2457.49,384.015 2459.84,368.85 2462.19,463.209 2464.54,374.281 2466.89,548.399 2469.24,384.271 2471.59,446.272 2473.94,219.814 2476.29,478.421 2478.64,381.189 2480.99,452.223 2483.34,503.49 2485.7,448.186 2488.05,336.486 2490.4,424.727 2492.75,409.626 2495.1,539.703 2497.45,393.008 2499.8,366.61 2502.15,322.451 2504.5,314.558 2506.85,637.425 2509.2,489.558 2511.55,399.806 2513.9,348.214 2516.25,381.275 2518.6,458.448 2520.95,294.311 2523.3,313.994 2525.65,461.794 2528,500.158 2530.35,431.78 2532.7,504.243 2535.06,394.56 2537.41,468.653 2539.76,379.153 2542.11,457.766 2544.46,502.797 2546.81,202.184 2549.16,454.909 2551.51,257.73 2553.86,362.089 2556.21,194.752 2558.56,441.662 2560.91,365.761 2563.26,594.817 2565.61,441.8 2567.96,425.438 2570.31,352.231 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.12671  -4.31597   -5.53198   -4.69853   …  -4.13895   -3.43241  -4.17665
 -1.79609   0.534172   0.355669   0.268927      0.389579   1.1365    1.23867
  3.51352   4.03507    3.70327    3.24421       5.09662    4.36696   5.69213

[:, :, 2] =
 -3.21833  -4.73947  -4.44353   -4.17746   …  -5.56991   -5.56991   -5.56991
 -1.13107  -1.49877  -0.709553   0.427234     -0.822386  -0.822386  -0.822386
  1.95509   2.90784   5.01302    7.53894       5.37551    5.37551    5.37551

[:, :, 3] =
 -3.69901  -4.93132    -4.59537   …  -5.01846   -5.72031   -5.3806
 -1.02193  -0.0882636   0.154915      0.836696   0.928713   0.72198
  3.52287   2.75177     4.60716       7.44393    6.30604    5.6862

[:, :, 4] =
 -3.54413   -5.19312  -5.01073  -5.01073  …  -5.63862    -7.08831   -5.95293
  0.630555   1.29166   1.84534   1.84534      0.0947783  -0.517962  -0.700393
  3.09971    4.31583   4.04111   4.04111      5.78321     6.86729    5.53903</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96588    0.992272
  0.0169116  1.00536
  5.00408    0.992485</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.61 seconds
Compute duration  = 2.61 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0013    1.0152    0.0176   3309.9920   4914.1048    1.0002   ⋯
        x[2]   -0.0161    1.0147    0.0183   3075.4840   5429.8769    1.0017   ⋯
        x[3]    4.9993    1.0062    0.0176   3282.1394   5122.6145    1.0012   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0340   -5.6838   -4.9932   -4.3220   -3.0565
        x[2]   -2.0461   -0.6840   -0.0167    0.6626    1.9552
        x[3]    2.9802    4.3355    5.0108    5.6655    6.9272</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.51 seconds
Compute duration  = 1.51 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5019    0.1889    0.0030   3863.8610   5093.5487    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1481    0.3592    0.5033    0.6414    0.8542</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.8995    0.0171    0.0002   4774.5916   4774.5916    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.8993    0.8993    0.8993    0.8993    0.8993</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.29896287547583067,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.29896287547583067,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/TuringTutorials/TuringTutorials/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    7.1143    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.3931    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    7.1143    7.1143    7.1143    7.1143    7.1143
           x    1.3931    1.3931    1.3931    1.3931    1.3931</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.04 seconds
Compute duration  = 3.04 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.6842    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -3.1888    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.6842    0.6842    0.6842    0.6842    0.6842
           x   -3.1888   -3.1888   -3.1888   -3.1888   -3.1888</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
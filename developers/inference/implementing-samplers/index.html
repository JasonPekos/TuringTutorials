<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-2edb9ce6666235605210aaa20122994f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.36" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.36</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.36">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.19401367334376</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.19401367334376</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.24357   -4.17654   -4.42016   …  -5.08576  -5.33473   -5.5074
  0.926737   0.602493   0.378408      1.06592  -0.952629  -0.184449
  2.64766    2.94737    4.12882       4.54073   5.37924    4.31636</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98011    1.00769
  0.0193835  1.00415
  5.03902    1.00211</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip160">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip160)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip161">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip160)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip162">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1544.97 2640.76,1544.97 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1239.23 2640.76,1239.23 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,933.486 2640.76,933.486 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,627.746 2640.76,627.746 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,322.005 2640.76,322.005 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip160)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1544.97 170.644,1544.97 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1239.23 170.644,1239.23 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,933.486 170.644,933.486 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,627.746 170.644,627.746 "></polyline>
<polyline clip-path="url(#clip160)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,322.005 170.644,322.005 "></polyline>
<path clip-path="url(#clip160)" d="M49.5521 1545.42 L79.2279 1545.42 L79.2279 1549.35 L49.5521 1549.35 L49.5521 1545.42 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M99.8991 1543.1 Q96.7509 1543.1 94.8991 1545.26 Q93.0704 1547.41 93.0704 1551.16 Q93.0704 1554.89 94.8991 1557.06 Q96.7509 1559.21 99.8991 1559.21 Q103.047 1559.21 104.876 1557.06 Q106.728 1554.89 106.728 1551.16 Q106.728 1547.41 104.876 1545.26 Q103.047 1543.1 99.8991 1543.1 M109.181 1528.45 L109.181 1532.71 Q107.422 1531.88 105.617 1531.44 Q103.834 1531 102.075 1531 Q97.4454 1531 94.9917 1534.12 Q92.5612 1537.25 92.2139 1543.57 Q93.5797 1541.55 95.6398 1540.49 Q97.7 1539.4 100.177 1539.4 Q105.385 1539.4 108.394 1542.57 Q111.427 1545.72 111.427 1551.16 Q111.427 1556.48 108.279 1559.7 Q105.131 1562.92 99.8991 1562.92 Q93.9037 1562.92 90.7325 1558.33 Q87.5612 1553.73 87.5612 1545 Q87.5612 1536.81 91.45 1531.95 Q95.3389 1527.06 101.89 1527.06 Q103.649 1527.06 105.431 1527.41 Q107.237 1527.76 109.181 1528.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M50.3623 1239.68 L80.0381 1239.68 L80.0381 1243.61 L50.3623 1243.61 L50.3623 1239.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M104.297 1237.87 Q107.654 1238.59 109.529 1240.86 Q111.427 1243.13 111.427 1246.46 Q111.427 1251.58 107.908 1254.38 Q104.39 1257.18 97.9083 1257.18 Q95.7324 1257.18 93.4176 1256.74 Q91.126 1256.32 88.6723 1255.46 L88.6723 1250.95 Q90.6167 1252.09 92.9315 1252.66 Q95.2463 1253.24 97.7695 1253.24 Q102.168 1253.24 104.459 1251.51 Q106.774 1249.77 106.774 1246.46 Q106.774 1243.4 104.621 1241.69 Q102.492 1239.96 98.6722 1239.96 L94.6445 1239.96 L94.6445 1236.11 L98.8574 1236.11 Q102.306 1236.11 104.135 1234.75 Q105.964 1233.36 105.964 1230.77 Q105.964 1228.1 104.066 1226.69 Q102.191 1225.26 98.6722 1225.26 Q96.7509 1225.26 94.5519 1225.67 Q92.3528 1226.09 89.7139 1226.97 L89.7139 1222.8 Q92.376 1222.06 94.6908 1221.69 Q97.0287 1221.32 99.0889 1221.32 Q104.413 1221.32 107.515 1223.75 Q110.617 1226.16 110.617 1230.28 Q110.617 1233.15 108.973 1235.14 Q107.33 1237.11 104.297 1237.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M99.4824 919.285 Q95.8713 919.285 94.0426 922.85 Q92.2371 926.391 92.2371 933.521 Q92.2371 940.627 94.0426 944.192 Q95.8713 947.734 99.4824 947.734 Q103.117 947.734 104.922 944.192 Q106.751 940.627 106.751 933.521 Q106.751 926.391 104.922 922.85 Q103.117 919.285 99.4824 919.285 M99.4824 915.581 Q105.293 915.581 108.348 920.188 Q111.427 924.771 111.427 933.521 Q111.427 942.248 108.348 946.854 Q105.293 951.437 99.4824 951.437 Q93.6723 951.437 90.5936 946.854 Q87.538 942.248 87.538 933.521 Q87.538 924.771 90.5936 920.188 Q93.6723 915.581 99.4824 915.581 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M104.297 626.392 Q107.654 627.109 109.529 629.378 Q111.427 631.646 111.427 634.98 Q111.427 640.095 107.908 642.896 Q104.39 645.697 97.9083 645.697 Q95.7324 645.697 93.4176 645.257 Q91.126 644.841 88.6723 643.984 L88.6723 639.47 Q90.6167 640.605 92.9315 641.183 Q95.2463 641.762 97.7695 641.762 Q102.168 641.762 104.459 640.026 Q106.774 638.29 106.774 634.98 Q106.774 631.924 104.621 630.211 Q102.492 628.475 98.6722 628.475 L94.6445 628.475 L94.6445 624.632 L98.8574 624.632 Q102.306 624.632 104.135 623.267 Q105.964 621.878 105.964 619.285 Q105.964 616.623 104.066 615.211 Q102.191 613.776 98.6722 613.776 Q96.7509 613.776 94.5519 614.193 Q92.3528 614.609 89.7139 615.489 L89.7139 611.322 Q92.376 610.582 94.6908 610.211 Q97.0287 609.841 99.0889 609.841 Q104.413 609.841 107.515 612.271 Q110.617 614.679 110.617 618.799 Q110.617 621.669 108.973 623.66 Q107.33 625.628 104.297 626.392 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip160)" d="M99.8991 320.142 Q96.7509 320.142 94.8991 322.295 Q93.0704 324.448 93.0704 328.198 Q93.0704 331.924 94.8991 334.1 Q96.7509 336.253 99.8991 336.253 Q103.047 336.253 104.876 334.1 Q106.728 331.924 106.728 328.198 Q106.728 324.448 104.876 322.295 Q103.047 320.142 99.8991 320.142 M109.181 305.489 L109.181 309.749 Q107.422 308.915 105.617 308.475 Q103.834 308.036 102.075 308.036 Q97.4454 308.036 94.9917 311.161 Q92.5612 314.286 92.2139 320.605 Q93.5797 318.591 95.6398 317.526 Q97.7 316.438 100.177 316.438 Q105.385 316.438 108.394 319.61 Q111.427 322.758 111.427 328.198 Q111.427 333.522 108.279 336.739 Q105.131 339.957 99.8991 339.957 Q93.9037 339.957 90.7325 335.373 Q87.5612 330.767 87.5612 322.04 Q87.5612 313.846 91.45 308.985 Q95.3389 304.1 101.89 304.1 Q103.649 304.1 105.431 304.448 Q107.237 304.795 109.181 305.489 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip162)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1264.05 224.541,1436.47 226.891,1612.52 229.242,1553.83 231.592,1427.08 233.943,1488.04 236.293,1322.5 238.644,1320.73 240.994,1455.12 243.345,1489.97 245.695,1419.52 248.046,1381.84 250.396,1397.46 252.747,1294.66 255.097,1329.73 257.448,1473.12 259.798,1546 262.148,1406.99 264.499,1309.91 266.849,1520.1 269.2,1260.23 271.55,1516.55 273.901,1381.12 276.251,1697.96 278.602,1668.11 280.952,1472.75 283.303,1498.09 285.653,1561.46 288.004,1509.39 290.354,1462.31 292.705,1517.98 295.055,1328.03 297.406,1415.17 299.756,1311.83 302.107,1403.8 304.457,1339.15 306.807,1209.44 309.158,1530.43 311.508,1603.78 313.859,1333.24 316.209,1431.03 318.56,1353.23 320.91,1402.96 323.261,1438.12 325.611,1396.14 327.962,1423.03 330.312,1528.43 332.663,1478.28 335.013,1323.78 337.364,1533.27 339.714,1564.24 342.065,1426.26 344.415,1418.07 346.765,1528.18 349.116,1579.51 351.466,1374.85 353.817,1653.48 356.167,1547.55 358.518,1450.47 360.868,1274.94 363.219,1400.63 365.569,1341.32 367.92,1566.83 370.27,1566.05 372.621,1227.27 374.971,1367.48 377.322,1258.9 379.672,1459.1 382.023,1372.98 384.373,1522.61 386.724,1376.12 389.074,1393.11 391.424,1555.02 393.775,1489.36 396.125,1443.81 398.476,1473.4 400.826,1501.12 403.177,1354.65 405.527,1516.43 407.878,1315.86 410.228,1218.09 412.579,1506.26 414.929,1309.37 417.28,1486.77 419.63,1427.18 421.981,1402.44 424.331,1640.34 426.682,1411.72 429.032,1458.37 431.382,1308.55 433.733,1499.16 436.083,1411.91 438.434,1555.44 440.784,1319.17 443.135,1366.57 445.485,1386.09 447.836,1605.66 450.186,1546.37 452.537,1268 454.887,1351.73 457.238,1416.64 459.588,1407.96 461.939,1398.3 464.289,1339.12 466.64,1317.65 468.99,1337.51 471.341,1365.75 473.691,1454.26 476.041,1282.18 478.392,1464.46 480.742,1379.09 483.093,1504.23 485.443,1300.13 487.794,1482.69 490.144,1446.88 492.495,1494.08 494.845,1408.71 497.196,1608.03 499.546,1401.28 501.897,1504.97 504.247,1391.27 506.598,1345.35 508.948,1477.06 511.299,1470.35 513.649,1417.98 515.999,1383.94 518.35,1498.18 520.7,1461.15 523.051,1715.93 525.401,1610.32 527.752,1611.84 530.102,1476.66 532.453,1128.41 534.803,1454.48 537.154,1229.06 539.504,1477.8 541.855,1499.8 544.205,1581.51 546.556,1329.46 548.906,1505.39 551.257,1414.95 553.607,1551.56 555.958,1528.71 558.308,1413.12 560.658,1417.28 563.009,1326.93 565.359,1312.95 567.71,1492.23 570.06,1296.93 572.411,1522.31 574.761,1417.23 577.112,1458.51 579.462,1367.16 581.813,1624.28 584.163,1602.81 586.514,1485.99 588.864,1444.74 591.215,1347.81 593.565,1229.51 595.916,1370.28 598.266,1350.04 600.616,1562.57 602.967,1262.06 605.317,1221.45 607.668,1406.13 610.018,1410.86 612.369,1509.82 614.719,1453.05 617.07,1477.92 619.42,1411.52 621.771,1371.86 624.121,1525.46 626.472,1445.4 628.822,1498.41 631.173,1606.69 633.523,1624.72 635.874,1377.43 638.224,1222.94 640.575,1465.52 642.925,1421.3 645.275,1228.68 647.626,1464.2 649.976,1415.56 652.327,1611.47 654.677,1447.67 657.028,1703.79 659.378,1506.18 661.729,1444.8 664.079,1351.81 666.43,1501.29 668.78,1415.21 671.131,1521.34 673.481,1339.86 675.832,1233.15 678.182,1252.04 680.533,1310.25 682.883,1435.56 685.233,1298.09 687.584,1250.51 689.934,1365.49 692.285,1418.2 694.635,1533 696.986,1306.03 699.336,1339.73 701.687,1322.78 704.037,1197.9 706.388,1640.22 708.738,1369.64 711.089,1623.49 713.439,1602.29 715.79,1459.04 718.14,1487.97 720.491,1655.77 722.841,1622.48 725.192,1521.15 727.542,1430.11 729.892,1417.73 732.243,1486.35 734.593,1333.81 736.944,1393.46 739.294,1415.7 741.645,1538.51 743.995,1488.46 746.346,1642.22 748.696,1475.34 751.047,1458.59 753.397,1355.02 755.748,1350.88 758.098,1445 760.449,1496.58 762.799,1631.72 765.15,1457.36 767.5,1349.94 769.85,1447.01 772.201,1393.33 774.551,1563.16 776.902,1479.74 779.252,1487.58 781.603,1598.04 783.953,1592.63 786.304,1644.45 788.654,1421.32 791.005,1375.45 793.355,1429.63 795.706,1388.24 798.056,1338.68 800.407,1583.1 802.757,1430.59 805.108,1705.17 807.458,1537.45 809.809,1169.6 812.159,1475.11 814.509,1485.92 816.86,1505.48 819.21,1489.75 821.561,1368.54 823.911,1602.38 826.262,1373.76 828.612,1366.09 830.963,1507.26 833.313,1364.85 835.664,1390.46 838.014,1201.39 840.365,1557.34 842.715,1522.15 845.066,1282.12 847.416,1308.67 849.767,1423.48 852.117,1583.39 854.467,1433.05 856.818,1395.75 859.168,1515.28 861.519,1445.75 863.869,1554 866.22,1436.89 868.57,1411.44 870.921,1396.75 873.271,1508.25 875.622,1481.72 877.972,1557.42 880.323,1377.61 882.673,1477.05 885.024,1384.34 887.374,1503.99 889.725,1506.19 892.075,1390.78 894.426,1544.4 896.776,1204.09 899.126,1583.77 901.477,1449.23 903.827,1384.78 906.178,1422.46 908.528,1295.52 910.879,1492.99 913.229,1514.9 915.58,1537.02 917.93,1541.86 920.281,1440.76 922.631,1585.05 924.982,1479.94 927.332,1387.54 929.683,1481.67 932.033,1588.38 934.384,1316.95 936.734,1376.26 939.084,1492.28 941.435,1504.52 943.785,1285.41 946.136,1206.88 948.486,1453.88 950.837,1397.17 953.187,1445.93 955.538,1313.35 957.888,1451.86 960.239,1428.94 962.589,1377.7 964.94,1552.58 967.29,1531.7 969.641,1518.13 971.991,1443.82 974.342,1415.49 976.692,1465.92 979.043,1334.79 981.393,1376.91 983.743,1506.51 986.094,1587.68 988.444,1689.41 990.795,1402.37 993.145,1559.97 995.496,1460.54 997.846,1444.47 1000.2,1588.45 1002.55,1327.61 1004.9,1676.04 1007.25,1521.97 1009.6,1626.76 1011.95,1528.95 1014.3,1509.15 1016.65,1514.8 1019,1314.81 1021.35,1359.61 1023.7,1501.56 1026.05,1498.46 1028.4,1417.06 1030.75,1511.65 1033.1,1317.19 1035.45,1455.13 1037.8,1447.51 1040.15,1513.47 1042.51,1323.62 1044.86,1507.11 1047.21,1302.44 1049.56,1554.28 1051.91,1500.07 1054.26,1388.43 1056.61,1325.97 1058.96,1483.17 1061.31,1519.82 1063.66,1574.43 1066.01,1602.32 1068.36,1431.29 1070.71,1387.89 1073.06,1602.53 1075.41,1402.65 1077.76,1384.07 1080.11,1331.23 1082.46,1218.43 1084.81,1648.54 1087.16,1708.73 1089.51,1217.82 1091.87,1729.94 1094.22,1447.66 1096.57,1375.61 1098.92,1577.15 1101.27,1366.87 1103.62,1386.81 1105.97,1384.18 1108.32,1450.05 1110.67,1336.37 1113.02,1477.01 1115.37,1403.34 1117.72,1158.44 1120.07,1489.03 1122.42,1417.6 1124.77,1516.39 1127.12,1583.86 1129.47,1336.77 1131.82,1516.34 1134.17,1405.25 1136.52,1371.27 1138.87,1438.19 1141.23,1523.99 1143.58,1417.14 1145.93,1314.02 1148.28,1555.16 1150.63,1224.6 1152.98,1377.49 1155.33,1354.09 1157.68,1530.1 1160.03,1494.93 1162.38,1320.52 1164.73,1249 1167.08,1409.2 1169.43,1628.08 1171.78,1494.21 1174.13,1425.13 1176.48,1462.2 1178.83,1418.61 1181.18,1485.95 1183.53,1635.1 1185.88,1395.78 1188.23,1377.22 1190.59,1613.62 1192.94,1495.67 1195.29,1411.99 1197.64,1338.06 1199.99,1606.56 1202.34,1540.83 1204.69,1554.65 1207.04,1466.22 1209.39,1557.2 1211.74,1467.09 1214.09,1553.5 1216.44,1407.6 1218.79,1507.92 1221.14,1415.98 1223.49,1423.97 1225.84,1401.89 1228.19,1647.39 1230.54,1469.68 1232.89,1359.46 1235.24,1351.58 1237.59,1252.42 1239.94,1430.46 1242.3,1487.25 1244.65,1460.47 1247,1555.21 1249.35,1302.95 1251.7,1628.06 1254.05,1365.65 1256.4,1511.34 1258.75,1460.06 1261.1,1497.43 1263.45,1519.7 1265.8,1531.08 1268.15,1568.87 1270.5,1563.23 1272.85,1400.43 1275.2,1569.17 1277.55,1603.24 1279.9,1390.03 1282.25,1434.76 1284.6,1611.52 1286.95,1433.86 1289.3,1431.09 1291.66,1464.48 1294.01,1454.28 1296.36,1326.12 1298.71,1398.13 1301.06,1354.84 1303.41,1468.12 1305.76,1221.52 1308.11,1465.34 1310.46,1637.53 1312.81,1465.26 1315.16,1460.37 1317.51,1505.48 1319.86,1460.3 1322.21,1491.95 1324.56,1400.01 1326.91,1518.31 1329.26,1511.92 1331.61,1374.25 1333.96,1479.29 1336.31,1551.28 1338.66,1472.84 1341.02,1477.93 1343.37,1399.2 1345.72,1541.87 1348.07,1500.12 1350.42,1404.59 1352.77,1266.82 1355.12,1442.83 1357.47,1480.57 1359.82,1496.97 1362.17,1472.32 1364.52,1401.27 1366.87,1414.94 1369.22,1413.82 1371.57,1350.32 1373.92,1482.85 1376.27,1452.53 1378.62,1478.64 1380.97,1616.73 1383.32,1397.42 1385.67,1310.66 1388.02,1458.89 1390.38,1525.54 1392.73,1328.11 1395.08,1406.03 1397.43,1452 1399.78,1313.25 1402.13,1339.67 1404.48,1438.27 1406.83,1444.28 1409.18,1430.6 1411.53,1572.52 1413.88,1377.89 1416.23,1511.39 1418.58,1428.17 1420.93,1466.86 1423.28,1249.97 1425.63,1420.1 1427.98,1380.22 1430.33,1398.11 1432.68,1344.26 1435.03,1599.3 1437.38,1594.67 1439.74,1365.86 1442.09,1525.33 1444.44,1340.24 1446.79,1606.38 1449.14,1503.19 1451.49,1480.12 1453.84,1382.27 1456.19,1371 1458.54,1493.5 1460.89,1322.48 1463.24,1322.94 1465.59,1343.4 1467.94,1362.23 1470.29,1439.79 1472.64,1400.12 1474.99,1467.56 1477.34,1472.06 1479.69,1513.29 1482.04,1253.11 1484.39,1561.32 1486.74,1427.75 1489.1,1535.6 1491.45,1288.06 1493.8,1624.07 1496.15,1496.98 1498.5,1520.22 1500.85,1518.25 1503.2,1626.76 1505.55,1256.93 1507.9,1439.71 1510.25,1523.41 1512.6,1453.98 1514.95,1467.93 1517.3,1282.44 1519.65,1371.01 1522,1541 1524.35,1299.52 1526.7,1555.03 1529.05,1430.19 1531.4,1565.87 1533.75,1378.93 1536.1,1413.12 1538.45,1522.83 1540.81,1434.53 1543.16,1380.39 1545.51,1466.75 1547.86,1407.78 1550.21,1519.17 1552.56,1561.16 1554.91,1383.96 1557.26,1297.87 1559.61,1481.17 1561.96,1504.76 1564.31,1338.81 1566.66,1392.95 1569.01,1334.55 1571.36,1565.34 1573.71,1235.96 1576.06,1441.08 1578.41,1456.45 1580.76,1312.89 1583.11,1463.09 1585.46,1380.81 1587.81,1464.35 1590.17,1542.53 1592.52,1253.31 1594.87,1315.2 1597.22,1673.54 1599.57,1381.34 1601.92,1513.93 1604.27,1347.22 1606.62,1455.33 1608.97,1466.3 1611.32,1575.87 1613.67,1397.98 1616.02,1557.87 1618.37,1509.52 1620.72,1314.12 1623.07,1325.09 1625.42,1480.17 1627.77,1572.1 1630.12,1507 1632.47,1398.14 1634.82,1513.34 1637.17,1426.21 1639.53,1304.5 1641.88,1526.32 1644.23,1473.81 1646.58,1585.93 1648.93,1355.9 1651.28,1434.82 1653.63,1510.39 1655.98,1274.87 1658.33,1454.39 1660.68,1177.56 1663.03,1266.13 1665.38,1288.88 1667.73,1348.25 1670.08,1471.4 1672.43,1322.68 1674.78,1428.16 1677.13,1473.13 1679.48,1355.93 1681.83,1506.44 1684.18,1515.43 1686.53,1517.82 1688.89,1462.35 1691.24,1590.56 1693.59,1396.68 1695.94,1525.99 1698.29,1582.26 1700.64,1484.89 1702.99,1426.27 1705.34,1254.89 1707.69,1507.98 1710.04,1420.89 1712.39,1546.19 1714.74,1616.87 1717.09,1420.57 1719.44,1445.97 1721.79,1525.3 1724.14,1523.87 1726.49,1595.88 1728.84,1268.46 1731.19,1552.87 1733.54,1312.31 1735.89,1471.95 1738.25,1432.52 1740.6,1448.03 1742.95,1424.14 1745.3,1649.5 1747.65,1407.48 1750,1358.14 1752.35,1336.57 1754.7,1451.56 1757.05,1437 1759.4,1311.19 1761.75,1436.25 1764.1,1403.67 1766.45,1527.92 1768.8,1463.36 1771.15,1446.55 1773.5,1567.15 1775.85,1469.19 1778.2,1573.41 1780.55,1391.33 1782.9,1403.33 1785.25,1613.47 1787.6,1528.83 1789.96,1494.99 1792.31,1547.47 1794.66,1491.26 1797.01,1478.58 1799.36,1526.57 1801.71,1584.31 1804.06,1614.32 1806.41,1532.13 1808.76,1599.77 1811.11,1432.59 1813.46,1325.24 1815.81,1337.72 1818.16,1530.51 1820.51,1195.14 1822.86,1380.66 1825.21,1473.77 1827.56,1347.95 1829.91,1434.57 1832.26,1486.05 1834.61,1357.03 1836.96,1286.12 1839.32,1376.36 1841.67,1487.8 1844.02,1194.58 1846.37,1459.27 1848.72,1502.3 1851.07,1475.24 1853.42,1398.37 1855.77,1403.16 1858.12,1339.53 1860.47,1468.28 1862.82,1292.49 1865.17,1378.52 1867.52,1429.42 1869.87,1465.62 1872.22,1329.6 1874.57,1557.91 1876.92,1371.04 1879.27,1349.13 1881.62,1316.46 1883.97,1285.74 1886.32,1398.71 1888.68,1331.89 1891.03,1505.43 1893.38,1574.78 1895.73,1592.41 1898.08,1653.43 1900.43,1261.66 1902.78,1363.44 1905.13,1374.23 1907.48,1365.71 1909.83,1659.41 1912.18,1377.22 1914.53,1410.02 1916.88,1435.37 1919.23,1426.36 1921.58,1230.66 1923.93,1445.9 1926.28,1306 1928.63,1425.84 1930.98,1607.53 1933.33,1501.64 1935.68,1464.29 1938.04,1292.76 1940.39,1670.1 1942.74,1389.15 1945.09,1283.66 1947.44,1439.33 1949.79,1470.85 1952.14,1431.07 1954.49,1632.82 1956.84,1333.63 1959.19,1581.06 1961.54,1345.81 1963.89,1380.74 1966.24,1274.28 1968.59,1560.03 1970.94,1302.35 1973.29,1510.45 1975.64,1469.36 1977.99,1468.35 1980.34,1539.88 1982.69,1516.39 1985.04,1698.49 1987.4,1546.1 1989.75,1264.51 1992.1,1480.67 1994.45,1551.85 1996.8,1393.77 1999.15,1398.57 2001.5,1375.61 2003.85,1635.17 2006.2,1437.97 2008.55,1337.84 2010.9,1408.6 2013.25,1415.64 2015.6,1456.95 2017.95,1519.47 2020.3,1651.71 2022.65,1353.35 2025,1347.03 2027.35,1494.51 2029.7,1318.11 2032.05,1497.82 2034.4,1379.87 2036.76,1527.76 2039.11,1358.89 2041.46,1420.84 2043.81,1435.92 2046.16,1597.78 2048.51,1461.33 2050.86,1297.08 2053.21,1275.06 2055.56,1399.15 2057.91,1317.01 2060.26,1432.91 2062.61,1363.18 2064.96,1751.15 2067.31,1488.85 2069.66,1556.44 2072.01,1525.45 2074.36,1268.32 2076.71,1268.16 2079.06,1424.42 2081.41,1372.14 2083.76,1493.3 2086.11,1388.85 2088.47,1615.23 2090.82,1509.52 2093.17,1304.91 2095.52,1376.73 2097.87,1540.85 2100.22,1420.31 2102.57,1455.28 2104.92,1444.14 2107.27,1282.01 2109.62,1298.34 2111.97,1590.18 2114.32,1396.1 2116.67,1386.38 2119.02,1345.72 2121.37,1448.63 2123.72,1437.15 2126.07,1331.69 2128.42,1460.26 2130.77,1519.14 2133.12,1393.38 2135.47,1390.24 2137.83,1414.5 2140.18,1484.97 2142.53,1546.69 2144.88,1400.57 2147.23,1404.43 2149.58,1353.58 2151.93,1365.69 2154.28,1378.49 2156.63,1490.62 2158.98,1342.26 2161.33,1387.04 2163.68,1377.83 2166.03,1427.24 2168.38,1454.29 2170.73,1515.79 2173.08,1583.38 2175.43,1486.5 2177.78,1297.39 2180.13,1281.51 2182.48,1304.71 2184.83,1457.94 2187.19,1393.92 2189.54,1443.12 2191.89,1460.59 2194.24,1434.11 2196.59,1533.92 2198.94,1435.46 2201.29,1375.7 2203.64,1474.88 2205.99,1414.41 2208.34,1337.91 2210.69,1328.57 2213.04,1349.56 2215.39,1366.06 2217.74,1605.9 2220.09,1408.73 2222.44,1536.79 2224.79,1459.01 2227.14,1467.69 2229.49,1382.58 2231.84,1583.9 2234.19,1551.37 2236.55,1313.58 2238.9,1527.11 2241.25,1577.74 2243.6,1371.84 2245.95,1549.23 2248.3,1603.61 2250.65,1613.16 2253,1413.46 2255.35,1543.52 2257.7,1541.88 2260.05,1327.22 2262.4,1377.87 2264.75,1364.22 2267.1,1325.73 2269.45,1549.03 2271.8,1455.64 2274.15,1510.79 2276.5,1369.62 2278.85,1536.8 2281.2,1317.49 2283.55,1325.34 2285.91,1392.33 2288.26,1325.42 2290.61,1432.38 2292.96,1498.09 2295.31,1422.65 2297.66,1442.62 2300.01,1358.83 2302.36,1385.44 2304.71,1510.5 2307.06,1466.47 2309.41,1400.27 2311.76,1453.07 2314.11,1397.43 2316.46,1300.97 2318.81,1422.77 2321.16,1361.26 2323.51,1415.93 2325.86,1430.61 2328.21,1448.94 2330.56,1279.48 2332.91,1342.06 2335.27,1403.57 2337.62,1284.18 2339.97,1301.24 2342.32,1284.89 2344.67,1357.49 2347.02,1384.35 2349.37,1545.4 2351.72,1586.09 2354.07,1482.31 2356.42,1342.97 2358.77,1456.31 2361.12,1455.65 2363.47,1532.85 2365.82,1252.1 2368.17,1410.79 2370.52,1514.17 2372.87,1320.9 2375.22,1357.72 2377.57,1476.51 2379.92,1366.3 2382.27,1577.89 2384.62,1403.89 2386.98,1518.23 2389.33,1573.67 2391.68,1391.01 2394.03,1417.55 2396.38,1339.75 2398.73,1505.77 2401.08,1353.61 2403.43,1495.48 2405.78,1546.16 2408.13,1498.88 2410.48,1309.31 2412.83,1524.12 2415.18,1420.55 2417.53,1459.83 2419.88,1139.4 2422.23,1438.89 2424.58,1251.89 2426.93,1598.77 2429.28,1503.59 2431.63,1476.3 2433.98,1456.57 2436.34,1699.62 2438.69,1421.85 2441.04,1549.35 2443.39,1476.48 2445.74,1398.66 2448.09,1531.28 2450.44,1485.07 2452.79,1361.43 2455.14,1432.49 2457.49,1475.54 2459.84,1463.71 2462.19,1365.62 2464.54,1599.9 2466.89,1490.7 2469.24,1468 2471.59,1538.45 2473.94,1480.24 2476.29,1383.1 2478.64,1295.32 2480.99,1353.93 2483.34,1446.92 2485.7,1438.2 2488.05,1400.83 2490.4,1541.35 2492.75,1486.65 2495.1,1518.13 2497.45,1433.26 2499.8,1424.39 2502.15,1331.1 2504.5,1442.82 2506.85,1443.6 2509.2,1338.84 2511.55,1377.43 2513.9,1419.85 2516.25,1516.76 2518.6,1431.56 2520.95,1321.66 2523.3,1425.02 2525.65,1527.01 2528,1405.75 2530.35,1263.77 2532.7,1603.89 2535.06,1482.36 2537.41,1544.29 2539.76,1463.72 2542.11,1312.6 2544.46,1504.41 2546.81,1342.13 2549.16,1229.49 2551.51,1341.1 2553.86,1506.62 2556.21,1394.06 2558.56,1531.9 2560.91,1620.33 2563.26,1554.58 2565.61,1421.88 2567.96,1422.57 2570.31,1492.29 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,839.039 224.541,966.49 226.891,913.242 229.242,938.892 231.592,837.973 233.943,900.589 236.293,989.936 238.644,904.526 240.994,848.268 243.345,966.967 245.695,954.713 248.046,959.961 250.396,1029.8 252.747,823.51 255.097,1022.7 257.448,840.939 259.798,1046 262.148,1008.38 264.499,858.822 266.849,843.103 269.2,1017.47 271.55,857.098 273.901,1038.52 276.251,829.502 278.602,892.134 280.952,900.898 283.303,874.794 285.653,1145.01 288.004,1148.6 290.354,915.55 292.705,830.75 295.055,1116.66 297.406,932.071 299.756,957.285 302.107,806.509 304.457,958.577 306.807,786.419 309.158,751.688 311.508,974.552 313.859,940.389 316.209,806.786 318.56,883.739 320.91,902.209 323.261,863.808 325.611,1019.7 327.962,1102.84 330.312,928.122 332.663,829.921 335.013,1026.3 337.364,1072.82 339.714,1076.33 342.065,989.205 344.415,916.504 346.765,918.507 349.116,970.652 351.466,955.223 353.817,1015.05 356.167,901.338 358.518,869.427 360.868,1046.01 363.219,845.815 365.569,901.21 367.92,837.162 370.27,947.294 372.621,691.287 374.971,819.473 377.322,774.528 379.672,806.666 382.023,1107.77 384.373,937.958 386.724,1031.05 389.074,1022.64 391.424,945.772 393.775,939.194 396.125,918.662 398.476,1048.66 400.826,1064.04 403.177,1067 405.527,876.823 407.878,941.46 410.228,1031.34 412.579,822.004 414.929,799.835 417.28,993.598 419.63,1001.83 421.981,885.81 424.331,820.758 426.682,983.816 429.032,919.664 431.382,819.783 433.733,991.984 436.083,859.322 438.434,811.968 440.784,1005.75 443.135,1037.62 445.485,907.415 447.836,928.02 450.186,1023.97 452.537,879.543 454.887,1012.53 457.238,842.897 459.588,1059.46 461.939,872.576 464.289,791.035 466.64,1027.49 468.99,1004.03 471.341,842.014 473.691,853.626 476.041,958.241 478.392,873.517 480.742,736.02 483.093,1087.25 485.443,909.875 487.794,927.262 490.144,838.818 492.495,1086.78 494.845,917.339 497.196,960.797 499.546,910.124 501.897,864.411 504.247,902.943 506.598,874.057 508.948,852.355 511.299,845.925 513.649,1067.28 515.999,835.914 518.35,976.053 520.7,1106.36 523.051,1027.01 525.401,1005.53 527.752,1160 530.102,939.011 532.453,1022.76 534.803,879.863 537.154,1073.41 539.504,895.195 541.855,953.671 544.205,1153.31 546.556,905.263 548.906,838.432 551.257,849.09 553.607,962.794 555.958,926.962 558.308,856.565 560.658,930.413 563.009,856.33 565.359,807.907 567.71,1072.75 570.06,877.102 572.411,790.964 574.761,866.582 577.112,865.436 579.462,955.678 581.813,804.455 584.163,859.36 586.514,973.946 588.864,806.689 591.215,916.662 593.565,819.721 595.916,898.643 598.266,973.261 600.616,779.778 602.967,972.937 605.317,999.331 607.668,960.323 610.018,950.42 612.369,1076.46 614.719,1002.75 617.07,928.59 619.42,1026.86 621.771,886.544 624.121,824.35 626.472,992.37 628.822,943.07 631.173,843.593 633.523,798.18 635.874,898.012 638.224,998.334 640.575,925.626 642.925,865.996 645.275,947.845 647.626,661.294 649.976,973.915 652.327,845.631 654.677,1027.66 657.028,1031.27 659.378,925.865 661.729,1161.54 664.079,1006.37 666.43,954.927 668.78,989.196 671.131,881.365 673.481,806.463 675.832,917.693 678.182,815.657 680.533,928.386 682.883,828.013 685.233,1023.46 687.584,1003.82 689.934,779.413 692.285,888.455 694.635,836.731 696.986,719.26 699.336,1003.44 701.687,813.766 704.037,919.37 706.388,1046.77 708.738,926.598 711.089,782.681 713.439,976.019 715.79,1055.08 718.14,1072.53 720.491,935.273 722.841,856.8 725.192,1065.97 727.542,896.764 729.892,764.593 732.243,958.17 734.593,837.915 736.944,941.84 739.294,1032.52 741.645,937.642 743.995,966.063 746.346,903.087 748.696,1080.73 751.047,1179.83 753.397,885.721 755.748,1100.13 758.098,1094.49 760.449,842.414 762.799,921.869 765.15,1021.33 767.5,987.504 769.85,881.893 772.201,930.559 774.551,995.609 776.902,994.065 779.252,947.17 781.603,926.898 783.953,851.706 786.304,1034.38 788.654,918.817 791.005,869.634 793.355,849.832 795.706,772.181 798.056,905.741 800.407,931.179 802.757,991.171 805.108,871.106 807.458,990.047 809.809,867.057 812.159,973.344 814.509,799.325 816.86,1134.63 819.21,720.861 821.561,900.866 823.911,960.647 826.262,1142.05 828.612,833.563 830.963,999.454 833.313,950.063 835.664,881.324 838.014,960.35 840.365,1018.58 842.715,855.512 845.066,886.673 847.416,662.362 849.767,997.904 852.117,839.522 854.467,1014.51 856.818,924.044 859.168,935.024 861.519,1117.31 863.869,990.885 866.22,996.167 868.57,853.004 870.921,922.108 873.271,873.23 875.622,837.953 877.972,970.054 880.323,855.413 882.673,1114.45 885.024,824.859 887.374,833.876 889.725,1085.69 892.075,996.301 894.426,840.691 896.776,850.54 899.126,890.764 901.477,870.874 903.827,800.658 906.178,976.015 908.528,896.174 910.879,1029.05 913.229,1086.19 915.58,761.888 917.93,863.726 920.281,690.092 922.631,991.033 924.982,1061.65 927.332,1046.97 929.683,939.642 932.033,665.843 934.384,945.823 936.734,977.836 939.084,950.309 941.435,933.533 943.785,926.41 946.136,970.663 948.486,988.493 950.837,940.248 953.187,826.057 955.538,1003.55 957.888,888.457 960.239,856.731 962.589,1159.03 964.94,816.387 967.29,756.264 969.641,947.447 971.991,988.938 974.342,835.892 976.692,998.054 979.043,842.106 981.393,837.96 983.743,975.868 986.094,1002.91 988.444,1048.39 990.795,940.99 993.145,893.157 995.496,1057.71 997.846,898.948 1000.2,957.76 1002.55,929.207 1004.9,926.903 1007.25,963.495 1009.6,769.262 1011.95,793.423 1014.3,999.108 1016.65,1004.28 1019,819.546 1021.35,862.092 1023.7,927.237 1026.05,1028.81 1028.4,889.337 1030.75,971.082 1033.1,874.543 1035.45,1008.08 1037.8,1101.1 1040.15,855.328 1042.51,1037.48 1044.86,922.197 1047.21,982.932 1049.56,896.28 1051.91,826.014 1054.26,979.528 1056.61,1070.31 1058.96,1016.57 1061.31,1108.43 1063.66,923.128 1066.01,868.417 1068.36,991.355 1070.71,920.783 1073.06,1020.56 1075.41,825.151 1077.76,904.426 1080.11,835.823 1082.46,1031.26 1084.81,869.527 1087.16,790.581 1089.51,1026.96 1091.87,862.354 1094.22,982.385 1096.57,908.44 1098.92,770.025 1101.27,1088.53 1103.62,878.187 1105.97,989.702 1108.32,776.756 1110.67,792.339 1113.02,775.737 1115.37,969.605 1117.72,884.576 1120.07,968.295 1122.42,803.117 1124.77,987.059 1127.12,1070.32 1129.47,904.875 1131.82,869.921 1134.17,847.02 1136.52,926.461 1138.87,930.163 1141.23,880.537 1143.58,1003.85 1145.93,978.208 1148.28,1052.29 1150.63,1018.06 1152.98,1102.81 1155.33,1039.74 1157.68,1080.15 1160.03,963.318 1162.38,969.031 1164.73,940.336 1167.08,918.013 1169.43,804.687 1171.78,772.907 1174.13,883.955 1176.48,961.926 1178.83,1066.83 1181.18,1088.11 1183.53,1031.07 1185.88,930.056 1188.23,851.453 1190.59,855.459 1192.94,1088.53 1195.29,942.016 1197.64,1111.15 1199.99,901.966 1202.34,1053.02 1204.69,747.541 1207.04,962.246 1209.39,906.301 1211.74,965.366 1214.09,1154.8 1216.44,756.716 1218.79,986.445 1221.14,944.716 1223.49,909.095 1225.84,920.452 1228.19,918.571 1230.54,919.105 1232.89,961.709 1235.24,1257.9 1237.59,889.917 1239.94,1013.51 1242.3,1155.52 1244.65,1046.83 1247,923.834 1249.35,930.516 1251.7,1030.73 1254.05,1054.75 1256.4,938.539 1258.75,1169.36 1261.1,873.894 1263.45,952.713 1265.8,938.402 1268.15,854.727 1270.5,989.237 1272.85,875.754 1275.2,860.469 1277.55,1072.56 1279.9,929.777 1282.25,1078.49 1284.6,933.296 1286.95,874.501 1289.3,970.837 1291.66,842.991 1294.01,925.035 1296.36,830.642 1298.71,968.441 1301.06,937.589 1303.41,988.427 1305.76,999.266 1308.11,847.585 1310.46,804.038 1312.81,1019.99 1315.16,875.068 1317.51,904.808 1319.86,1068.13 1322.21,1033.86 1324.56,975.003 1326.91,1106.73 1329.26,1109.6 1331.61,942.464 1333.96,959.346 1336.31,780.898 1338.66,994.691 1341.02,856.881 1343.37,839.185 1345.72,707.534 1348.07,972 1350.42,1164.19 1352.77,946.206 1355.12,911.218 1357.47,1035.35 1359.82,778.456 1362.17,751.671 1364.52,949.653 1366.87,912.604 1369.22,1028.25 1371.57,890.141 1373.92,1053.4 1376.27,960.34 1378.62,892.861 1380.97,1093.61 1383.32,963.137 1385.67,717.477 1388.02,924.348 1390.38,881.385 1392.73,858.694 1395.08,968.299 1397.43,922.662 1399.78,1030.24 1402.13,852.827 1404.48,741.519 1406.83,954.536 1409.18,841.061 1411.53,779.526 1413.88,959.053 1416.23,919.591 1418.58,771.066 1420.93,916.218 1423.28,771.483 1425.63,1034.32 1427.98,923.141 1430.33,877.862 1432.68,1053.58 1435.03,1044.28 1437.38,923.709 1439.74,1144.78 1442.09,906.457 1444.44,881.528 1446.79,913.277 1449.14,823.55 1451.49,865.952 1453.84,1003.79 1456.19,1036.34 1458.54,826.721 1460.89,903.968 1463.24,928.678 1465.59,918.563 1467.94,949.803 1470.29,965.877 1472.64,1006.48 1474.99,1034.38 1477.34,999.822 1479.69,984.699 1482.04,1002.09 1484.39,1019.29 1486.74,1004.67 1489.1,1065.13 1491.45,901.973 1493.8,827.321 1496.15,818.32 1498.5,972.454 1500.85,1043.32 1503.2,985.891 1505.55,839.523 1507.9,917.435 1510.25,761.179 1512.6,825.207 1514.95,869.375 1517.3,1046.57 1519.65,998.583 1522,914.581 1524.35,790.496 1526.7,848.11 1529.05,1069.58 1531.4,869.365 1533.75,980.767 1536.1,977.805 1538.45,858.075 1540.81,822.345 1543.16,1074.15 1545.51,911.667 1547.86,865.003 1550.21,1007.11 1552.56,922.38 1554.91,848.334 1557.26,777.326 1559.61,1022.57 1561.96,990.179 1564.31,1007.64 1566.66,1008.25 1569.01,780.577 1571.36,741.405 1573.71,1023.39 1576.06,901.962 1578.41,1170.13 1580.76,1043.5 1583.11,1034.87 1585.46,1027.58 1587.81,984.026 1590.17,872.339 1592.52,1017.9 1594.87,808.132 1597.22,906.514 1599.57,960.134 1601.92,984.061 1604.27,965.979 1606.62,920.396 1608.97,847.973 1611.32,1018.97 1613.67,1065.93 1616.02,951.011 1618.37,872.672 1620.72,974.632 1623.07,1080.6 1625.42,779.849 1627.77,1061.91 1630.12,996.326 1632.47,1030.64 1634.82,895.577 1637.17,932.332 1639.53,960.58 1641.88,770.665 1644.23,1018.35 1646.58,896.777 1648.93,833.656 1651.28,868.35 1653.63,1050.03 1655.98,1012.06 1658.33,1228.6 1660.68,873.528 1663.03,969.47 1665.38,828.391 1667.73,1062.56 1670.08,726.667 1672.43,1062 1674.78,675.026 1677.13,924.891 1679.48,1109.09 1681.83,1012.47 1684.18,956.158 1686.53,851.613 1688.89,1038.19 1691.24,874.676 1693.59,958.858 1695.94,743.636 1698.29,1149.28 1700.64,848.509 1702.99,971.655 1705.34,937.794 1707.69,934.485 1710.04,854.678 1712.39,932.419 1714.74,840.885 1717.09,954.044 1719.44,902.669 1721.79,910.381 1724.14,942.925 1726.49,901.748 1728.84,868.972 1731.19,771.792 1733.54,1016.67 1735.89,891.845 1738.25,785.196 1740.6,883.648 1742.95,952.683 1745.3,864.218 1747.65,897.555 1750,915.895 1752.35,793.796 1754.7,1226.5 1757.05,1020.25 1759.4,899.744 1761.75,1101.61 1764.1,907.561 1766.45,890.314 1768.8,908.993 1771.15,977.911 1773.5,1011.21 1775.85,887.682 1778.2,979.166 1780.55,962.492 1782.9,924.828 1785.25,929.041 1787.6,983.748 1789.96,943.372 1792.31,1062.58 1794.66,905.631 1797.01,833.487 1799.36,856.911 1801.71,870.815 1804.06,796.139 1806.41,1002.47 1808.76,969.637 1811.11,887.365 1813.46,780.708 1815.81,901.216 1818.16,781.825 1820.51,914.309 1822.86,765.866 1825.21,793.724 1827.56,853.575 1829.91,852.43 1832.26,806.9 1834.61,891.939 1836.96,837.165 1839.32,863.135 1841.67,901.613 1844.02,797.218 1846.37,1060.06 1848.72,834.101 1851.07,864.082 1853.42,1140.63 1855.77,764.47 1858.12,1001.77 1860.47,718.799 1862.82,988.73 1865.17,847.438 1867.52,897.924 1869.87,933.656 1872.22,901.98 1874.57,731.245 1876.92,889.403 1879.27,834.881 1881.62,881.62 1883.97,963.821 1886.32,976.631 1888.68,938.184 1891.03,920.721 1893.38,913.288 1895.73,897.981 1898.08,1022.54 1900.43,920.621 1902.78,896.202 1905.13,883.999 1907.48,872.084 1909.83,884.535 1912.18,839.501 1914.53,918.445 1916.88,1112.85 1919.23,830.08 1921.58,600.101 1923.93,922.851 1926.28,842.226 1928.63,1051.64 1930.98,1111.85 1933.33,876.901 1935.68,1159.45 1938.04,1096.15 1940.39,1122.04 1942.74,1021.88 1945.09,916.976 1947.44,936.967 1949.79,960.937 1952.14,747.658 1954.49,998.243 1956.84,1026.37 1959.19,1029.66 1961.54,965.461 1963.89,747.361 1966.24,929.791 1968.59,1169.91 1970.94,947.732 1973.29,878.29 1975.64,846.02 1977.99,1104.76 1980.34,769.122 1982.69,840.803 1985.04,976.823 1987.4,873.468 1989.75,878.251 1992.1,988.204 1994.45,779.044 1996.8,938.707 1999.15,929.977 2001.5,945.416 2003.85,896.932 2006.2,1008.99 2008.55,930.049 2010.9,915.278 2013.25,859.565 2015.6,793.933 2017.95,872.512 2020.3,895.119 2022.65,743.346 2025,826.589 2027.35,882.268 2029.7,885.217 2032.05,1026.62 2034.4,927.005 2036.76,794.772 2039.11,884.461 2041.46,930.626 2043.81,994.213 2046.16,919.813 2048.51,863.178 2050.86,881.568 2053.21,1090.28 2055.56,1011.93 2057.91,1202.55 2060.26,950.603 2062.61,1011.03 2064.96,1053.79 2067.31,894.465 2069.66,839.639 2072.01,775.277 2074.36,839.584 2076.71,1080.32 2079.06,1013.62 2081.41,750.566 2083.76,898.203 2086.11,921.621 2088.47,850.283 2090.82,971.551 2093.17,905.607 2095.52,678.476 2097.87,867.645 2100.22,959.031 2102.57,961.309 2104.92,908.564 2107.27,1029.02 2109.62,889.065 2111.97,1029.45 2114.32,980.967 2116.67,966.546 2119.02,999.001 2121.37,890.051 2123.72,840.366 2126.07,906.811 2128.42,803.707 2130.77,1035.92 2133.12,774.249 2135.47,939.556 2137.83,957.944 2140.18,791.666 2142.53,1057.01 2144.88,915.597 2147.23,910.751 2149.58,1123.02 2151.93,859.5 2154.28,814.016 2156.63,941.248 2158.98,1000.37 2161.33,933.469 2163.68,957.899 2166.03,1099.41 2168.38,927.861 2170.73,1052.8 2173.08,805.589 2175.43,925.637 2177.78,972.428 2180.13,977.163 2182.48,1034.22 2184.83,1077.78 2187.19,742.931 2189.54,900.075 2191.89,766.936 2194.24,917.01 2196.59,1151.91 2198.94,901.902 2201.29,828.133 2203.64,903.238 2205.99,1038.48 2208.34,865.148 2210.69,871.456 2213.04,868.112 2215.39,1025.97 2217.74,970.203 2220.09,814.046 2222.44,1097.08 2224.79,1071.52 2227.14,906.255 2229.49,939.844 2231.84,1010.84 2234.19,880.831 2236.55,1042.82 2238.9,828.716 2241.25,830.447 2243.6,725.712 2245.95,833.672 2248.3,886.733 2250.65,835.394 2253,910.822 2255.35,774.678 2257.7,878.041 2260.05,979.384 2262.4,936.261 2264.75,876.734 2267.1,1061.87 2269.45,881.642 2271.8,926.603 2274.15,712.58 2276.5,1011.2 2278.85,904.575 2281.2,962.047 2283.55,1146.03 2285.91,1126.33 2288.26,905.31 2290.61,1150.17 2292.96,878.941 2295.31,903.803 2297.66,1172.46 2300.01,970.263 2302.36,940.797 2304.71,875.437 2307.06,824.591 2309.41,893.819 2311.76,880.08 2314.11,991.304 2316.46,1125.55 2318.81,853.155 2321.16,866.677 2323.51,909.425 2325.86,889.521 2328.21,711.657 2330.56,993.359 2332.91,883.192 2335.27,841.722 2337.62,1116.91 2339.97,917.901 2342.32,1077.23 2344.67,996.1 2347.02,966.856 2349.37,807.852 2351.72,915.166 2354.07,1032.79 2356.42,996.171 2358.77,771.359 2361.12,1086.44 2363.47,984.786 2365.82,969.439 2368.17,771.204 2370.52,996.106 2372.87,802.108 2375.22,766.166 2377.57,960.623 2379.92,1036.41 2382.27,1006.31 2384.62,1066.77 2386.98,920.161 2389.33,1136.98 2391.68,923.806 2394.03,939.997 2396.38,944.359 2398.73,952.392 2401.08,887.677 2403.43,722.131 2405.78,1076.99 2408.13,833.278 2410.48,895.982 2412.83,795.386 2415.18,865.787 2417.53,1019.2 2419.88,959.265 2422.23,890.741 2424.58,873.82 2426.93,973.106 2429.28,862.876 2431.63,789.527 2433.98,847.924 2436.34,993.189 2438.69,866.423 2441.04,1020.5 2443.39,930.697 2445.74,980.857 2448.09,1011.31 2450.44,821.485 2452.79,930.875 2455.14,1037.1 2457.49,909.83 2459.84,852.632 2462.19,706.518 2464.54,909.654 2466.89,1058.12 2469.24,795.691 2471.59,831.049 2473.94,1100.34 2476.29,898.889 2478.64,892.909 2480.99,1009.69 2483.34,819.673 2485.7,866.801 2488.05,1046.15 2490.4,949.531 2492.75,856.168 2495.1,1037.01 2497.45,902.66 2499.8,976.512 2502.15,994.801 2504.5,877.3 2506.85,843.941 2509.2,992.658 2511.55,956.966 2513.9,1009.01 2516.25,958.888 2518.6,892.596 2520.95,858.602 2523.3,1059.51 2525.65,888.147 2528,963.227 2530.35,952.133 2532.7,926.68 2535.06,809.845 2537.41,932.782 2539.76,1089.59 2542.11,792.554 2544.46,826.436 2546.81,1036.15 2549.16,917.621 2551.51,994.977 2553.86,1033.13 2556.21,1109.86 2558.56,919.739 2560.91,1081.15 2563.26,842.635 2565.61,929.35 2567.96,1007.45 2570.31,955.424 "></polyline>
<polyline clip-path="url(#clip162)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,663.654 224.541,399.165 226.891,241.757 229.242,312.085 231.592,444.362 233.943,485.955 236.293,489.036 238.644,360.721 240.994,341.847 243.345,513.731 245.695,370.836 248.046,432.014 250.396,337.495 252.747,394.195 255.097,363.747 257.448,583.776 259.798,553.949 262.148,302.241 264.499,551.896 266.849,376.808 269.2,461.393 271.55,332.717 273.901,555.044 276.251,451.448 278.602,579.197 280.952,412.215 283.303,543.295 285.653,335.853 288.004,495.08 290.354,498.57 292.705,326.007 295.055,331.848 297.406,344.823 299.756,565.066 302.107,326.478 304.457,551.126 306.807,374.957 309.158,463.151 311.508,570.838 313.859,395.655 316.209,527.353 318.56,451.153 320.91,414.968 323.261,414.109 325.611,368.724 327.962,262.02 330.312,340.873 332.663,453.896 335.013,332.522 337.364,261.893 339.714,335.56 342.065,529.356 344.415,359.155 346.765,483.103 349.116,494.017 351.466,552.945 353.817,364.372 356.167,387.514 358.518,486.094 360.868,407.785 363.219,305.982 365.569,434.333 367.92,288.1 370.27,528.854 372.621,493.016 374.971,475.488 377.322,265.687 379.672,294.381 382.023,500.088 384.373,303.188 386.724,434.709 389.074,329.9 391.424,443.79 393.775,392.99 396.125,661.823 398.476,179.012 400.826,480.575 403.177,230.119 405.527,284.09 407.878,370.272 410.228,585.979 412.579,539.019 414.929,403.092 417.28,274.994 419.63,345.61 421.981,383.513 424.331,454.136 426.682,399.557 429.032,476.913 431.382,557.677 433.733,518.089 436.083,514.117 438.434,514.845 440.784,306.262 443.135,419.745 445.485,437.135 447.836,310.134 450.186,575.606 452.537,211.724 454.887,280.101 457.238,554.228 459.588,381.724 461.939,217.996 464.289,448.209 466.64,248.431 468.99,353.669 471.341,413.805 473.691,438.499 476.041,496.078 478.392,485.21 480.742,413.816 483.093,521.948 485.443,397.996 487.794,525.426 490.144,458.752 492.495,473.999 494.845,389.294 497.196,443.499 499.546,367.934 501.897,304.33 504.247,447.438 506.598,447.61 508.948,288.069 511.299,511.231 513.649,458.272 515.999,349.519 518.35,481.643 520.7,606.722 523.051,360.994 525.401,351.72 527.752,410.086 530.102,329.851 532.453,449.959 534.803,447.943 537.154,407.175 539.504,465.018 541.855,294.125 544.205,360.868 546.556,360.299 548.906,643.386 551.257,495.082 553.607,317.847 555.958,312.444 558.308,397.591 560.658,374.423 563.009,441.033 565.359,419.866 567.71,319.265 570.06,337.559 572.411,374.531 574.761,456.514 577.112,492.078 579.462,423.12 581.813,329.499 584.163,476.853 586.514,590.885 588.864,382.397 591.215,558.114 593.565,372.701 595.916,313.869 598.266,509.396 600.616,394.7 602.967,447.526 605.317,442.298 607.668,365.657 610.018,520.061 612.369,428.766 614.719,511.403 617.07,464.669 619.42,441.185 621.771,276.841 624.121,377.024 626.472,504.385 628.822,481.647 631.173,616.571 633.523,385.772 635.874,503.791 638.224,350.173 640.575,649.17 642.925,497.864 645.275,492.739 647.626,326.624 649.976,281.035 652.327,488.42 654.677,402.656 657.028,379.022 659.378,282.966 661.729,403.747 664.079,242.821 666.43,445.057 668.78,429.428 671.131,340.155 673.481,228.931 675.832,571.742 678.182,467.697 680.533,483.511 682.883,320.593 685.233,331.898 687.584,425.265 689.934,353.448 692.285,464.012 694.635,553.262 696.986,196.472 699.336,495.565 701.687,539.704 704.037,457.187 706.388,385.301 708.738,396.918 711.089,414.681 713.439,479.146 715.79,424.271 718.14,418.385 720.491,610.187 722.841,395.205 725.192,523.146 727.542,372.205 729.892,467.132 732.243,422.643 734.593,479.609 736.944,270.981 739.294,452.699 741.645,320.63 743.995,473.817 746.346,405.63 748.696,357.259 751.047,536.074 753.397,373.847 755.748,332.35 758.098,487.922 760.449,486.039 762.799,485.468 765.15,388.222 767.5,354.818 769.85,654.154 772.201,455.965 774.551,590.468 776.902,301.353 779.252,560.14 781.603,455.195 783.953,548.967 786.304,357.746 788.654,457.27 791.005,407.078 793.355,456.488 795.706,506.938 798.056,570.973 800.407,467.222 802.757,297.223 805.108,534.457 807.458,459.78 809.809,413.246 812.159,431.719 814.509,467.332 816.86,425.783 819.21,520.752 821.561,374.775 823.911,352.572 826.262,276.321 828.612,626.691 830.963,464.917 833.313,397.39 835.664,345.299 838.014,443.066 840.365,462.094 842.715,219.41 845.066,298.952 847.416,437.989 849.767,324.622 852.117,496.203 854.467,430.693 856.818,378.654 859.168,534.697 861.519,393.514 863.869,451.914 866.22,467.868 868.57,395.987 870.921,523.299 873.271,480.216 875.622,362.805 877.972,510.138 880.323,480.018 882.673,525.777 885.024,203.959 887.374,522.347 889.725,523.198 892.075,463.359 894.426,415.834 896.776,449.865 899.126,477.826 901.477,302.71 903.827,489.763 906.178,377.853 908.528,396.513 910.879,389.181 913.229,383.746 915.58,444.729 917.93,575.295 920.281,366.765 922.631,507.494 924.982,646.513 927.332,549.429 929.683,252.361 932.033,355.473 934.384,487.963 936.734,380.406 939.084,413.967 941.435,514.927 943.785,444.933 946.136,469.844 948.486,384.461 950.837,317.305 953.187,446.287 955.538,313.044 957.888,520.215 960.239,279.199 962.589,380.049 964.94,458.528 967.29,582.412 969.641,445.909 971.991,420.042 974.342,502.175 976.692,338.427 979.043,502.203 981.393,427.787 983.743,148.48 986.094,309.469 988.444,444.548 990.795,477.393 993.145,366.452 995.496,382.142 997.846,573.266 1000.2,425.093 1002.55,343.478 1004.9,656.361 1007.25,298.932 1009.6,369.073 1011.95,485.025 1014.3,96.8724 1016.65,406.215 1019,511.458 1021.35,282.589 1023.7,458.281 1026.05,462.284 1028.4,450.33 1030.75,377.583 1033.1,426.978 1035.45,469.084 1037.8,390.026 1040.15,463.77 1042.51,346.383 1044.86,548.99 1047.21,278.056 1049.56,495.939 1051.91,305.901 1054.26,421.197 1056.61,185.57 1058.96,392.629 1061.31,497.478 1063.66,405.035 1066.01,398.838 1068.36,191.707 1070.71,272.681 1073.06,453.751 1075.41,277.514 1077.76,458.383 1080.11,244.44 1082.46,360.803 1084.81,446.311 1087.16,514.118 1089.51,567.457 1091.87,381.436 1094.22,283.718 1096.57,212.462 1098.92,571.837 1101.27,650.742 1103.62,387.361 1105.97,203.177 1108.32,586.339 1110.67,470.014 1113.02,580.463 1115.37,340.906 1117.72,486.777 1120.07,487.739 1122.42,572.662 1124.77,433.846 1127.12,470.351 1129.47,348.758 1131.82,445.613 1134.17,529.451 1136.52,391.13 1138.87,518.938 1141.23,431.14 1143.58,420.914 1145.93,362.719 1148.28,234.018 1150.63,534.777 1152.98,467.761 1155.33,548.878 1157.68,587.551 1160.03,516.313 1162.38,475.603 1164.73,516.553 1167.08,425.557 1169.43,349.997 1171.78,384.57 1174.13,373.329 1176.48,312.171 1178.83,335.07 1181.18,729.652 1183.53,375.754 1185.88,380.011 1188.23,245.239 1190.59,550.928 1192.94,359.813 1195.29,297.171 1197.64,490.824 1199.99,631.106 1202.34,199.504 1204.69,298.954 1207.04,511.441 1209.39,450.492 1211.74,416.949 1214.09,500.289 1216.44,454.597 1218.79,397.971 1221.14,438.299 1223.49,399.621 1225.84,403.151 1228.19,501.668 1230.54,376.02 1232.89,424.276 1235.24,253.159 1237.59,599.848 1239.94,248.652 1242.3,582.375 1244.65,444.62 1247,525.204 1249.35,481.031 1251.7,320.514 1254.05,398.249 1256.4,615.024 1258.75,224.135 1261.1,292.388 1263.45,390.875 1265.8,386.272 1268.15,268.15 1270.5,480.189 1272.85,476.211 1275.2,438.813 1277.55,406.711 1279.9,323.459 1282.25,428.411 1284.6,536.823 1286.95,316.959 1289.3,527.904 1291.66,553.028 1294.01,487.304 1296.36,570.688 1298.71,614.53 1301.06,563.759 1303.41,340.774 1305.76,336.779 1308.11,378.973 1310.46,319.856 1312.81,295.014 1315.16,469.519 1317.51,387.756 1319.86,291.084 1322.21,214.453 1324.56,466.826 1326.91,549.527 1329.26,366.017 1331.61,434.493 1333.96,353.603 1336.31,563.757 1338.66,364.176 1341.02,368.276 1343.37,320.86 1345.72,443.445 1348.07,552.014 1350.42,362.96 1352.77,317.146 1355.12,437.203 1357.47,613.54 1359.82,400.802 1362.17,369.952 1364.52,400.503 1366.87,540.799 1369.22,443.269 1371.57,400.79 1373.92,516.413 1376.27,380.326 1378.62,549.041 1380.97,335.753 1383.32,358.887 1385.67,200.433 1388.02,308.417 1390.38,253.36 1392.73,530.834 1395.08,339.778 1397.43,463.824 1399.78,387.881 1402.13,407.321 1404.48,424.716 1406.83,360.445 1409.18,491.628 1411.53,221.05 1413.88,349.776 1416.23,249.242 1418.58,226.147 1420.93,329.612 1423.28,599.068 1425.63,619.659 1427.98,430.564 1430.33,428.401 1432.68,359.841 1435.03,375.105 1437.38,345.916 1439.74,498.368 1442.09,462.42 1444.44,630.037 1446.79,553.979 1449.14,416.857 1451.49,580.549 1453.84,396.687 1456.19,468.593 1458.54,567.42 1460.89,367.326 1463.24,470.101 1465.59,423.071 1467.94,568.009 1470.29,437.902 1472.64,399.285 1474.99,438.695 1477.34,385.596 1479.69,440.097 1482.04,426.779 1484.39,351.693 1486.74,401.668 1489.1,377.743 1491.45,355.292 1493.8,344.593 1496.15,396.471 1498.5,617.134 1500.85,483.711 1503.2,598.956 1505.55,343.326 1507.9,310.229 1510.25,296.751 1512.6,363.032 1514.95,470.709 1517.3,322.767 1519.65,334.777 1522,295.721 1524.35,306.293 1526.7,555.802 1529.05,500.595 1531.4,310.332 1533.75,430.157 1536.1,438.895 1538.45,505.521 1540.81,285.78 1543.16,471.885 1545.51,524.53 1547.86,469.16 1550.21,521.379 1552.56,397.672 1554.91,453.834 1557.26,397.781 1559.61,451.162 1561.96,333.3 1564.31,374.901 1566.66,214.082 1569.01,481.075 1571.36,479.514 1573.71,475.495 1576.06,423.753 1578.41,318.774 1580.76,519.405 1583.11,353.678 1585.46,385.917 1587.81,409.817 1590.17,324.694 1592.52,317.238 1594.87,505.086 1597.22,432.24 1599.57,414.09 1601.92,544.385 1604.27,353.744 1606.62,418.012 1608.97,362.395 1611.32,383.306 1613.67,445.131 1616.02,406.167 1618.37,319.334 1620.72,356.505 1623.07,362.748 1625.42,604.182 1627.77,310.02 1630.12,252.759 1632.47,298.807 1634.82,460.041 1637.17,330.755 1639.53,446.99 1641.88,626.888 1644.23,426.845 1646.58,541.253 1648.93,562.411 1651.28,270.708 1653.63,369.269 1655.98,406.131 1658.33,446.294 1660.68,415.079 1663.03,495.25 1665.38,484.573 1667.73,508.914 1670.08,445.496 1672.43,547.54 1674.78,462.396 1677.13,516.684 1679.48,384.191 1681.83,318.109 1684.18,389.779 1686.53,394.036 1688.89,344.879 1691.24,223.613 1693.59,324.609 1695.94,437.156 1698.29,487.928 1700.64,490.086 1702.99,495.308 1705.34,256.842 1707.69,270.599 1710.04,286.346 1712.39,239.78 1714.74,343.411 1717.09,483.456 1719.44,319.944 1721.79,475.709 1724.14,430.41 1726.49,365.982 1728.84,479.352 1731.19,434.952 1733.54,415.906 1735.89,284.893 1738.25,202.691 1740.6,496.312 1742.95,500.57 1745.3,280.199 1747.65,529.94 1750,492.746 1752.35,331.381 1754.7,499.587 1757.05,602.479 1759.4,654.124 1761.75,515.717 1764.1,280.437 1766.45,328.83 1768.8,439.838 1771.15,341.548 1773.5,467.959 1775.85,568.72 1778.2,533.78 1780.55,558.274 1782.9,318.013 1785.25,281.294 1787.6,459.936 1789.96,561.24 1792.31,331.97 1794.66,499.261 1797.01,434.162 1799.36,419.893 1801.71,365.801 1804.06,373.599 1806.41,393.381 1808.76,412.272 1811.11,371.808 1813.46,407.91 1815.81,410.863 1818.16,368.896 1820.51,425.798 1822.86,353.633 1825.21,235.086 1827.56,399.133 1829.91,660.493 1832.26,333.437 1834.61,368.614 1836.96,386.575 1839.32,673.403 1841.67,412.772 1844.02,256.919 1846.37,558.519 1848.72,627.363 1851.07,587.223 1853.42,402.078 1855.77,351.94 1858.12,496.018 1860.47,471.408 1862.82,334.692 1865.17,347.881 1867.52,479.177 1869.87,317.685 1872.22,403.94 1874.57,544.823 1876.92,358.633 1879.27,355.417 1881.62,546.243 1883.97,358.865 1886.32,389.885 1888.68,374.364 1891.03,424.707 1893.38,381.848 1895.73,328.325 1898.08,595.364 1900.43,407.88 1902.78,308.855 1905.13,335.411 1907.48,479.897 1909.83,378.987 1912.18,472.507 1914.53,367.181 1916.88,319.348 1919.23,503.305 1921.58,484.046 1923.93,542.43 1926.28,418.778 1928.63,500.541 1930.98,491.669 1933.33,589.96 1935.68,404.064 1938.04,261.593 1940.39,367.594 1942.74,437.704 1945.09,373.07 1947.44,332.209 1949.79,341.286 1952.14,316.258 1954.49,461.404 1956.84,530.679 1959.19,406.284 1961.54,537.495 1963.89,331.089 1966.24,539.161 1968.59,396.978 1970.94,460.606 1973.29,406.362 1975.64,260.698 1977.99,624.175 1980.34,361.212 1982.69,303.73 1985.04,352.933 1987.4,298.906 1989.75,268.126 1992.1,589.957 1994.45,487.829 1996.8,482.951 1999.15,507.367 2001.5,395.798 2003.85,380.087 2006.2,456.51 2008.55,410.605 2010.9,439.643 2013.25,328.06 2015.6,388.967 2017.95,509.43 2020.3,612.982 2022.65,563.787 2025,276.571 2027.35,466.447 2029.7,524.55 2032.05,376.106 2034.4,525.664 2036.76,358.622 2039.11,283.142 2041.46,469.269 2043.81,421.497 2046.16,292.421 2048.51,640.29 2050.86,380.422 2053.21,521.825 2055.56,335.866 2057.91,401.756 2060.26,283.271 2062.61,489.062 2064.96,291.144 2067.31,380.452 2069.66,523.1 2072.01,477.501 2074.36,362.178 2076.71,439.656 2079.06,283.997 2081.41,386.828 2083.76,426.6 2086.11,318.996 2088.47,464.207 2090.82,490.199 2093.17,273.347 2095.52,523.839 2097.87,453.202 2100.22,485.741 2102.57,457.681 2104.92,453.855 2107.27,306.533 2109.62,509.71 2111.97,329.727 2114.32,433.93 2116.67,495.932 2119.02,436.304 2121.37,245.194 2123.72,288.18 2126.07,486.213 2128.42,461.848 2130.77,436.6 2133.12,485.922 2135.47,541.181 2137.83,422.783 2140.18,334.477 2142.53,281.191 2144.88,484.212 2147.23,514.491 2149.58,212.35 2151.93,332.686 2154.28,391.048 2156.63,562.626 2158.98,250.225 2161.33,297.605 2163.68,364.49 2166.03,467.238 2168.38,461.176 2170.73,404.061 2173.08,397.678 2175.43,355.541 2177.78,598.886 2180.13,315.761 2182.48,443.113 2184.83,211.271 2187.19,310.362 2189.54,353.914 2191.89,456.241 2194.24,551.471 2196.59,345.252 2198.94,310.244 2201.29,350.658 2203.64,563.786 2205.99,363.653 2208.34,225.636 2210.69,457.975 2213.04,401.953 2215.39,496.39 2217.74,474.801 2220.09,428.305 2222.44,357.319 2224.79,525.997 2227.14,329.211 2229.49,412.882 2231.84,471.059 2234.19,497.982 2236.55,300.355 2238.9,481.539 2241.25,382.839 2243.6,381.525 2245.95,409.63 2248.3,315.661 2250.65,548.263 2253,515.125 2255.35,398.348 2257.7,419.193 2260.05,269.505 2262.4,490.848 2264.75,335.692 2267.1,436.587 2269.45,502.287 2271.8,343.907 2274.15,432.243 2276.5,540.281 2278.85,343.951 2281.2,578.504 2283.55,480.897 2285.91,405.367 2288.26,404.453 2290.61,455.748 2292.96,606.834 2295.31,460.948 2297.66,561.827 2300.01,588.79 2302.36,491.588 2304.71,336.871 2307.06,561.157 2309.41,383.452 2311.76,364.516 2314.11,458.065 2316.46,369.354 2318.81,577.713 2321.16,497.355 2323.51,458.424 2325.86,308.364 2328.21,642.565 2330.56,410.573 2332.91,462.48 2335.27,537.869 2337.62,432.499 2339.97,403.691 2342.32,387.245 2344.67,551.013 2347.02,502.783 2349.37,517.724 2351.72,420.754 2354.07,544.733 2356.42,337.448 2358.77,536.344 2361.12,349.005 2363.47,590.777 2365.82,513.122 2368.17,535.566 2370.52,342.969 2372.87,280.416 2375.22,476.096 2377.57,404.124 2379.92,340.415 2382.27,420.787 2384.62,331.325 2386.98,617.955 2389.33,513.57 2391.68,459.778 2394.03,351.397 2396.38,212.914 2398.73,503.061 2401.08,495.812 2403.43,446.721 2405.78,378.539 2408.13,432.603 2410.48,432.338 2412.83,408.554 2415.18,317.287 2417.53,435.848 2419.88,283.04 2422.23,519.841 2424.58,332.159 2426.93,452.52 2429.28,332.64 2431.63,326.419 2433.98,288.321 2436.34,468.571 2438.69,331.931 2441.04,157.031 2443.39,485.305 2445.74,450.834 2448.09,439.747 2450.44,464.621 2452.79,465.624 2455.14,517.676 2457.49,488.212 2459.84,555.803 2462.19,714.2 2464.54,328.167 2466.89,334.802 2469.24,558.906 2471.59,220.296 2473.94,580.34 2476.29,335.418 2478.64,108.197 2480.99,367.872 2483.34,534.823 2485.7,340.669 2488.05,430.723 2490.4,326.994 2492.75,222.816 2495.1,277.28 2497.45,370.941 2499.8,330.231 2502.15,342.646 2504.5,403.867 2506.85,454.14 2509.2,483.877 2511.55,558.658 2513.9,365.56 2516.25,329.293 2518.6,489.792 2520.95,457.672 2523.3,354.861 2525.65,319.18 2528,590.545 2530.35,436.498 2532.7,211.377 2535.06,423.8 2537.41,436.688 2539.76,443.329 2542.11,400.01 2544.46,373.978 2546.81,594.639 2549.16,284.53 2551.51,499.211 2553.86,350.894 2556.21,362.158 2558.56,509.757 2560.91,312.6 2563.26,325.658 2565.61,502.95 2567.96,535.452 2570.31,475.749 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.71909   -5.5079    -6.33632  -7.01609  …  -6.22921  -6.22778  -5.47685
 -0.484009  -0.789773   1.19536   1.12216     -1.35824  -1.21908   0.224371
  1.47228    4.17975    5.48592   4.88325      5.79065   5.90168   5.83442

[:, :, 2] =
 -3.20207   -3.19885   -3.09471   -2.25612  …  -5.65247   -5.55685   -6.89018
  0.402987  -0.313767  -0.156156  -0.76737      0.898317   0.526177  -1.69462
  1.81886    3.14436    5.06533    6.47416      5.58353    4.42203    3.78998

[:, :, 3] =
 -3.24003   -5.47718   -4.48851  -6.03883  …  -5.95458   -5.37935   -4.57117
  0.675506   0.819068   2.09257   0.65457     -0.829969  -0.404926  -1.20988
  2.1055     2.08939    2.80015   2.42204      4.30989    5.32339    6.00667

[:, :, 4] =
 -4.94351    -7.02978   -5.60527  …  -5.2811   -4.8352     -4.8352
  0.0832016  -0.114774   1.22467     -0.8432   -0.0255564  -0.0255564
  2.52443     5.3983     6.53038      4.39896   3.78729     3.78729</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01335    1.00785
  0.0200015  0.997294
  4.9839     1.00942</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.78 seconds
Compute duration  = 2.78 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0166    1.0066    0.0179   3160.0964   5034.9236    0.9999   ⋯
        x[2]   -0.0147    0.9948    0.0172   3341.2423   4986.0860    1.0006   ⋯
        x[3]    4.9868    1.0032    0.0167   3624.4839   5559.0944    1.0001   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9897   -5.6956   -5.0156   -4.3307   -3.0608
        x[2]   -1.9629   -0.6895   -0.0093    0.6514    1.9501
        x[3]    3.0355    4.3057    4.9877    5.6541    6.9449
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.89 seconds
Compute duration  = 1.89 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4978    0.1883    0.0028   4470.5465   5910.7445    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1456    0.3589    0.4957    0.6384    0.8491
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.16 seconds
Compute duration  = 0.16 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.5081    0.1350    0.0092   188.8540    81.7331    1.0002     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2499    0.4044    0.5130    0.6151    0.7421
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.74687346819928:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/tQhJE/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:584</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/TuringTutorials/TuringTutorials/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:936</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:925</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:855</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:196</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:195</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:399</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:274</span>
 [15] <span class="ansi-bold">transition_to_turing</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:12</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [16] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span>
 [17] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:103</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [20] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:142</span>
 [21] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:107</span>
 [22] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/senfM/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:97</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">#sample#6</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:321</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:312</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">#sample#5</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/oFGEb/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:309</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [26] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/TuringTutorials/TuringTutorials/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.95 seconds
Compute duration  = 1.95 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.7758    0.5594    0.0467    73.3720    28.8191    1.0572     ⋯
           x   -0.0483    0.8935    0.0353   872.8660   704.0802    1.0401     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0680    0.3197    0.6713    1.1145    2.0695
           x   -1.9934   -0.3792    0.0004    0.3120    1.8074
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.81 seconds
Compute duration  = 3.81 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8458    0.5560    0.0266   240.2767    84.1610    1.0065     ⋯
           x    0.0260    0.9872    0.0643   303.8092   138.9481    1.0182     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0957    0.3937    0.7504    1.1958    2.1781
           x   -2.0162   -0.4478    0.0000    0.4180    2.4424
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>